begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_package
DECL|package|org.jabref.gui.journals
package|package
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|journals
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|File
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|FileOutputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|OutputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|nio
operator|.
name|charset
operator|.
name|StandardCharsets
import|;
end_import

begin_import
import|import
name|java
operator|.
name|nio
operator|.
name|file
operator|.
name|Path
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Optional
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|stream
operator|.
name|Collectors
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|stream
operator|.
name|Stream
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|collections
operator|.
name|FXCollections
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|collections
operator|.
name|ObservableList
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|CatchExceptionsFromThread
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|JabRefException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|DialogService
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|util
operator|.
name|CurrentThreadTaskExecutor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|util
operator|.
name|TaskExecutor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|logic
operator|.
name|journals
operator|.
name|Abbreviation
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|logic
operator|.
name|journals
operator|.
name|JournalAbbreviationLoader
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|logic
operator|.
name|journals
operator|.
name|JournalAbbreviationPreferences
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|preferences
operator|.
name|PreferencesService
import|;
end_import

begin_import
import|import
name|org
operator|.
name|assertj
operator|.
name|core
operator|.
name|util
operator|.
name|Files
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Assert
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Before
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|ClassRule
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Rule
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Test
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|rules
operator|.
name|TemporaryFolder
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|jabref
operator|.
name|logic
operator|.
name|util
operator|.
name|OS
operator|.
name|NEWLINE
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|ArgumentMatchers
operator|.
name|any
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|ArgumentMatchers
operator|.
name|anyString
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Mockito
operator|.
name|mock
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Mockito
operator|.
name|verify
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Mockito
operator|.
name|when
import|;
end_import

begin_class
DECL|class|ManageJournalAbbreviationsViewModelTest
specifier|public
class|class
name|ManageJournalAbbreviationsViewModelTest
block|{
annotation|@
name|ClassRule
DECL|field|catchExceptions
specifier|public
specifier|static
name|CatchExceptionsFromThread
name|catchExceptions
init|=
operator|new
name|CatchExceptionsFromThread
argument_list|()
decl_stmt|;
annotation|@
name|Rule
DECL|field|tempFolder
specifier|public
name|TemporaryFolder
name|tempFolder
init|=
operator|new
name|TemporaryFolder
argument_list|()
decl_stmt|;
DECL|field|viewModel
specifier|private
name|ManageJournalAbbreviationsViewModel
name|viewModel
decl_stmt|;
DECL|field|emptyTestFile
specifier|private
name|Path
name|emptyTestFile
decl_stmt|;
DECL|field|testFile1Entries
specifier|private
name|Path
name|testFile1Entries
decl_stmt|;
DECL|field|testFile3Entries
specifier|private
name|Path
name|testFile3Entries
decl_stmt|;
DECL|field|testFile4Entries
specifier|private
name|Path
name|testFile4Entries
decl_stmt|;
DECL|field|testFile5EntriesWithDuplicate
specifier|private
name|Path
name|testFile5EntriesWithDuplicate
decl_stmt|;
DECL|field|abbreviationPreferences
specifier|private
name|JournalAbbreviationPreferences
name|abbreviationPreferences
decl_stmt|;
DECL|field|dialogService
specifier|private
name|DialogService
name|dialogService
decl_stmt|;
annotation|@
name|Before
DECL|method|setUpViewModel ()
specifier|public
name|void
name|setUpViewModel
parameter_list|()
throws|throws
name|Exception
block|{
name|abbreviationPreferences
operator|=
name|mock
argument_list|(
name|JournalAbbreviationPreferences
operator|.
name|class
argument_list|)
expr_stmt|;
name|PreferencesService
name|preferences
init|=
name|mock
argument_list|(
name|PreferencesService
operator|.
name|class
argument_list|)
decl_stmt|;
name|when
argument_list|(
name|preferences
operator|.
name|getJournalAbbreviationPreferences
argument_list|()
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|abbreviationPreferences
argument_list|)
expr_stmt|;
name|dialogService
operator|=
name|mock
argument_list|(
name|DialogService
operator|.
name|class
argument_list|)
expr_stmt|;
name|TaskExecutor
name|taskExecutor
init|=
operator|new
name|CurrentThreadTaskExecutor
argument_list|()
decl_stmt|;
name|JournalAbbreviationLoader
name|journalAbbreviationLoader
init|=
name|mock
argument_list|(
name|JournalAbbreviationLoader
operator|.
name|class
argument_list|)
decl_stmt|;
name|viewModel
operator|=
operator|new
name|ManageJournalAbbreviationsViewModel
argument_list|(
name|preferences
argument_list|,
name|dialogService
argument_list|,
name|taskExecutor
argument_list|,
name|journalAbbreviationLoader
argument_list|)
expr_stmt|;
name|emptyTestFile
operator|=
name|createTemporaryTestFile
argument_list|(
literal|"emptyTestFile.txt"
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|testFile1Entries
operator|=
name|createTemporaryTestFile
argument_list|(
literal|"testFile1Entries.txt"
argument_list|,
literal|"Test Entry = TE"
operator|+
name|NEWLINE
operator|+
literal|""
argument_list|)
expr_stmt|;
name|testFile3Entries
operator|=
name|createTemporaryTestFile
argument_list|(
literal|"testFile3Entries.txt"
argument_list|,
literal|"Abbreviations = Abb"
operator|+
name|NEWLINE
operator|+
literal|"Test Entry = TE"
operator|+
name|NEWLINE
operator|+
literal|"MoreEntries = ME"
operator|+
name|NEWLINE
operator|+
literal|""
argument_list|)
expr_stmt|;
name|testFile4Entries
operator|=
name|createTemporaryTestFile
argument_list|(
literal|"testFile4Entries.txt"
argument_list|,
literal|"Abbreviations = Abb"
operator|+
name|NEWLINE
operator|+
literal|"Test Entry = TE"
operator|+
name|NEWLINE
operator|+
literal|"MoreEntries = ME"
operator|+
name|NEWLINE
operator|+
literal|"Entry = E"
operator|+
name|NEWLINE
operator|+
literal|""
argument_list|)
expr_stmt|;
name|testFile5EntriesWithDuplicate
operator|=
name|createTemporaryTestFile
argument_list|(
literal|"testFile5Entries.txt"
argument_list|,
literal|"Abbreviations = Abb"
operator|+
name|NEWLINE
operator|+
literal|"Test Entry = TE"
operator|+
name|NEWLINE
operator|+
literal|"Test Entry = TE"
operator|+
name|NEWLINE
operator|+
literal|"MoreEntries = ME"
operator|+
name|NEWLINE
operator|+
literal|"EntryEntry = EE"
operator|+
name|NEWLINE
operator|+
literal|""
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testInitialHasNoFilesAndNoAbbreviations ()
specifier|public
name|void
name|testInitialHasNoFilesAndNoAbbreviations
parameter_list|()
block|{
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testInitialWithSavedFilesIncrementsFilesCounter ()
specifier|public
name|void
name|testInitialWithSavedFilesIncrementsFilesCounter
parameter_list|()
throws|throws
name|Exception
block|{
name|addFourTestFileToViewModelAndPreferences
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|createFileObjects
argument_list|()
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|4
argument_list|,
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRemoveDuplicatesWhenReadingFiles ()
specifier|public
name|void
name|testRemoveDuplicatesWhenReadingFiles
parameter_list|()
throws|throws
name|Exception
block|{
name|addFourTestFileToViewModelAndPreferences
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|createFileObjects
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
comment|// should result in 4 real abbreviations and one pseudo abbreviation
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|5
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|addFileIncreasesCounterOfOpenFilesAndHasNoAbbreviations ()
specifier|public
name|void
name|addFileIncreasesCounterOfOpenFilesAndHasNoAbbreviations
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|emptyTestFile
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|addDuplicatedFileResultsInErrorDialog ()
specifier|public
name|void
name|addDuplicatedFileResultsInErrorDialog
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile1Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|verify
argument_list|(
name|dialogService
argument_list|)
operator|.
name|showErrorDialogAndWait
argument_list|(
name|anyString
argument_list|()
argument_list|,
name|anyString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testOpenDuplicatedFileResultsInAnException ()
specifier|public
name|void
name|testOpenDuplicatedFileResultsInAnException
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileOpenDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile1Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|openFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|openFile
argument_list|()
expr_stmt|;
name|verify
argument_list|(
name|dialogService
argument_list|)
operator|.
name|showErrorDialogAndWait
argument_list|(
name|anyString
argument_list|()
argument_list|,
name|anyString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testSelectLastJournalFileSwitchesFilesAndTheirAbbreviations ()
specifier|public
name|void
name|testSelectLastJournalFileSwitchesFilesAndTheirAbbreviations
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|emptyTestFile
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|viewModel
operator|.
name|abbreviationsCountProperty
argument_list|()
operator|.
name|get
argument_list|()
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile1Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|viewModel
operator|.
name|abbreviationsCountProperty
argument_list|()
operator|.
name|get
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testOpenValidFileContainsTheSpecificEntryAndEnoughAbbreviations ()
specifier|public
name|void
name|testOpenValidFileContainsTheSpecificEntryAndEnoughAbbreviations
parameter_list|()
throws|throws
name|Exception
block|{
name|Abbreviation
name|testAbbreviation
init|=
operator|new
name|Abbreviation
argument_list|(
literal|"Test Entry"
argument_list|,
literal|"TE"
argument_list|)
decl_stmt|;
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile3Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
comment|// our test file has 3 abbreviations and one pseudo abbreviation
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|4
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|contains
argument_list|(
operator|new
name|AbbreviationViewModel
argument_list|(
name|testAbbreviation
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRemoveLastListSetsCurrentFileAndCurrentAbbreviationToNull ()
specifier|public
name|void
name|testRemoveLastListSetsCurrentFileAndCurrentAbbreviationToNull
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile1Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|removeCurrentFile
argument_list|()
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertNull
argument_list|(
name|viewModel
operator|.
name|currentFileProperty
argument_list|()
operator|.
name|get
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertNull
argument_list|(
name|viewModel
operator|.
name|currentAbbreviationProperty
argument_list|()
operator|.
name|get
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testMixedFileUsage ()
specifier|public
name|void
name|testMixedFileUsage
parameter_list|()
throws|throws
name|Exception
block|{
name|Abbreviation
name|testAbbreviation
init|=
operator|new
name|Abbreviation
argument_list|(
literal|"Entry"
argument_list|,
literal|"E"
argument_list|)
decl_stmt|;
name|Abbreviation
name|testAbbreviation2
init|=
operator|new
name|Abbreviation
argument_list|(
literal|"EntryEntry"
argument_list|,
literal|"EE"
argument_list|)
decl_stmt|;
comment|// simulate open file button twice
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile3Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile4Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|currentFileProperty
argument_list|()
operator|.
name|set
argument_list|(
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|get
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
comment|// size of the list of journal files should be incremented by two
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
comment|// our second test file has 4 abbreviations
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|5
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
comment|// check some abbreviation
name|Assert
operator|.
name|assertTrue
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|contains
argument_list|(
operator|new
name|AbbreviationViewModel
argument_list|(
name|testAbbreviation
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// simulate add new file button
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|emptyTestFile
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|currentFileProperty
argument_list|()
operator|.
name|set
argument_list|(
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|get
argument_list|(
literal|2
argument_list|)
argument_list|)
expr_stmt|;
comment|// size of the list of journal files should be incremented by one
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|3
argument_list|,
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
comment|// a new file has zero abbreviations
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
comment|// simulate open file button
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile5EntriesWithDuplicate
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|currentFileProperty
argument_list|()
operator|.
name|set
argument_list|(
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|get
argument_list|(
literal|3
argument_list|)
argument_list|)
expr_stmt|;
comment|// size of the list of journal files should be incremented by one
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|4
argument_list|,
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|5
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
comment|// check some abbreviation
name|Assert
operator|.
name|assertTrue
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|contains
argument_list|(
operator|new
name|AbbreviationViewModel
argument_list|(
name|testAbbreviation2
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testBuiltInListsIncludeAllBuiltInAbbreviations ()
specifier|public
name|void
name|testBuiltInListsIncludeAllBuiltInAbbreviations
parameter_list|()
block|{
name|when
argument_list|(
name|abbreviationPreferences
operator|.
name|useIEEEAbbreviations
argument_list|()
argument_list|)
operator|.
name|thenReturn
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addBuiltInLists
argument_list|()
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|getSize
argument_list|()
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|currentFileProperty
argument_list|()
operator|.
name|set
argument_list|(
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|get
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|ObservableList
argument_list|<
name|Abbreviation
argument_list|>
name|expected
init|=
name|FXCollections
operator|.
name|observableArrayList
argument_list|(
name|JournalAbbreviationLoader
operator|.
name|getBuiltInAbbreviations
argument_list|()
argument_list|)
decl_stmt|;
name|ObservableList
argument_list|<
name|Abbreviation
argument_list|>
name|actualAbbreviations
init|=
name|FXCollections
operator|.
name|observableArrayList
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|stream
argument_list|()
operator|.
name|map
argument_list|(
name|AbbreviationViewModel
operator|::
name|getAbbreviationObject
argument_list|)
operator|.
name|collect
argument_list|(
name|Collectors
operator|.
name|toList
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|expected
argument_list|,
name|actualAbbreviations
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testBuiltInListsStandardIEEEIncludesAllBuiltIEEEAbbreviations ()
specifier|public
name|void
name|testBuiltInListsStandardIEEEIncludesAllBuiltIEEEAbbreviations
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|abbreviationPreferences
operator|.
name|useIEEEAbbreviations
argument_list|()
argument_list|)
operator|.
name|thenReturn
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addBuiltInLists
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|getSize
argument_list|()
argument_list|)
expr_stmt|;
name|ObservableList
argument_list|<
name|Abbreviation
argument_list|>
name|expected
init|=
name|FXCollections
operator|.
name|observableArrayList
argument_list|(
name|JournalAbbreviationLoader
operator|.
name|getOfficialIEEEAbbreviations
argument_list|()
argument_list|)
decl_stmt|;
name|ObservableList
argument_list|<
name|Abbreviation
argument_list|>
name|actualAbbreviations
init|=
name|FXCollections
operator|.
name|observableArrayList
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|stream
argument_list|()
operator|.
name|map
argument_list|(
name|AbbreviationViewModel
operator|::
name|getAbbreviationObject
argument_list|)
operator|.
name|collect
argument_list|(
name|Collectors
operator|.
name|toList
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|expected
argument_list|,
name|actualAbbreviations
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testcurrentFilePropertyChangeActiveFile ()
specifier|public
name|void
name|testcurrentFilePropertyChangeActiveFile
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile1Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile3Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile4Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile5EntriesWithDuplicate
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|AbbreviationsFileViewModel
name|test1
init|=
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|get
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|AbbreviationsFileViewModel
name|test3
init|=
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|get
argument_list|(
literal|1
argument_list|)
decl_stmt|;
name|AbbreviationsFileViewModel
name|test4
init|=
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|get
argument_list|(
literal|2
argument_list|)
decl_stmt|;
name|AbbreviationsFileViewModel
name|test5
init|=
name|viewModel
operator|.
name|journalFilesProperty
argument_list|()
operator|.
name|get
argument_list|(
literal|3
argument_list|)
decl_stmt|;
comment|// test if the last opened file is active, but duplicated entry has been removed
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|5
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|currentFileProperty
argument_list|()
operator|.
name|set
argument_list|(
name|test1
argument_list|)
expr_stmt|;
comment|// test if the current abbreviations matches with the ones in testFile1Entries
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|currentFileProperty
argument_list|()
operator|.
name|set
argument_list|(
name|test3
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|4
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|currentFileProperty
argument_list|()
operator|.
name|set
argument_list|(
name|test1
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|currentFileProperty
argument_list|()
operator|.
name|set
argument_list|(
name|test4
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|5
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|currentFileProperty
argument_list|()
operator|.
name|set
argument_list|(
name|test5
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|5
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAddAbbreviationIncludesAbbreviationsInAbbreviationList ()
specifier|public
name|void
name|testAddAbbreviationIncludesAbbreviationsInAbbreviationList
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile4Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile5EntriesWithDuplicate
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|Abbreviation
name|testAbbreviation
init|=
operator|new
name|Abbreviation
argument_list|(
literal|"YetAnotherEntry"
argument_list|,
literal|"YAE"
argument_list|)
decl_stmt|;
name|addAbbrevaition
argument_list|(
name|testAbbreviation
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|6
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|contains
argument_list|(
operator|new
name|AbbreviationViewModel
argument_list|(
name|testAbbreviation
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAddDuplicatedAbbreviationResultsInException ()
specifier|public
name|void
name|testAddDuplicatedAbbreviationResultsInException
parameter_list|()
throws|throws
name|JabRefException
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile3Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|addAbbreviation
argument_list|(
literal|"YetAnotherEntry"
argument_list|,
literal|"YAE"
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addAbbreviation
argument_list|(
literal|"YetAnotherEntry"
argument_list|,
literal|"YAE"
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|dialogService
argument_list|)
operator|.
name|showErrorDialogAndWait
argument_list|(
name|anyString
argument_list|()
argument_list|,
name|anyString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testEditSameAbbreviationWithNoChangeDoesNotResultInException ()
specifier|public
name|void
name|testEditSameAbbreviationWithNoChangeDoesNotResultInException
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|emptyTestFile
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|Abbreviation
name|testAbbreviation
init|=
operator|new
name|Abbreviation
argument_list|(
literal|"YetAnotherEntry"
argument_list|,
literal|"YAE"
argument_list|)
decl_stmt|;
name|addAbbrevaition
argument_list|(
name|testAbbreviation
argument_list|)
expr_stmt|;
name|editAbbreviation
argument_list|(
name|testAbbreviation
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|contains
argument_list|(
operator|new
name|AbbreviationViewModel
argument_list|(
name|testAbbreviation
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testEditAbbreviationIncludesNewAbbreviationInAbbreviationsList ()
specifier|public
name|void
name|testEditAbbreviationIncludesNewAbbreviationInAbbreviationsList
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile4Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile5EntriesWithDuplicate
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|selectLastAbbreviation
argument_list|()
expr_stmt|;
name|Abbreviation
name|testAbbreviation
init|=
operator|new
name|Abbreviation
argument_list|(
literal|"YetAnotherEntry"
argument_list|,
literal|"YAE"
argument_list|)
decl_stmt|;
name|editAbbreviation
argument_list|(
name|testAbbreviation
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|5
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|contains
argument_list|(
operator|new
name|AbbreviationViewModel
argument_list|(
name|testAbbreviation
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|emptyTestFile
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|editAbbreviation
argument_list|(
name|testAbbreviation
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|contains
argument_list|(
operator|new
name|AbbreviationViewModel
argument_list|(
name|testAbbreviation
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testEditAbbreviationToExistingOneResultsInException ()
specifier|public
name|void
name|testEditAbbreviationToExistingOneResultsInException
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile3Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|selectLastAbbreviation
argument_list|()
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|4
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|editAbbreviation
argument_list|(
literal|"YetAnotherEntry"
argument_list|,
literal|"YAE"
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|currentAbbreviationProperty
argument_list|()
operator|.
name|set
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|get
argument_list|(
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|editAbbreviation
argument_list|(
literal|"YetAnotherEntry"
argument_list|,
literal|"YAE"
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|dialogService
argument_list|)
operator|.
name|showErrorDialogAndWait
argument_list|(
name|anyString
argument_list|()
argument_list|,
name|anyString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testEditAbbreviationToEmptyNameResultsInException ()
specifier|public
name|void
name|testEditAbbreviationToEmptyNameResultsInException
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile3Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|selectLastAbbreviation
argument_list|()
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|4
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|editAbbreviation
argument_list|(
literal|""
argument_list|,
literal|"YAE"
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|dialogService
argument_list|)
operator|.
name|showErrorDialogAndWait
argument_list|(
name|anyString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testEditAbbreviationToEmptyAbbreviationResultsInException ()
specifier|public
name|void
name|testEditAbbreviationToEmptyAbbreviationResultsInException
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile3Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|selectLastAbbreviation
argument_list|()
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|4
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|editAbbreviation
argument_list|(
literal|"YetAnotherEntry"
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|dialogService
argument_list|)
operator|.
name|showErrorDialogAndWait
argument_list|(
name|anyString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testDeleteAbbreviationSelectsPreviousOne ()
specifier|public
name|void
name|testDeleteAbbreviationSelectsPreviousOne
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile4Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile5EntriesWithDuplicate
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|Abbreviation
name|testAbbreviation
init|=
operator|new
name|Abbreviation
argument_list|(
literal|"YetAnotherEntry"
argument_list|,
literal|"YAE"
argument_list|)
decl_stmt|;
name|addAbbrevaition
argument_list|(
name|testAbbreviation
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|contains
argument_list|(
operator|new
name|AbbreviationViewModel
argument_list|(
name|testAbbreviation
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
operator|new
name|AbbreviationViewModel
argument_list|(
name|testAbbreviation
argument_list|)
argument_list|,
name|viewModel
operator|.
name|currentAbbreviationProperty
argument_list|()
operator|.
name|get
argument_list|()
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|deleteAbbreviation
argument_list|()
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|5
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
comment|// check if the previous (the last) element is the current abbreviation
name|Assert
operator|.
name|assertEquals
argument_list|(
name|viewModel
operator|.
name|currentAbbreviationProperty
argument_list|()
operator|.
name|get
argument_list|()
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|get
argument_list|(
literal|4
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testDeleteAbbreviationSelectsNextOne ()
specifier|public
name|void
name|testDeleteAbbreviationSelectsNextOne
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile1Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|Abbreviation
name|testAbbreviation
init|=
operator|new
name|Abbreviation
argument_list|(
literal|"YetAnotherEntry"
argument_list|,
literal|"YAE"
argument_list|)
decl_stmt|;
name|addAbbrevaition
argument_list|(
name|testAbbreviation
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|currentAbbreviationProperty
argument_list|()
operator|.
name|set
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|get
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|deleteAbbreviation
argument_list|()
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
operator|new
name|AbbreviationViewModel
argument_list|(
name|testAbbreviation
argument_list|)
argument_list|,
name|viewModel
operator|.
name|currentAbbreviationProperty
argument_list|()
operator|.
name|get
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testSaveAbbreviationsToFilesCreatesNewFilesWithWrittenAbbreviations ()
specifier|public
name|void
name|testSaveAbbreviationsToFilesCreatesNewFilesWithWrittenAbbreviations
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile4Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|selectLastAbbreviation
argument_list|()
expr_stmt|;
name|Abbreviation
name|testAbbreviation
init|=
operator|new
name|Abbreviation
argument_list|(
literal|"JabRefTestEntry"
argument_list|,
literal|"JTE"
argument_list|)
decl_stmt|;
name|editAbbreviation
argument_list|(
name|testAbbreviation
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|5
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|contains
argument_list|(
operator|new
name|AbbreviationViewModel
argument_list|(
name|testAbbreviation
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile5EntriesWithDuplicate
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|selectLastJournalFile
argument_list|()
expr_stmt|;
name|selectLastAbbreviation
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|deleteAbbreviation
argument_list|()
expr_stmt|;
name|Abbreviation
name|testAbbreviation1
init|=
operator|new
name|Abbreviation
argument_list|(
literal|"SomeOtherEntry"
argument_list|,
literal|"SOE"
argument_list|)
decl_stmt|;
name|addAbbrevaition
argument_list|(
name|testAbbreviation1
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|5
argument_list|,
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|contains
argument_list|(
operator|new
name|AbbreviationViewModel
argument_list|(
name|testAbbreviation1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|saveJournalAbbreviationFiles
argument_list|()
expr_stmt|;
name|String
name|expected
init|=
literal|"Abbreviations = Abb"
operator|+
name|NEWLINE
operator|+
literal|"Test Entry = TE"
operator|+
name|NEWLINE
operator|+
literal|"MoreEntries = ME"
operator|+
name|NEWLINE
operator|+
literal|"JabRefTestEntry = JTE"
operator|+
name|NEWLINE
operator|+
literal|""
decl_stmt|;
name|String
name|actual
init|=
name|Files
operator|.
name|contentOf
argument_list|(
name|testFile4Entries
operator|.
name|toFile
argument_list|()
argument_list|,
name|StandardCharsets
operator|.
name|UTF_8
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|expected
argument_list|,
name|actual
argument_list|)
expr_stmt|;
name|expected
operator|=
literal|"Abbreviations = Abb"
operator|+
name|NEWLINE
operator|+
literal|"Test Entry = TE"
operator|+
name|NEWLINE
operator|+
literal|"MoreEntries = ME"
operator|+
name|NEWLINE
operator|+
literal|"SomeOtherEntry = SOE"
operator|+
name|NEWLINE
operator|+
literal|""
expr_stmt|;
name|actual
operator|=
name|Files
operator|.
name|contentOf
argument_list|(
name|testFile5EntriesWithDuplicate
operator|.
name|toFile
argument_list|()
argument_list|,
name|StandardCharsets
operator|.
name|UTF_8
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|expected
argument_list|,
name|actual
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testSaveExternalFilesListToPreferences ()
specifier|public
name|void
name|testSaveExternalFilesListToPreferences
parameter_list|()
throws|throws
name|Exception
block|{
name|addFourTestFileToViewModelAndPreferences
argument_list|()
expr_stmt|;
name|List
argument_list|<
name|String
argument_list|>
name|expected
init|=
name|Stream
operator|.
name|of
argument_list|(
name|testFile1Entries
argument_list|,
name|testFile3Entries
argument_list|,
name|testFile4Entries
argument_list|,
name|testFile5EntriesWithDuplicate
argument_list|)
operator|.
name|map
argument_list|(
name|Path
operator|::
name|toString
argument_list|)
operator|.
name|collect
argument_list|(
name|Collectors
operator|.
name|toList
argument_list|()
argument_list|)
decl_stmt|;
name|verify
argument_list|(
name|abbreviationPreferences
argument_list|)
operator|.
name|setExternalJournalLists
argument_list|(
name|expected
argument_list|)
expr_stmt|;
block|}
DECL|method|createTemporaryTestFile (String name, String content)
specifier|private
name|Path
name|createTemporaryTestFile
parameter_list|(
name|String
name|name
parameter_list|,
name|String
name|content
parameter_list|)
throws|throws
name|Exception
block|{
name|File
name|testFile
init|=
name|tempFolder
operator|.
name|newFile
argument_list|(
name|name
argument_list|)
decl_stmt|;
try|try
init|(
name|OutputStream
name|outputStream
init|=
operator|new
name|FileOutputStream
argument_list|(
name|testFile
argument_list|)
init|)
block|{
name|outputStream
operator|.
name|write
argument_list|(
name|content
operator|.
name|getBytes
argument_list|(
name|StandardCharsets
operator|.
name|UTF_8
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|testFile
operator|.
name|toPath
argument_list|()
return|;
block|}
DECL|method|addAbbrevaition (Abbreviation testAbbreviation)
specifier|private
name|void
name|addAbbrevaition
parameter_list|(
name|Abbreviation
name|testAbbreviation
parameter_list|)
throws|throws
name|Exception
block|{
name|viewModel
operator|.
name|addAbbreviation
argument_list|(
name|testAbbreviation
operator|.
name|getName
argument_list|()
argument_list|,
name|testAbbreviation
operator|.
name|getAbbreviation
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|editAbbreviation (Abbreviation testAbbreviation)
specifier|private
name|void
name|editAbbreviation
parameter_list|(
name|Abbreviation
name|testAbbreviation
parameter_list|)
throws|throws
name|Exception
block|{
name|viewModel
operator|.
name|editAbbreviation
argument_list|(
name|testAbbreviation
operator|.
name|getName
argument_list|()
argument_list|,
name|testAbbreviation
operator|.
name|getAbbreviation
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|addFourTestFileToViewModelAndPreferences ()
specifier|private
name|void
name|addFourTestFileToViewModelAndPreferences
parameter_list|()
throws|throws
name|Exception
block|{
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile1Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile3Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile4Entries
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|when
argument_list|(
name|dialogService
operator|.
name|showFileSaveDialog
argument_list|(
name|any
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|Optional
operator|.
name|of
argument_list|(
name|testFile5EntriesWithDuplicate
argument_list|)
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|addNewFile
argument_list|()
expr_stmt|;
name|viewModel
operator|.
name|saveEverythingAndUpdateAutoCompleter
argument_list|()
expr_stmt|;
block|}
comment|/**      * Select the last abbreviation in the list of abbreviations      */
DECL|method|selectLastAbbreviation ()
specifier|private
name|void
name|selectLastAbbreviation
parameter_list|()
block|{
name|viewModel
operator|.
name|currentAbbreviationProperty
argument_list|()
operator|.
name|set
argument_list|(
name|viewModel
operator|.
name|abbreviationsProperty
argument_list|()
operator|.
name|get
argument_list|(
name|viewModel
operator|.
name|abbreviationsCountProperty
argument_list|()
operator|.
name|get
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_class

end_unit

