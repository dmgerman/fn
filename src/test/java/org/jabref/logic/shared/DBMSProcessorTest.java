begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_package
DECL|package|org.jabref.logic.shared
package|package
name|org
operator|.
name|jabref
operator|.
name|logic
operator|.
name|shared
package|;
end_package

begin_import
import|import
name|java
operator|.
name|sql
operator|.
name|ResultSet
import|;
end_import

begin_import
import|import
name|java
operator|.
name|sql
operator|.
name|SQLException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Arrays
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collection
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashMap
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Optional
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|stream
operator|.
name|Stream
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|logic
operator|.
name|shared
operator|.
name|exception
operator|.
name|InvalidDBMSConnectionPropertiesException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|logic
operator|.
name|shared
operator|.
name|exception
operator|.
name|OfflineLockException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|model
operator|.
name|database
operator|.
name|shared
operator|.
name|DBMSType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|model
operator|.
name|entry
operator|.
name|BibEntry
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|model
operator|.
name|entry
operator|.
name|StandardEntryType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|model
operator|.
name|entry
operator|.
name|field
operator|.
name|Field
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|model
operator|.
name|entry
operator|.
name|field
operator|.
name|StandardField
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|model
operator|.
name|entry
operator|.
name|field
operator|.
name|UnknownField
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|testutils
operator|.
name|category
operator|.
name|DatabaseTest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|jupiter
operator|.
name|api
operator|.
name|AfterEach
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|jupiter
operator|.
name|params
operator|.
name|ParameterizedTest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|jupiter
operator|.
name|params
operator|.
name|provider
operator|.
name|MethodSource
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|junit
operator|.
name|jupiter
operator|.
name|api
operator|.
name|Assertions
operator|.
name|assertEquals
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|junit
operator|.
name|jupiter
operator|.
name|api
operator|.
name|Assertions
operator|.
name|assertFalse
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|junit
operator|.
name|jupiter
operator|.
name|api
operator|.
name|Assertions
operator|.
name|assertThrows
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|junit
operator|.
name|jupiter
operator|.
name|api
operator|.
name|Assertions
operator|.
name|assertTrue
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|junit
operator|.
name|jupiter
operator|.
name|api
operator|.
name|Assertions
operator|.
name|fail
import|;
end_import

begin_class
annotation|@
name|DatabaseTest
DECL|class|DBMSProcessorTest
class|class
name|DBMSProcessorTest
block|{
DECL|method|getTestingDatabaseSystems ()
specifier|private
specifier|static
name|Stream
argument_list|<
name|Object
index|[]
argument_list|>
name|getTestingDatabaseSystems
parameter_list|()
throws|throws
name|InvalidDBMSConnectionPropertiesException
throws|,
name|SQLException
block|{
name|Collection
argument_list|<
name|Object
index|[]
argument_list|>
name|result
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|()
decl_stmt|;
for|for
control|(
name|DBMSType
name|dbmsType
range|:
name|TestManager
operator|.
name|getDBMSTypeTestParameter
argument_list|()
control|)
block|{
name|result
operator|.
name|add
argument_list|(
operator|new
name|Object
index|[]
block|{
name|dbmsType
block|,
name|TestConnector
operator|.
name|getTestDBMSConnection
argument_list|(
name|dbmsType
argument_list|)
block|,
name|DBMSProcessor
operator|.
name|getProcessorInstance
argument_list|(
name|TestConnector
operator|.
name|getTestDBMSConnection
argument_list|(
name|dbmsType
argument_list|)
argument_list|)
block|}
argument_list|)
expr_stmt|;
block|}
return|return
name|result
operator|.
name|stream
argument_list|()
return|;
block|}
annotation|@
name|ParameterizedTest
annotation|@
name|MethodSource
argument_list|(
literal|"getTestingDatabaseSystems"
argument_list|)
DECL|method|testCheckBaseIntegrity (DBMSType dbmsType, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
name|void
name|testCheckBaseIntegrity
parameter_list|(
name|DBMSType
name|dbmsType
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
throws|throws
name|SQLException
block|{
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|assertTrue
argument_list|(
name|dbmsProcessor
operator|.
name|checkBaseIntegrity
argument_list|()
argument_list|)
expr_stmt|;
name|clear
argument_list|(
name|dbmsConnection
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|dbmsProcessor
operator|.
name|checkBaseIntegrity
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|ParameterizedTest
annotation|@
name|MethodSource
argument_list|(
literal|"getTestingDatabaseSystems"
argument_list|)
DECL|method|testSetUpSharedDatabase (DBMSType dbmsType, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
name|void
name|testSetUpSharedDatabase
parameter_list|(
name|DBMSType
name|dbmsType
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
throws|throws
name|SQLException
block|{
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|clear
argument_list|(
name|dbmsConnection
argument_list|)
expr_stmt|;
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|assertTrue
argument_list|(
name|dbmsProcessor
operator|.
name|checkBaseIntegrity
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|ParameterizedTest
annotation|@
name|MethodSource
argument_list|(
literal|"getTestingDatabaseSystems"
argument_list|)
DECL|method|testInsertEntry (DBMSType dbmsType, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
name|void
name|testInsertEntry
parameter_list|(
name|DBMSType
name|dbmsType
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
throws|throws
name|SQLException
block|{
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|BibEntry
name|expectedEntry
init|=
name|getBibEntryExample
argument_list|()
decl_stmt|;
name|dbmsProcessor
operator|.
name|insertEntry
argument_list|(
name|expectedEntry
argument_list|)
expr_stmt|;
name|BibEntry
name|emptyEntry
init|=
operator|new
name|BibEntry
argument_list|()
decl_stmt|;
name|emptyEntry
operator|.
name|getSharedBibEntryData
argument_list|()
operator|.
name|setSharedID
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|dbmsProcessor
operator|.
name|insertEntry
argument_list|(
name|emptyEntry
argument_list|)
expr_stmt|;
comment|// does not insert, due to same sharedID.
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|actualFieldMap
init|=
operator|new
name|HashMap
argument_list|<>
argument_list|()
decl_stmt|;
try|try
init|(
name|ResultSet
name|entryResultSet
init|=
name|selectFrom
argument_list|(
literal|"ENTRY"
argument_list|,
name|dbmsConnection
argument_list|,
name|dbmsProcessor
argument_list|)
init|)
block|{
name|assertTrue
argument_list|(
name|entryResultSet
operator|.
name|next
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|entryResultSet
operator|.
name|getInt
argument_list|(
literal|"SHARED_ID"
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"inproceedings"
argument_list|,
name|entryResultSet
operator|.
name|getString
argument_list|(
literal|"TYPE"
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|entryResultSet
operator|.
name|getInt
argument_list|(
literal|"VERSION"
argument_list|)
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
name|entryResultSet
operator|.
name|next
argument_list|()
argument_list|)
expr_stmt|;
try|try
init|(
name|ResultSet
name|fieldResultSet
init|=
name|selectFrom
argument_list|(
literal|"FIELD"
argument_list|,
name|dbmsConnection
argument_list|,
name|dbmsProcessor
argument_list|)
init|)
block|{
while|while
condition|(
name|fieldResultSet
operator|.
name|next
argument_list|()
condition|)
block|{
name|actualFieldMap
operator|.
name|put
argument_list|(
name|fieldResultSet
operator|.
name|getString
argument_list|(
literal|"NAME"
argument_list|)
argument_list|,
name|fieldResultSet
operator|.
name|getString
argument_list|(
literal|"VALUE"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|Map
argument_list|<
name|Field
argument_list|,
name|String
argument_list|>
name|expectedFieldMap
init|=
name|expectedEntry
operator|.
name|getFieldMap
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
name|expectedFieldMap
argument_list|,
name|actualFieldMap
argument_list|)
expr_stmt|;
block|}
annotation|@
name|ParameterizedTest
annotation|@
name|MethodSource
argument_list|(
literal|"getTestingDatabaseSystems"
argument_list|)
DECL|method|testUpdateEntry (DBMSType dbmsType, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
name|void
name|testUpdateEntry
parameter_list|(
name|DBMSType
name|dbmsType
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
throws|throws
name|OfflineLockException
throws|,
name|SQLException
block|{
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|BibEntry
name|expectedEntry
init|=
name|getBibEntryExample
argument_list|()
decl_stmt|;
name|dbmsProcessor
operator|.
name|insertEntry
argument_list|(
name|expectedEntry
argument_list|)
expr_stmt|;
name|expectedEntry
operator|.
name|setType
argument_list|(
name|StandardEntryType
operator|.
name|Book
argument_list|)
expr_stmt|;
name|expectedEntry
operator|.
name|setField
argument_list|(
name|StandardField
operator|.
name|AUTHOR
argument_list|,
literal|"Michael J and Hutchings"
argument_list|)
expr_stmt|;
name|expectedEntry
operator|.
name|setField
argument_list|(
operator|new
name|UnknownField
argument_list|(
literal|"customField"
argument_list|)
argument_list|,
literal|"custom value"
argument_list|)
expr_stmt|;
name|expectedEntry
operator|.
name|clearField
argument_list|(
name|StandardField
operator|.
name|BOOKTITLE
argument_list|)
expr_stmt|;
name|dbmsProcessor
operator|.
name|updateEntry
argument_list|(
name|expectedEntry
argument_list|)
expr_stmt|;
name|Optional
argument_list|<
name|BibEntry
argument_list|>
name|actualEntryOptional
init|=
name|dbmsProcessor
operator|.
name|getSharedEntry
argument_list|(
name|expectedEntry
operator|.
name|getSharedBibEntryData
argument_list|()
operator|.
name|getSharedID
argument_list|()
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|expectedEntry
argument_list|,
name|actualEntryOptional
operator|.
name|get
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|ParameterizedTest
annotation|@
name|MethodSource
argument_list|(
literal|"getTestingDatabaseSystems"
argument_list|)
DECL|method|testGetEntriesByIdList (DBMSType dbmsType, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
name|void
name|testGetEntriesByIdList
parameter_list|(
name|DBMSType
name|dbmsType
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
throws|throws
name|OfflineLockException
throws|,
name|SQLException
block|{
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|BibEntry
name|firstEntry
init|=
name|getBibEntryExample
argument_list|()
decl_stmt|;
name|firstEntry
operator|.
name|setId
argument_list|(
literal|"1"
argument_list|)
expr_stmt|;
name|BibEntry
name|secondEntry
init|=
name|getBibEntryExample
argument_list|()
decl_stmt|;
name|secondEntry
operator|.
name|setId
argument_list|(
literal|"2"
argument_list|)
expr_stmt|;
name|dbmsProcessor
operator|.
name|insertEntry
argument_list|(
name|firstEntry
argument_list|)
expr_stmt|;
name|dbmsProcessor
operator|.
name|insertEntry
argument_list|(
name|secondEntry
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|BibEntry
argument_list|>
name|sharedEntriesByIdList
init|=
name|dbmsProcessor
operator|.
name|getSharedEntries
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|)
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|firstEntry
operator|.
name|getId
argument_list|()
argument_list|,
name|sharedEntriesByIdList
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|getId
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|secondEntry
operator|.
name|getId
argument_list|()
argument_list|,
name|sharedEntriesByIdList
operator|.
name|get
argument_list|(
literal|1
argument_list|)
operator|.
name|getId
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|ParameterizedTest
annotation|@
name|MethodSource
argument_list|(
literal|"getTestingDatabaseSystems"
argument_list|)
DECL|method|testUpdateNewerEntry (DBMSType dbmsType, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
name|void
name|testUpdateNewerEntry
parameter_list|(
name|DBMSType
name|dbmsType
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
throws|throws
name|OfflineLockException
throws|,
name|SQLException
block|{
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|BibEntry
name|bibEntry
init|=
name|getBibEntryExample
argument_list|()
decl_stmt|;
name|dbmsProcessor
operator|.
name|insertEntry
argument_list|(
name|bibEntry
argument_list|)
expr_stmt|;
comment|//simulate older version
name|bibEntry
operator|.
name|getSharedBibEntryData
argument_list|()
operator|.
name|setVersion
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|bibEntry
operator|.
name|setField
argument_list|(
name|StandardField
operator|.
name|YEAR
argument_list|,
literal|"1993"
argument_list|)
expr_stmt|;
name|assertThrows
argument_list|(
name|OfflineLockException
operator|.
name|class
argument_list|,
parameter_list|()
lambda|->
name|dbmsProcessor
operator|.
name|updateEntry
argument_list|(
name|bibEntry
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|ParameterizedTest
annotation|@
name|MethodSource
argument_list|(
literal|"getTestingDatabaseSystems"
argument_list|)
DECL|method|testUpdateEqualEntry (DBMSType dbmsType, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
name|void
name|testUpdateEqualEntry
parameter_list|(
name|DBMSType
name|dbmsType
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
throws|throws
name|OfflineLockException
throws|,
name|SQLException
block|{
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|BibEntry
name|expectedBibEntry
init|=
name|getBibEntryExample
argument_list|()
decl_stmt|;
name|dbmsProcessor
operator|.
name|insertEntry
argument_list|(
name|expectedBibEntry
argument_list|)
expr_stmt|;
comment|//simulate older version
name|expectedBibEntry
operator|.
name|getSharedBibEntryData
argument_list|()
operator|.
name|setVersion
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|dbmsProcessor
operator|.
name|updateEntry
argument_list|(
name|expectedBibEntry
argument_list|)
expr_stmt|;
name|Optional
argument_list|<
name|BibEntry
argument_list|>
name|actualBibEntryOptional
init|=
name|dbmsProcessor
operator|.
name|getSharedEntry
argument_list|(
name|expectedBibEntry
operator|.
name|getSharedBibEntryData
argument_list|()
operator|.
name|getSharedID
argument_list|()
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|expectedBibEntry
argument_list|,
name|actualBibEntryOptional
operator|.
name|get
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|ParameterizedTest
annotation|@
name|MethodSource
argument_list|(
literal|"getTestingDatabaseSystems"
argument_list|)
DECL|method|testRemoveEntry (DBMSType dbmsType, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
name|void
name|testRemoveEntry
parameter_list|(
name|DBMSType
name|dbmsType
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
throws|throws
name|SQLException
block|{
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|BibEntry
name|bibEntry
init|=
name|getBibEntryExample
argument_list|()
decl_stmt|;
name|dbmsProcessor
operator|.
name|insertEntry
argument_list|(
name|bibEntry
argument_list|)
expr_stmt|;
name|dbmsProcessor
operator|.
name|removeEntry
argument_list|(
name|bibEntry
argument_list|)
expr_stmt|;
try|try
init|(
name|ResultSet
name|resultSet
init|=
name|selectFrom
argument_list|(
literal|"ENTRY"
argument_list|,
name|dbmsConnection
argument_list|,
name|dbmsProcessor
argument_list|)
init|)
block|{
name|assertFalse
argument_list|(
name|resultSet
operator|.
name|next
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|ParameterizedTest
annotation|@
name|MethodSource
argument_list|(
literal|"getTestingDatabaseSystems"
argument_list|)
DECL|method|testGetSharedEntries (DBMSType dbmsType, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
name|void
name|testGetSharedEntries
parameter_list|(
name|DBMSType
name|dbmsType
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
throws|throws
name|SQLException
block|{
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|BibEntry
name|bibEntry
init|=
name|getBibEntryExampleWithEmptyFields
argument_list|()
decl_stmt|;
name|dbmsProcessor
operator|.
name|insertEntry
argument_list|(
name|bibEntry
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|BibEntry
argument_list|>
name|expectedEntries
init|=
name|Arrays
operator|.
name|asList
argument_list|(
name|bibEntry
argument_list|)
decl_stmt|;
name|List
argument_list|<
name|BibEntry
argument_list|>
name|actualEntries
init|=
name|dbmsProcessor
operator|.
name|getSharedEntries
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
name|expectedEntries
argument_list|,
name|actualEntries
argument_list|)
expr_stmt|;
block|}
annotation|@
name|ParameterizedTest
annotation|@
name|MethodSource
argument_list|(
literal|"getTestingDatabaseSystems"
argument_list|)
DECL|method|testGetSharedEntry (DBMSType dbmsType, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
name|void
name|testGetSharedEntry
parameter_list|(
name|DBMSType
name|dbmsType
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
throws|throws
name|SQLException
block|{
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|BibEntry
name|expectedBibEntry
init|=
name|getBibEntryExampleWithEmptyFields
argument_list|()
decl_stmt|;
name|dbmsProcessor
operator|.
name|insertEntry
argument_list|(
name|expectedBibEntry
argument_list|)
expr_stmt|;
name|Optional
argument_list|<
name|BibEntry
argument_list|>
name|actualBibEntryOptional
init|=
name|dbmsProcessor
operator|.
name|getSharedEntry
argument_list|(
name|expectedBibEntry
operator|.
name|getSharedBibEntryData
argument_list|()
operator|.
name|getSharedID
argument_list|()
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|expectedBibEntry
argument_list|,
name|actualBibEntryOptional
operator|.
name|get
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|ParameterizedTest
annotation|@
name|MethodSource
argument_list|(
literal|"getTestingDatabaseSystems"
argument_list|)
DECL|method|testGetNotExistingSharedEntry (DBMSType dbmsType, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
name|void
name|testGetNotExistingSharedEntry
parameter_list|(
name|DBMSType
name|dbmsType
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
throws|throws
name|SQLException
block|{
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|Optional
argument_list|<
name|BibEntry
argument_list|>
name|actualBibEntryOptional
init|=
name|dbmsProcessor
operator|.
name|getSharedEntry
argument_list|(
literal|1
argument_list|)
decl_stmt|;
name|assertFalse
argument_list|(
name|actualBibEntryOptional
operator|.
name|isPresent
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|ParameterizedTest
annotation|@
name|MethodSource
argument_list|(
literal|"getTestingDatabaseSystems"
argument_list|)
DECL|method|testGetSharedIDVersionMapping (DBMSType dbmsType, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
name|void
name|testGetSharedIDVersionMapping
parameter_list|(
name|DBMSType
name|dbmsType
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
throws|throws
name|OfflineLockException
throws|,
name|SQLException
block|{
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|BibEntry
name|firstEntry
init|=
name|getBibEntryExample
argument_list|()
decl_stmt|;
name|BibEntry
name|secondEntry
init|=
name|getBibEntryExample
argument_list|()
decl_stmt|;
name|dbmsProcessor
operator|.
name|insertEntry
argument_list|(
name|firstEntry
argument_list|)
expr_stmt|;
name|dbmsProcessor
operator|.
name|insertEntry
argument_list|(
name|secondEntry
argument_list|)
expr_stmt|;
name|dbmsProcessor
operator|.
name|updateEntry
argument_list|(
name|secondEntry
argument_list|)
expr_stmt|;
name|Map
argument_list|<
name|Integer
argument_list|,
name|Integer
argument_list|>
name|expectedIDVersionMap
init|=
operator|new
name|HashMap
argument_list|<>
argument_list|()
decl_stmt|;
name|expectedIDVersionMap
operator|.
name|put
argument_list|(
name|firstEntry
operator|.
name|getSharedBibEntryData
argument_list|()
operator|.
name|getSharedID
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|expectedIDVersionMap
operator|.
name|put
argument_list|(
name|secondEntry
operator|.
name|getSharedBibEntryData
argument_list|()
operator|.
name|getSharedID
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|Map
argument_list|<
name|Integer
argument_list|,
name|Integer
argument_list|>
name|actualIDVersionMap
init|=
name|dbmsProcessor
operator|.
name|getSharedIDVersionMapping
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
name|expectedIDVersionMap
argument_list|,
name|actualIDVersionMap
argument_list|)
expr_stmt|;
block|}
annotation|@
name|ParameterizedTest
annotation|@
name|MethodSource
argument_list|(
literal|"getTestingDatabaseSystems"
argument_list|)
DECL|method|testGetSharedMetaData (DBMSType dbmsType, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
name|void
name|testGetSharedMetaData
parameter_list|(
name|DBMSType
name|dbmsType
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
throws|throws
name|SQLException
block|{
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|insertMetaData
argument_list|(
literal|"databaseType"
argument_list|,
literal|"bibtex;"
argument_list|,
name|dbmsConnection
argument_list|,
name|dbmsProcessor
argument_list|)
expr_stmt|;
name|insertMetaData
argument_list|(
literal|"protectedFlag"
argument_list|,
literal|"true;"
argument_list|,
name|dbmsConnection
argument_list|,
name|dbmsProcessor
argument_list|)
expr_stmt|;
name|insertMetaData
argument_list|(
literal|"saveActions"
argument_list|,
literal|"enabled;\nauthor[capitalize,html_to_latex]\ntitle[title_case]\n;"
argument_list|,
name|dbmsConnection
argument_list|,
name|dbmsProcessor
argument_list|)
expr_stmt|;
name|insertMetaData
argument_list|(
literal|"saveOrderConfig"
argument_list|,
literal|"specified;author;false;title;false;year;true;"
argument_list|,
name|dbmsConnection
argument_list|,
name|dbmsProcessor
argument_list|)
expr_stmt|;
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|expectedMetaData
init|=
name|getMetaDataExample
argument_list|()
decl_stmt|;
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|actualMetaData
init|=
name|dbmsProcessor
operator|.
name|getSharedMetaData
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
name|expectedMetaData
argument_list|,
name|actualMetaData
argument_list|)
expr_stmt|;
block|}
annotation|@
name|ParameterizedTest
annotation|@
name|MethodSource
argument_list|(
literal|"getTestingDatabaseSystems"
argument_list|)
DECL|method|testSetSharedMetaData (DBMSType dbmsType, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
name|void
name|testSetSharedMetaData
parameter_list|(
name|DBMSType
name|dbmsType
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
throws|throws
name|SQLException
block|{
name|dbmsProcessor
operator|.
name|setupSharedDatabase
argument_list|()
expr_stmt|;
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|expectedMetaData
init|=
name|getMetaDataExample
argument_list|()
decl_stmt|;
name|dbmsProcessor
operator|.
name|setSharedMetaData
argument_list|(
name|expectedMetaData
argument_list|)
expr_stmt|;
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|actualMetaData
init|=
name|dbmsProcessor
operator|.
name|getSharedMetaData
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
name|expectedMetaData
argument_list|,
name|actualMetaData
argument_list|)
expr_stmt|;
block|}
DECL|method|getMetaDataExample ()
specifier|private
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|getMetaDataExample
parameter_list|()
block|{
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|expectedMetaData
init|=
operator|new
name|HashMap
argument_list|<>
argument_list|()
decl_stmt|;
name|expectedMetaData
operator|.
name|put
argument_list|(
literal|"databaseType"
argument_list|,
literal|"bibtex;"
argument_list|)
expr_stmt|;
name|expectedMetaData
operator|.
name|put
argument_list|(
literal|"protectedFlag"
argument_list|,
literal|"true;"
argument_list|)
expr_stmt|;
name|expectedMetaData
operator|.
name|put
argument_list|(
literal|"saveActions"
argument_list|,
literal|"enabled;\nauthor[capitalize,html_to_latex]\ntitle[title_case]\n;"
argument_list|)
expr_stmt|;
name|expectedMetaData
operator|.
name|put
argument_list|(
literal|"saveOrderConfig"
argument_list|,
literal|"specified;author;false;title;false;year;true;"
argument_list|)
expr_stmt|;
return|return
name|expectedMetaData
return|;
block|}
DECL|method|getBibEntryExampleWithEmptyFields ()
specifier|private
name|BibEntry
name|getBibEntryExampleWithEmptyFields
parameter_list|()
block|{
name|BibEntry
name|bibEntry
init|=
operator|new
name|BibEntry
argument_list|()
decl_stmt|;
name|bibEntry
operator|.
name|setField
argument_list|(
name|StandardField
operator|.
name|AUTHOR
argument_list|,
literal|"Author"
argument_list|)
expr_stmt|;
name|bibEntry
operator|.
name|setField
argument_list|(
name|StandardField
operator|.
name|TITLE
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|bibEntry
operator|.
name|setField
argument_list|(
name|StandardField
operator|.
name|YEAR
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|bibEntry
operator|.
name|getSharedBibEntryData
argument_list|()
operator|.
name|setSharedID
argument_list|(
literal|1
argument_list|)
expr_stmt|;
return|return
name|bibEntry
return|;
block|}
DECL|method|getBibEntryExample ()
specifier|private
name|BibEntry
name|getBibEntryExample
parameter_list|()
block|{
name|BibEntry
name|bibEntry
init|=
operator|new
name|BibEntry
argument_list|(
name|StandardEntryType
operator|.
name|InProceedings
argument_list|)
decl_stmt|;
name|bibEntry
operator|.
name|setField
argument_list|(
name|StandardField
operator|.
name|AUTHOR
argument_list|,
literal|"Wirthlin, Michael J and Hutchings, Brad L and Gilson, Kent L"
argument_list|)
expr_stmt|;
name|bibEntry
operator|.
name|setField
argument_list|(
name|StandardField
operator|.
name|TITLE
argument_list|,
literal|"The nano processor: a low resource reconfigurable processor"
argument_list|)
expr_stmt|;
name|bibEntry
operator|.
name|setField
argument_list|(
name|StandardField
operator|.
name|BOOKTITLE
argument_list|,
literal|"FPGAs for Custom Computing Machines, 1994. Proceedings. IEEE Workshop on"
argument_list|)
expr_stmt|;
name|bibEntry
operator|.
name|setField
argument_list|(
name|StandardField
operator|.
name|YEAR
argument_list|,
literal|"1994"
argument_list|)
expr_stmt|;
name|bibEntry
operator|.
name|setCiteKey
argument_list|(
literal|"nanoproc1994"
argument_list|)
expr_stmt|;
return|return
name|bibEntry
return|;
block|}
DECL|method|selectFrom (String table, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
specifier|private
name|ResultSet
name|selectFrom
parameter_list|(
name|String
name|table
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
block|{
try|try
block|{
return|return
name|dbmsConnection
operator|.
name|getConnection
argument_list|()
operator|.
name|createStatement
argument_list|()
operator|.
name|executeQuery
argument_list|(
literal|"SELECT * FROM "
operator|+
name|escape
argument_list|(
name|table
argument_list|,
name|dbmsProcessor
argument_list|)
argument_list|)
return|;
block|}
catch|catch
parameter_list|(
name|SQLException
name|e
parameter_list|)
block|{
name|fail
argument_list|(
name|e
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
return|return
literal|null
return|;
block|}
block|}
comment|// Oracle does not support multiple tuple insertion in one INSERT INTO command.
comment|// Therefore this function was defined to improve the readability and to keep the code short.
DECL|method|insertMetaData (String key, String value, DBMSConnection dbmsConnection, DBMSProcessor dbmsProcessor)
specifier|private
name|void
name|insertMetaData
parameter_list|(
name|String
name|key
parameter_list|,
name|String
name|value
parameter_list|,
name|DBMSConnection
name|dbmsConnection
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
block|{
try|try
block|{
name|dbmsConnection
operator|.
name|getConnection
argument_list|()
operator|.
name|createStatement
argument_list|()
operator|.
name|executeUpdate
argument_list|(
literal|"INSERT INTO "
operator|+
name|escape
argument_list|(
literal|"METADATA"
argument_list|,
name|dbmsProcessor
argument_list|)
operator|+
literal|"("
operator|+
name|escape
argument_list|(
literal|"KEY"
argument_list|,
name|dbmsProcessor
argument_list|)
operator|+
literal|", "
operator|+
name|escape
argument_list|(
literal|"VALUE"
argument_list|,
name|dbmsProcessor
argument_list|)
operator|+
literal|") VALUES("
operator|+
name|escapeValue
argument_list|(
name|key
argument_list|)
operator|+
literal|", "
operator|+
name|escapeValue
argument_list|(
name|value
argument_list|)
operator|+
literal|")"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SQLException
name|e
parameter_list|)
block|{
name|fail
argument_list|(
name|e
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
DECL|method|escape (String expression, DBMSProcessor dbmsProcessor)
specifier|private
name|String
name|escape
parameter_list|(
name|String
name|expression
parameter_list|,
name|DBMSProcessor
name|dbmsProcessor
parameter_list|)
block|{
return|return
name|dbmsProcessor
operator|.
name|escape
argument_list|(
name|expression
argument_list|)
return|;
block|}
DECL|method|escapeValue (String value)
specifier|private
name|String
name|escapeValue
parameter_list|(
name|String
name|value
parameter_list|)
block|{
return|return
literal|"'"
operator|+
name|value
operator|+
literal|"'"
return|;
block|}
annotation|@
name|AfterEach
DECL|method|clear (DBMSConnection dbmsConnection)
name|void
name|clear
parameter_list|(
name|DBMSConnection
name|dbmsConnection
parameter_list|)
throws|throws
name|SQLException
block|{
name|TestManager
operator|.
name|clearTables
argument_list|(
name|dbmsConnection
argument_list|)
expr_stmt|;
block|}
block|}
end_class

end_unit

