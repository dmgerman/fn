begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  * Created on Jun 13, 2004  *  * To change the template for this generated file go to  * Window&gt;Preferences&gt;Java&gt;Code Generation&gt;Code and Comments  */
end_comment

begin_package
DECL|package|net.sf.jabref.imports
package|package
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|imports
package|;
end_package

begin_import
import|import
name|java
operator|.
name|awt
operator|.
name|GridBagConstraints
import|;
end_import

begin_import
import|import
name|java
operator|.
name|awt
operator|.
name|GridBagLayout
import|;
end_import

begin_import
import|import
name|java
operator|.
name|awt
operator|.
name|Insets
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|net
operator|.
name|HttpURLConnection
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Enumeration
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Hashtable
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Iterator
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|regex
operator|.
name|Matcher
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|regex
operator|.
name|Pattern
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|swing
operator|.
name|JOptionPane
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|swing
operator|.
name|JProgressBar
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|swing
operator|.
name|SwingUtilities
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|parsers
operator|.
name|ParserConfigurationException
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|parsers
operator|.
name|SAXParser
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|parsers
operator|.
name|SAXParserFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|httpclient
operator|.
name|HttpClient
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|httpclient
operator|.
name|HttpException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|httpclient
operator|.
name|methods
operator|.
name|GetMethod
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|SAXException
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|*
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|undo
operator|.
name|NamedCompound
import|;
end_import

begin_comment
comment|/**  * @author mspiegel  *  * To change the template for this generated type comment go to  * Window&gt;Preferences&gt;Java&gt;Code Generation&gt;Code and Comments  */
end_comment

begin_class
DECL|class|CiteSeerFetcher
specifier|public
class|class
name|CiteSeerFetcher
extends|extends
name|SidePaneComponent
block|{
DECL|field|CITESEER_HOST
specifier|final
name|String
name|CITESEER_HOST
init|=
literal|"citeseer.ist.psu.edu"
decl_stmt|;
DECL|field|PREFIX_URL
specifier|final
name|String
name|PREFIX_URL
init|=
literal|"http://"
operator|+
name|CITESEER_HOST
operator|+
literal|"/"
decl_stmt|;
DECL|field|PREFIX_IDENTIFIER
specifier|final
name|String
name|PREFIX_IDENTIFIER
init|=
literal|"oai:CiteSeerPSU:"
decl_stmt|;
DECL|field|OAI_HOST
specifier|final
name|String
name|OAI_HOST
init|=
literal|"http://cs1.ist.psu.edu/"
decl_stmt|;
DECL|field|OAI_URL
specifier|final
name|String
name|OAI_URL
init|=
name|OAI_HOST
operator|+
literal|"cgi-bin/oai.cgi?"
decl_stmt|;
DECL|field|OAI_ACTION
specifier|final
name|String
name|OAI_ACTION
init|=
literal|"verb=GetRecord"
decl_stmt|;
DECL|field|OAI_METADATAPREFIX
specifier|final
name|String
name|OAI_METADATAPREFIX
init|=
literal|"metadataPrefix=oai_citeseer"
decl_stmt|;
DECL|field|parserFactory
specifier|protected
name|SAXParserFactory
name|parserFactory
decl_stmt|;
DECL|field|saxParser
specifier|protected
name|SAXParser
name|saxParser
decl_stmt|;
DECL|field|citeseerCon
specifier|protected
name|HttpURLConnection
name|citeseerCon
decl_stmt|;
DECL|field|citeseerHttpClient
specifier|protected
name|HttpClient
name|citeseerHttpClient
decl_stmt|;
DECL|field|citationFetcherActive
name|boolean
name|citationFetcherActive
decl_stmt|;
DECL|field|importFetcherActive
name|boolean
name|importFetcherActive
decl_stmt|;
DECL|field|panel
name|BasePanel
name|panel
decl_stmt|;
DECL|field|progressBar
name|JProgressBar
name|progressBar
decl_stmt|;
DECL|field|gbl
name|GridBagLayout
name|gbl
init|=
operator|new
name|GridBagLayout
argument_list|()
decl_stmt|;
DECL|field|con
name|GridBagConstraints
name|con
init|=
operator|new
name|GridBagConstraints
argument_list|()
decl_stmt|;
DECL|field|sidePaneManager
name|SidePaneManager
name|sidePaneManager
decl_stmt|;
DECL|method|CiteSeerFetcher (BasePanel panel_, SidePaneManager p0)
specifier|public
name|CiteSeerFetcher
parameter_list|(
name|BasePanel
name|panel_
parameter_list|,
name|SidePaneManager
name|p0
parameter_list|)
block|{
name|super
argument_list|(
name|p0
argument_list|)
expr_stmt|;
name|panel
operator|=
name|panel_
expr_stmt|;
name|sidePaneManager
operator|=
name|p0
expr_stmt|;
name|progressBar
operator|=
operator|new
name|JProgressBar
argument_list|()
expr_stmt|;
name|progressBar
operator|.
name|setValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|progressBar
operator|.
name|setMinimum
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|progressBar
operator|.
name|setMaximum
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|progressBar
operator|.
name|setStringPainted
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|setLayout
argument_list|(
name|gbl
argument_list|)
expr_stmt|;
name|SidePaneHeader
name|header
init|=
operator|new
name|SidePaneHeader
argument_list|(
literal|"CiteSeer Transfer"
argument_list|,
name|GUIGlobals
operator|.
name|fetchHourglassIcon
argument_list|,
name|this
argument_list|)
decl_stmt|;
name|con
operator|.
name|gridwidth
operator|=
name|GridBagConstraints
operator|.
name|REMAINDER
expr_stmt|;
name|con
operator|.
name|fill
operator|=
name|GridBagConstraints
operator|.
name|BOTH
expr_stmt|;
name|con
operator|.
name|weightx
operator|=
literal|1
expr_stmt|;
name|con
operator|.
name|insets
operator|=
operator|new
name|Insets
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gbl
operator|.
name|setConstraints
argument_list|(
name|header
argument_list|,
name|con
argument_list|)
expr_stmt|;
name|add
argument_list|(
name|header
argument_list|)
expr_stmt|;
name|con
operator|.
name|gridwidth
operator|=
literal|1
expr_stmt|;
name|con
operator|.
name|insets
operator|=
operator|new
name|Insets
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|con
operator|.
name|fill
operator|=
name|GridBagConstraints
operator|.
name|HORIZONTAL
expr_stmt|;
name|gbl
operator|.
name|setConstraints
argument_list|(
name|progressBar
argument_list|,
name|con
argument_list|)
expr_stmt|;
name|add
argument_list|(
name|progressBar
argument_list|)
expr_stmt|;
try|try
block|{
name|citationFetcherActive
operator|=
literal|false
expr_stmt|;
name|importFetcherActive
operator|=
literal|false
expr_stmt|;
name|parserFactory
operator|=
name|SAXParserFactory
operator|.
name|newInstance
argument_list|()
expr_stmt|;
name|saxParser
operator|=
name|parserFactory
operator|.
name|newSAXParser
argument_list|()
expr_stmt|;
name|citeseerHttpClient
operator|=
operator|new
name|HttpClient
argument_list|()
expr_stmt|;
name|citeseerHttpClient
operator|.
name|setConnectionTimeout
argument_list|(
literal|10000
argument_list|)
expr_stmt|;
comment|// 10 seconds
block|}
catch|catch
parameter_list|(
name|ParserConfigurationException
name|e
parameter_list|)
block|{
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SAXException
name|e
parameter_list|)
block|{
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
block|}
comment|/***********************************/
comment|/* Begin Inner Class Declarations */
comment|/* The inner classes are used to modify components, when not in the 	 * event-dispatching thread.  These are used to follow the "single-threaded 	 * rule", as defined here: http://java.sun.com/products/jfc/tsc/articles/threads/threads1.html 	 * 	 * 	 * I'm pretty sure the Dialog box invokers should remain as inner classes, 	 * but I can't decide whether or not to break the one-thread rule for the 	 * progress bar classes.  Because the search contains a locking-mechanism, 	 * activateFetcher() and deactivateFetcher(), there should only be at-most-one 	 * thread accessing the progress bar at any time. 	 */
DECL|class|ShowNoConnectionDialog
class|class
name|ShowNoConnectionDialog
implements|implements
name|Runnable
block|{
DECL|field|targetURL
specifier|protected
name|String
name|targetURL
init|=
literal|""
decl_stmt|;
DECL|method|ShowNoConnectionDialog (String URL)
name|ShowNoConnectionDialog
parameter_list|(
name|String
name|URL
parameter_list|)
block|{
name|targetURL
operator|=
name|URL
expr_stmt|;
block|}
DECL|method|run ()
specifier|public
name|void
name|run
parameter_list|()
block|{
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|panel
operator|.
name|frame
argument_list|()
argument_list|,
name|Globals
operator|.
name|lang
argument_list|(
literal|"I could not connect to host "
argument_list|)
operator|+
name|targetURL
operator|+
literal|".  "
operator|+
name|Globals
operator|.
name|lang
argument_list|(
literal|"Please check your network connection to this machine."
argument_list|)
argument_list|,
name|Globals
operator|.
name|lang
argument_list|(
literal|"CiteSeer Error"
argument_list|)
argument_list|,
name|JOptionPane
operator|.
name|ERROR_MESSAGE
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|ShowBadIdentifierDialog
class|class
name|ShowBadIdentifierDialog
implements|implements
name|Runnable
block|{
DECL|field|badURL
specifier|protected
name|String
name|badURL
init|=
literal|""
decl_stmt|;
DECL|field|rowNumber
specifier|protected
name|int
name|rowNumber
decl_stmt|;
DECL|method|ShowBadIdentifierDialog (String URL, int row)
name|ShowBadIdentifierDialog
parameter_list|(
name|String
name|URL
parameter_list|,
name|int
name|row
parameter_list|)
block|{
name|badURL
operator|=
name|URL
expr_stmt|;
name|rowNumber
operator|=
name|row
expr_stmt|;
block|}
DECL|method|run ()
specifier|public
name|void
name|run
parameter_list|()
block|{
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|panel
operator|.
name|frame
argument_list|()
argument_list|,
name|Globals
operator|.
name|lang
argument_list|(
literal|"I couldn't seem to find an entry associated with this URL"
argument_list|)
operator|+
literal|": \""
operator|+
name|badURL
operator|+
literal|'\"'
operator|+
name|Globals
operator|.
name|lang
argument_list|(
literal|" on entry number "
argument_list|)
operator|+
operator|(
name|rowNumber
operator|+
literal|1
operator|)
operator|+
literal|".  "
operator|+
name|Globals
operator|.
name|lang
argument_list|(
literal|"Please refer to the JabRef help manual on using the CiteSeer tools."
argument_list|)
argument_list|,
name|Globals
operator|.
name|lang
argument_list|(
literal|"CiteSeer Error"
argument_list|)
argument_list|,
name|JOptionPane
operator|.
name|ERROR_MESSAGE
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|ShowBadURLDialog
class|class
name|ShowBadURLDialog
implements|implements
name|Runnable
block|{
DECL|field|badURL
specifier|protected
name|String
name|badURL
init|=
literal|""
decl_stmt|;
DECL|field|rowNumber
specifier|protected
name|int
name|rowNumber
decl_stmt|;
DECL|method|ShowBadURLDialog (String URL, int row)
name|ShowBadURLDialog
parameter_list|(
name|String
name|URL
parameter_list|,
name|int
name|row
parameter_list|)
block|{
name|badURL
operator|=
name|URL
expr_stmt|;
name|rowNumber
operator|=
name|row
expr_stmt|;
block|}
DECL|method|run ()
specifier|public
name|void
name|run
parameter_list|()
block|{
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|panel
operator|.
name|frame
argument_list|()
argument_list|,
name|Globals
operator|.
name|lang
argument_list|(
literal|"I couldn't parse the following URL"
argument_list|)
operator|+
literal|": \""
operator|+
name|badURL
operator|+
literal|'\"'
operator|+
name|Globals
operator|.
name|lang
argument_list|(
literal|" on entry number "
argument_list|)
operator|+
operator|(
name|rowNumber
operator|+
literal|1
operator|)
operator|+
literal|".  "
operator|+
name|Globals
operator|.
name|lang
argument_list|(
literal|"Please refer to the JabRef help manual on using the CiteSeer tools."
argument_list|)
argument_list|,
name|Globals
operator|.
name|lang
argument_list|(
literal|"CiteSeer Error"
argument_list|)
argument_list|,
name|JOptionPane
operator|.
name|ERROR_MESSAGE
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|ShowMissingURLDialog
class|class
name|ShowMissingURLDialog
implements|implements
name|Runnable
block|{
DECL|field|rowNumber
specifier|protected
name|int
name|rowNumber
decl_stmt|;
DECL|method|ShowMissingURLDialog (int row)
name|ShowMissingURLDialog
parameter_list|(
name|int
name|row
parameter_list|)
block|{
name|rowNumber
operator|=
name|row
expr_stmt|;
block|}
DECL|method|run ()
specifier|public
name|void
name|run
parameter_list|()
block|{
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|panel
operator|.
name|frame
argument_list|()
argument_list|,
name|Globals
operator|.
name|lang
argument_list|(
literal|"The URL field appears to be empty on entry number "
argument_list|)
operator|+
operator|(
name|rowNumber
operator|+
literal|1
operator|)
operator|+
literal|".  "
operator|+
name|Globals
operator|.
name|lang
argument_list|(
literal|"Please refer to the JabRef help manual on using the CiteSeer tools."
argument_list|)
argument_list|,
name|Globals
operator|.
name|lang
argument_list|(
literal|"CiteSeer Error"
argument_list|)
argument_list|,
name|JOptionPane
operator|.
name|ERROR_MESSAGE
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|UpdateProgressBarMaximum
class|class
name|UpdateProgressBarMaximum
implements|implements
name|Runnable
block|{
DECL|field|maximum
specifier|protected
name|int
name|maximum
decl_stmt|;
DECL|method|UpdateProgressBarMaximum (int newValue)
name|UpdateProgressBarMaximum
parameter_list|(
name|int
name|newValue
parameter_list|)
block|{
name|maximum
operator|=
name|newValue
expr_stmt|;
block|}
DECL|method|run ()
specifier|public
name|void
name|run
parameter_list|()
block|{
name|progressBar
operator|.
name|setMaximum
argument_list|(
name|maximum
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|InitializeProgressBar
class|class
name|InitializeProgressBar
implements|implements
name|Runnable
block|{
DECL|method|run ()
specifier|public
name|void
name|run
parameter_list|()
block|{
name|progressBar
operator|.
name|setValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|progressBar
operator|.
name|setMinimum
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|progressBar
operator|.
name|setMaximum
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|progressBar
operator|.
name|setString
argument_list|(
literal|null
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|UpdateProgressBarValue
class|class
name|UpdateProgressBarValue
implements|implements
name|Runnable
block|{
DECL|field|counter
specifier|protected
name|int
name|counter
decl_stmt|;
DECL|method|UpdateProgressBarValue (int newValue)
name|UpdateProgressBarValue
parameter_list|(
name|int
name|newValue
parameter_list|)
block|{
name|counter
operator|=
name|newValue
expr_stmt|;
block|}
DECL|method|run ()
specifier|public
name|void
name|run
parameter_list|()
block|{
name|progressBar
operator|.
name|setValue
argument_list|(
name|counter
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* End Inner Class Declarations */
comment|/***********************************/
DECL|method|activateCitationFetcher ()
specifier|synchronized
specifier|public
name|boolean
name|activateCitationFetcher
parameter_list|()
block|{
if|if
condition|(
name|citationFetcherActive
operator|==
literal|true
condition|)
block|{
return|return
operator|(
literal|false
operator|)
return|;
block|}
else|else
block|{
name|citationFetcherActive
operator|=
literal|true
expr_stmt|;
return|return
operator|(
literal|true
operator|)
return|;
block|}
block|}
DECL|method|deactivateCitationFetcher ()
specifier|synchronized
specifier|public
name|void
name|deactivateCitationFetcher
parameter_list|()
block|{
name|citationFetcherActive
operator|=
literal|false
expr_stmt|;
block|}
DECL|method|activateImportFetcher ()
specifier|synchronized
specifier|public
name|boolean
name|activateImportFetcher
parameter_list|()
block|{
if|if
condition|(
name|importFetcherActive
operator|==
literal|true
condition|)
block|{
return|return
operator|(
literal|false
operator|)
return|;
block|}
else|else
block|{
name|importFetcherActive
operator|=
literal|true
expr_stmt|;
return|return
operator|(
literal|true
operator|)
return|;
block|}
block|}
DECL|method|deactivateImportFetcher ()
specifier|synchronized
specifier|public
name|void
name|deactivateImportFetcher
parameter_list|()
block|{
name|importFetcherActive
operator|=
literal|false
expr_stmt|;
block|}
DECL|method|beginImportCiteSeerProgress ()
specifier|public
name|void
name|beginImportCiteSeerProgress
parameter_list|()
block|{
name|progressBar
operator|.
name|setIndeterminate
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|progressBar
operator|.
name|setString
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|sidePaneManager
operator|.
name|ensureVisible
argument_list|(
literal|"CiteSeerProgress"
argument_list|)
expr_stmt|;
block|}
DECL|method|endImportCiteSeerProgress ()
specifier|public
name|void
name|endImportCiteSeerProgress
parameter_list|()
block|{
name|progressBar
operator|.
name|setIndeterminate
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|progressBar
operator|.
name|setMinimum
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|progressBar
operator|.
name|setMaximum
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|progressBar
operator|.
name|setValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
comment|//	    progressBar.setString(null);
block|}
comment|/** 	 * @param newDatabase 	 * @param targetDatabase 	 */
DECL|method|populate (BibtexDatabase newDatabase, BibtexDatabase targetDatabase)
specifier|public
name|void
name|populate
parameter_list|(
name|BibtexDatabase
name|newDatabase
parameter_list|,
name|BibtexDatabase
name|targetDatabase
parameter_list|)
block|{
name|Iterator
name|targetIterator
init|=
name|targetDatabase
operator|.
name|getKeySet
argument_list|()
operator|.
name|iterator
argument_list|()
decl_stmt|;
name|boolean
name|abortOperation
init|=
literal|false
decl_stmt|;
name|String
name|currentKey
decl_stmt|;
name|BibtexEntry
name|currentEntry
decl_stmt|;
name|Enumeration
name|newEntryEnum
decl_stmt|;
name|Hashtable
name|citationHashTable
init|=
operator|new
name|Hashtable
argument_list|()
decl_stmt|;
name|InitializeProgressBar
name|initializeProgressBar
init|=
operator|new
name|InitializeProgressBar
argument_list|()
decl_stmt|;
name|SwingUtilities
operator|.
name|invokeLater
argument_list|(
name|initializeProgressBar
argument_list|)
expr_stmt|;
while|while
condition|(
name|targetIterator
operator|.
name|hasNext
argument_list|()
operator|&&
operator|!
name|abortOperation
condition|)
block|{
name|currentKey
operator|=
operator|(
name|String
operator|)
name|targetIterator
operator|.
name|next
argument_list|()
expr_stmt|;
name|currentEntry
operator|=
name|targetDatabase
operator|.
name|getEntryById
argument_list|(
name|currentKey
argument_list|)
expr_stmt|;
name|abortOperation
operator|=
name|generateIdentifierList
argument_list|(
name|currentEntry
argument_list|,
name|citationHashTable
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|citationHashTable
operator|.
name|size
argument_list|()
operator|>
literal|0
condition|)
block|{
name|UpdateProgressBarMaximum
name|updateMaximum
init|=
operator|new
name|UpdateProgressBarMaximum
argument_list|(
name|citationHashTable
operator|.
name|size
argument_list|()
argument_list|)
decl_stmt|;
name|SwingUtilities
operator|.
name|invokeLater
argument_list|(
name|updateMaximum
argument_list|)
expr_stmt|;
block|}
name|generateCitationList
argument_list|(
name|citationHashTable
argument_list|,
name|newDatabase
argument_list|)
expr_stmt|;
name|newEntryEnum
operator|=
name|citationHashTable
operator|.
name|elements
argument_list|()
expr_stmt|;
block|}
DECL|method|generateCitationList (Hashtable citationHashTable, BibtexDatabase database)
specifier|private
name|Hashtable
name|generateCitationList
parameter_list|(
name|Hashtable
name|citationHashTable
parameter_list|,
name|BibtexDatabase
name|database
parameter_list|)
block|{
try|try
block|{
name|NamedCompound
name|dummyNamedCompound
init|=
operator|new
name|NamedCompound
argument_list|(
literal|"Import Data from CiteSeer Database"
argument_list|)
decl_stmt|;
name|BooleanAssign
name|dummyBoolean
init|=
operator|new
name|BooleanAssign
argument_list|()
decl_stmt|;
if|if
condition|(
operator|(
name|citationHashTable
operator|!=
literal|null
operator|)
operator|&&
operator|(
name|citationHashTable
operator|.
name|size
argument_list|()
operator|>
literal|0
operator|)
condition|)
block|{
name|int
name|citationCounter
init|=
literal|0
decl_stmt|;
for|for
control|(
name|Enumeration
name|e
init|=
name|citationHashTable
operator|.
name|keys
argument_list|()
init|;
name|e
operator|.
name|hasMoreElements
argument_list|()
condition|;
control|)
block|{
name|String
name|key
init|=
operator|(
name|String
operator|)
name|e
operator|.
name|nextElement
argument_list|()
decl_stmt|;
name|String
name|id
init|=
name|Util
operator|.
name|createId
argument_list|(
name|BibtexEntryType
operator|.
name|ARTICLE
argument_list|,
name|database
argument_list|)
decl_stmt|;
name|BibtexEntry
name|newEntry
init|=
operator|new
name|BibtexEntry
argument_list|(
name|id
argument_list|)
decl_stmt|;
name|StringBuffer
name|citeseerURLString
init|=
operator|new
name|StringBuffer
argument_list|()
decl_stmt|;
name|citeseerURLString
operator|.
name|append
argument_list|(
name|OAI_URL
argument_list|)
expr_stmt|;
name|citeseerURLString
operator|.
name|append
argument_list|(
name|OAI_ACTION
argument_list|)
expr_stmt|;
name|citeseerURLString
operator|.
name|append
argument_list|(
literal|"&"
operator|+
name|OAI_METADATAPREFIX
argument_list|)
expr_stmt|;
name|citeseerURLString
operator|.
name|append
argument_list|(
literal|"&"
operator|+
literal|"identifier="
operator|+
name|key
argument_list|)
expr_stmt|;
name|GetMethod
name|citeseerMethod
init|=
operator|new
name|GetMethod
argument_list|(
name|citeseerURLString
operator|.
name|toString
argument_list|()
argument_list|)
decl_stmt|;
name|citeseerHttpClient
operator|.
name|executeMethod
argument_list|(
name|citeseerMethod
argument_list|)
expr_stmt|;
name|saxParser
operator|.
name|parse
argument_list|(
name|citeseerMethod
operator|.
name|getResponseBodyAsStream
argument_list|()
argument_list|,
operator|new
name|CiteSeerUndoHandler
argument_list|(
name|dummyNamedCompound
argument_list|,
name|newEntry
argument_list|,
name|panel
argument_list|,
name|dummyBoolean
argument_list|)
argument_list|)
expr_stmt|;
name|citeseerMethod
operator|.
name|releaseConnection
argument_list|()
expr_stmt|;
name|database
operator|.
name|insertEntry
argument_list|(
name|newEntry
argument_list|)
expr_stmt|;
name|citationCounter
operator|++
expr_stmt|;
name|UpdateProgressBarValue
name|updateValue
init|=
operator|new
name|UpdateProgressBarValue
argument_list|(
name|citationCounter
argument_list|)
decl_stmt|;
name|SwingUtilities
operator|.
name|invokeLater
argument_list|(
name|updateValue
argument_list|)
expr_stmt|;
block|}
block|}
block|}
catch|catch
parameter_list|(
name|HttpException
name|e
parameter_list|)
block|{
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"HttpException: "
operator|+
name|e
operator|.
name|getReason
argument_list|()
argument_list|)
expr_stmt|;
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SAXException
name|e
parameter_list|)
block|{
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"SAXException: "
operator|+
name|e
operator|.
name|getLocalizedMessage
argument_list|()
argument_list|)
expr_stmt|;
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
name|ShowNoConnectionDialog
name|dialog
init|=
operator|new
name|ShowNoConnectionDialog
argument_list|(
name|OAI_HOST
argument_list|)
decl_stmt|;
name|SwingUtilities
operator|.
name|invokeLater
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|KeyCollisionException
name|e
parameter_list|)
block|{
comment|// TODO Auto-generated catch block
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
return|return
name|citationHashTable
return|;
block|}
DECL|method|generateCanonicalNumber (BibtexEntry be)
specifier|public
name|String
name|generateCanonicalNumber
parameter_list|(
name|BibtexEntry
name|be
parameter_list|)
block|{
name|String
name|IDnumber
init|=
literal|null
decl_stmt|;
name|String
name|inputString
init|=
operator|(
name|String
operator|)
name|be
operator|.
name|getField
argument_list|(
literal|"url"
argument_list|)
decl_stmt|;
if|if
condition|(
name|inputString
operator|!=
literal|null
condition|)
block|{
name|Pattern
name|pattern
init|=
name|Pattern
operator|.
name|compile
argument_list|(
literal|"[0-9]+"
argument_list|)
decl_stmt|;
name|Matcher
name|matcher
init|=
name|pattern
operator|.
name|matcher
argument_list|(
name|inputString
argument_list|)
decl_stmt|;
if|if
condition|(
name|matcher
operator|.
name|find
argument_list|()
condition|)
block|{
name|IDnumber
operator|=
name|matcher
operator|.
name|group
argument_list|()
expr_stmt|;
block|}
block|}
return|return
operator|(
name|IDnumber
operator|)
return|;
block|}
DECL|method|generateCanonicalIdentifier (BibtexEntry be)
specifier|public
name|String
name|generateCanonicalIdentifier
parameter_list|(
name|BibtexEntry
name|be
parameter_list|)
block|{
name|String
name|canonID
init|=
literal|null
decl_stmt|;
name|String
name|IDnumber
init|=
name|generateCanonicalNumber
argument_list|(
name|be
argument_list|)
decl_stmt|;
if|if
condition|(
name|IDnumber
operator|!=
literal|null
condition|)
block|{
name|canonID
operator|=
name|PREFIX_IDENTIFIER
operator|+
name|IDnumber
expr_stmt|;
block|}
return|return
operator|(
name|canonID
operator|)
return|;
block|}
DECL|method|generateCanonicalURL (BibtexEntry be)
specifier|public
name|String
name|generateCanonicalURL
parameter_list|(
name|BibtexEntry
name|be
parameter_list|)
block|{
name|String
name|canonURL
init|=
literal|null
decl_stmt|;
name|String
name|IDnumber
init|=
name|generateCanonicalNumber
argument_list|(
name|be
argument_list|)
decl_stmt|;
if|if
condition|(
name|IDnumber
operator|!=
literal|null
condition|)
block|{
name|canonURL
operator|=
name|PREFIX_URL
operator|+
name|IDnumber
operator|+
literal|".html"
expr_stmt|;
block|}
return|return
operator|(
name|canonURL
operator|)
return|;
block|}
DECL|method|generateIdentifierList (BibtexEntry currentEntry, Hashtable citationHashTable)
specifier|private
name|boolean
name|generateIdentifierList
parameter_list|(
name|BibtexEntry
name|currentEntry
parameter_list|,
name|Hashtable
name|citationHashTable
parameter_list|)
block|{
name|boolean
name|abortOperation
init|=
literal|false
decl_stmt|;
name|String
name|identifier
init|=
name|generateCanonicalIdentifier
argument_list|(
name|currentEntry
argument_list|)
decl_stmt|;
try|try
block|{
if|if
condition|(
name|identifier
operator|!=
literal|null
condition|)
block|{
name|StringBuffer
name|citeseerURLString
init|=
operator|new
name|StringBuffer
argument_list|()
decl_stmt|;
name|citeseerURLString
operator|.
name|append
argument_list|(
name|OAI_URL
argument_list|)
expr_stmt|;
name|citeseerURLString
operator|.
name|append
argument_list|(
name|OAI_ACTION
argument_list|)
expr_stmt|;
name|citeseerURLString
operator|.
name|append
argument_list|(
literal|"&"
operator|+
name|OAI_METADATAPREFIX
argument_list|)
expr_stmt|;
name|citeseerURLString
operator|.
name|append
argument_list|(
literal|"&"
operator|+
literal|"identifier="
operator|+
name|identifier
argument_list|)
expr_stmt|;
name|GetMethod
name|citeseerMethod
init|=
operator|new
name|GetMethod
argument_list|(
name|citeseerURLString
operator|.
name|toString
argument_list|()
argument_list|)
decl_stmt|;
name|citeseerHttpClient
operator|.
name|executeMethod
argument_list|(
name|citeseerMethod
argument_list|)
expr_stmt|;
name|saxParser
operator|.
name|parse
argument_list|(
name|citeseerMethod
operator|.
name|getResponseBodyAsStream
argument_list|()
argument_list|,
operator|new
name|CiteSeerCitationHandler
argument_list|(
name|citationHashTable
argument_list|)
argument_list|)
expr_stmt|;
name|citeseerMethod
operator|.
name|releaseConnection
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|int
name|row
init|=
name|panel
operator|.
name|getTableModel
argument_list|()
operator|.
name|getNumberFromName
argument_list|(
name|currentEntry
operator|.
name|getId
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|currentEntry
operator|.
name|getField
argument_list|(
literal|"url"
argument_list|)
operator|==
literal|null
condition|)
block|{
name|ShowMissingURLDialog
name|dialog
init|=
operator|new
name|ShowMissingURLDialog
argument_list|(
name|row
argument_list|)
decl_stmt|;
name|SwingUtilities
operator|.
name|invokeLater
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ShowBadURLDialog
name|dialog
init|=
operator|new
name|ShowBadURLDialog
argument_list|(
operator|(
name|String
operator|)
name|currentEntry
operator|.
name|getField
argument_list|(
literal|"url"
argument_list|)
argument_list|,
name|row
argument_list|)
decl_stmt|;
name|SwingUtilities
operator|.
name|invokeLater
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
block|}
block|}
catch|catch
parameter_list|(
name|HttpException
name|e
parameter_list|)
block|{
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"HttpException: "
operator|+
name|e
operator|.
name|getReason
argument_list|()
argument_list|)
expr_stmt|;
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SAXException
name|e
parameter_list|)
block|{
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"SAXException: "
operator|+
name|e
operator|.
name|getLocalizedMessage
argument_list|()
argument_list|)
expr_stmt|;
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"IOException: "
operator|+
name|e
operator|.
name|getLocalizedMessage
argument_list|()
argument_list|)
expr_stmt|;
name|ShowNoConnectionDialog
name|dialog
init|=
operator|new
name|ShowNoConnectionDialog
argument_list|(
name|OAI_HOST
argument_list|)
decl_stmt|;
name|abortOperation
operator|=
literal|true
expr_stmt|;
name|SwingUtilities
operator|.
name|invokeLater
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|abortOperation
operator|)
return|;
block|}
comment|/** 	 * @param be 	 * 	 */
DECL|method|importCiteSeerEntry (BibtexEntry be, NamedCompound citeseerNC)
specifier|public
name|boolean
name|importCiteSeerEntry
parameter_list|(
name|BibtexEntry
name|be
parameter_list|,
name|NamedCompound
name|citeseerNC
parameter_list|)
block|{
name|SAXParserFactory
name|factory
init|=
name|SAXParserFactory
operator|.
name|newInstance
argument_list|()
decl_stmt|;
name|BooleanAssign
name|newValue
init|=
operator|new
name|BooleanAssign
argument_list|()
decl_stmt|;
name|String
name|identifier
init|=
name|generateCanonicalIdentifier
argument_list|(
name|be
argument_list|)
decl_stmt|;
try|try
block|{
if|if
condition|(
name|identifier
operator|!=
literal|null
condition|)
block|{
name|StringBuffer
name|citeseerURLString
init|=
operator|new
name|StringBuffer
argument_list|()
decl_stmt|;
name|citeseerURLString
operator|.
name|append
argument_list|(
name|OAI_URL
argument_list|)
expr_stmt|;
name|citeseerURLString
operator|.
name|append
argument_list|(
name|OAI_ACTION
argument_list|)
expr_stmt|;
name|citeseerURLString
operator|.
name|append
argument_list|(
literal|"&"
operator|+
name|OAI_METADATAPREFIX
argument_list|)
expr_stmt|;
name|citeseerURLString
operator|.
name|append
argument_list|(
literal|"&"
operator|+
literal|"identifier="
operator|+
name|identifier
argument_list|)
expr_stmt|;
name|GetMethod
name|citeseerMethod
init|=
operator|new
name|GetMethod
argument_list|(
name|citeseerURLString
operator|.
name|toString
argument_list|()
argument_list|)
decl_stmt|;
name|int
name|response
init|=
name|citeseerHttpClient
operator|.
name|executeMethod
argument_list|(
name|citeseerMethod
argument_list|)
decl_stmt|;
name|saxParser
operator|.
name|parse
argument_list|(
name|citeseerMethod
operator|.
name|getResponseBodyAsStream
argument_list|()
argument_list|,
operator|new
name|CiteSeerUndoHandler
argument_list|(
name|citeseerNC
argument_list|,
name|be
argument_list|,
name|panel
argument_list|,
name|newValue
argument_list|)
argument_list|)
expr_stmt|;
name|citeseerMethod
operator|.
name|releaseConnection
argument_list|()
expr_stmt|;
if|if
condition|(
name|newValue
operator|.
name|getValue
argument_list|()
operator|==
literal|false
condition|)
block|{
name|int
name|row
init|=
name|panel
operator|.
name|getTableModel
argument_list|()
operator|.
name|getNumberFromName
argument_list|(
name|be
operator|.
name|getId
argument_list|()
argument_list|)
decl_stmt|;
name|ShowBadIdentifierDialog
name|dialog
init|=
operator|new
name|ShowBadIdentifierDialog
argument_list|(
name|generateCanonicalURL
argument_list|(
name|be
argument_list|)
argument_list|,
name|row
argument_list|)
decl_stmt|;
name|SwingUtilities
operator|.
name|invokeLater
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|int
name|row
init|=
name|panel
operator|.
name|getTableModel
argument_list|()
operator|.
name|getNumberFromName
argument_list|(
name|be
operator|.
name|getId
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|be
operator|.
name|getField
argument_list|(
literal|"url"
argument_list|)
operator|==
literal|null
condition|)
block|{
name|ShowMissingURLDialog
name|dialog
init|=
operator|new
name|ShowMissingURLDialog
argument_list|(
name|row
argument_list|)
decl_stmt|;
name|SwingUtilities
operator|.
name|invokeLater
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ShowBadURLDialog
name|dialog
init|=
operator|new
name|ShowBadURLDialog
argument_list|(
operator|(
name|String
operator|)
name|be
operator|.
name|getField
argument_list|(
literal|"url"
argument_list|)
argument_list|,
name|row
argument_list|)
decl_stmt|;
name|SwingUtilities
operator|.
name|invokeLater
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
block|}
block|}
catch|catch
parameter_list|(
name|HttpException
name|e
parameter_list|)
block|{
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"HttpException: "
operator|+
name|e
operator|.
name|getReason
argument_list|()
argument_list|)
expr_stmt|;
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
name|ShowNoConnectionDialog
name|dialog
init|=
operator|new
name|ShowNoConnectionDialog
argument_list|(
name|OAI_HOST
argument_list|)
decl_stmt|;
name|SwingUtilities
operator|.
name|invokeLater
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SAXException
name|e
parameter_list|)
block|{
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"SAXException: "
operator|+
name|e
operator|.
name|getLocalizedMessage
argument_list|()
argument_list|)
expr_stmt|;
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
return|return
name|newValue
operator|.
name|getValue
argument_list|()
return|;
block|}
block|}
end_class

end_unit

