begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_package
DECL|package|net.sf.jabref.util
package|package
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|util
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|ByteArrayInputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|ByteArrayOutputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|File
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|FileReader
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|InputStreamReader
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|OutputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|StringWriter
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collection
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Iterator
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|LinkedList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|transform
operator|.
name|TransformerException
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|BibtexEntry
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|Globals
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|JabRefPreferences
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|imports
operator|.
name|BibtexParser
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|imports
operator|.
name|ParserResult
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jempbox
operator|.
name|impl
operator|.
name|XMLUtil
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jempbox
operator|.
name|xmp
operator|.
name|XMPMetadata
import|;
end_import

begin_import
import|import
name|org
operator|.
name|pdfbox
operator|.
name|exceptions
operator|.
name|COSVisitorException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|pdfbox
operator|.
name|pdmodel
operator|.
name|PDDocument
import|;
end_import

begin_import
import|import
name|org
operator|.
name|pdfbox
operator|.
name|pdmodel
operator|.
name|PDDocumentCatalog
import|;
end_import

begin_import
import|import
name|org
operator|.
name|pdfbox
operator|.
name|pdmodel
operator|.
name|common
operator|.
name|PDMetadata
import|;
end_import

begin_comment
comment|/**  * XMPUtils provide support for reading and writing BibTex data as XMP-Metadata  * in PDF-documents.  *   * @author Christopher Oezbek<oezi@oezi.de>  *   * @version $Revision$ ($Date$)  */
end_comment

begin_class
DECL|class|XMPUtil
specifier|public
class|class
name|XMPUtil
block|{
comment|/** 	 * Convenience method for readXMP(File). 	 *  	 * @param filename 	 *            The filename from which to open the file. 	 * @return BibtexEntryies found in the PDF or an empty list 	 * @throws IOException 	 */
DECL|method|readXMP (String filename)
specifier|public
specifier|static
name|List
name|readXMP
parameter_list|(
name|String
name|filename
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|readXMP
argument_list|(
operator|new
name|File
argument_list|(
name|filename
argument_list|)
argument_list|)
return|;
block|}
comment|/** 	 * Try to write the given BibTexEntry in the XMP-stream of the given 	 * PDF-file. 	 *  	 * Throws an IOException if the file cannot be read or written, so the user 	 * can remove a lock or cancel the operation. 	 *  	 * The method will overwrite existing BibTeX-XMP-data, but keep other 	 * existing metadata. 	 *  	 * This is a convenience method for writeXMP(File, BibtexEntry). 	 *  	 * @param filename 	 *            The filename from which to open the file. 	 * @param entry 	 *            The entry to write. 	 * @throws TransformerException 	 *             If the entry was malformed or unsupported. 	 * @throws IOException 	 *             If the file could not be written to or could not be found. 	 */
DECL|method|writeXMP (String filename, BibtexEntry entry)
specifier|public
specifier|static
name|void
name|writeXMP
parameter_list|(
name|String
name|filename
parameter_list|,
name|BibtexEntry
name|entry
parameter_list|)
throws|throws
name|IOException
throws|,
name|TransformerException
block|{
name|writeXMP
argument_list|(
operator|new
name|File
argument_list|(
name|filename
argument_list|)
argument_list|,
name|entry
argument_list|)
expr_stmt|;
block|}
comment|/** 	 * Try to read the given BibTexEntry from the XMP-stream of the given 	 * PDF-file. 	 *  	 * @param file 	 *            The file to read from. 	 *  	 * @throws IOException 	 *             Throws an IOException if the file cannot be read, so the user 	 *             than remove a lock or cancel the operation. 	 */
DECL|method|readXMP (File file)
specifier|public
specifier|static
name|List
name|readXMP
parameter_list|(
name|File
name|file
parameter_list|)
throws|throws
name|IOException
block|{
name|XMPMetadata
name|meta
init|=
name|readRawXMP
argument_list|(
name|file
argument_list|)
decl_stmt|;
comment|// If we did not find any metadata, there is nothing to return.
if|if
condition|(
name|meta
operator|==
literal|null
condition|)
return|return
literal|null
return|;
name|List
name|schemas
init|=
name|meta
operator|.
name|getSchemasByNamespaceURI
argument_list|(
name|XMPSchemaBibtex
operator|.
name|NAMESPACE
argument_list|)
decl_stmt|;
name|List
name|result
init|=
operator|new
name|LinkedList
argument_list|()
decl_stmt|;
name|Iterator
name|it
init|=
name|schemas
operator|.
name|iterator
argument_list|()
decl_stmt|;
while|while
condition|(
name|it
operator|.
name|hasNext
argument_list|()
condition|)
block|{
name|XMPSchemaBibtex
name|bib
init|=
operator|(
name|XMPSchemaBibtex
operator|)
name|it
operator|.
name|next
argument_list|()
decl_stmt|;
name|result
operator|.
name|add
argument_list|(
name|bib
operator|.
name|getBibtexEntry
argument_list|()
argument_list|)
expr_stmt|;
block|}
return|return
name|result
return|;
block|}
comment|/** 	 * Try to write the given BibTexEntry in the XMP-stream of the given 	 * PDF-file. 	 *  	 * Throws an IOException if the file cannot be read or written, so the user 	 * can remove a lock or cancel the operation. 	 *  	 * The method will overwrite existing BibTeX-XMP-data, but keep other 	 * existing metadata. 	 *  	 * This is a convenience method for writeXMP(File, Collection). 	 *  	 * @param file 	 *            The file to write to. 	 * @param entry 	 *            The entry to write. 	 * @throws TransformerException 	 *             If the entry was malformed or unsupported. 	 * @throws IOException 	 *             If the file could not be written to or could not be found. 	 */
DECL|method|writeXMP (File file, BibtexEntry entry)
specifier|public
specifier|static
name|void
name|writeXMP
parameter_list|(
name|File
name|file
parameter_list|,
name|BibtexEntry
name|entry
parameter_list|)
throws|throws
name|IOException
throws|,
name|TransformerException
block|{
name|List
name|l
init|=
operator|new
name|LinkedList
argument_list|()
decl_stmt|;
name|l
operator|.
name|add
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|writeXMP
argument_list|(
name|file
argument_list|,
name|l
argument_list|)
expr_stmt|;
block|}
comment|/** 	 * Write the given BibtexEntries as XMP-metadata text to the given stream. 	 *  	 * The text that is written to the stream contains a complete XMP-document. 	 *  	 * @param bibtexEntries 	 *            The BibtexEntries to write XMP-metadata for. 	 * @throws TransformerException 	 *             Thrown if the bibtexEntries could not transformed to XMP. 	 * @throws IOException 	 *             Thrown if an IOException occured while writing to the stream. 	 */
DECL|method|toXMP (Collection bibtexEntries, OutputStream outputStream)
specifier|public
specifier|static
name|void
name|toXMP
parameter_list|(
name|Collection
name|bibtexEntries
parameter_list|,
name|OutputStream
name|outputStream
parameter_list|)
throws|throws
name|IOException
throws|,
name|TransformerException
block|{
name|XMPMetadata
name|x
init|=
operator|new
name|XMPMetadata
argument_list|()
decl_stmt|;
name|Iterator
name|it
init|=
name|bibtexEntries
operator|.
name|iterator
argument_list|()
decl_stmt|;
while|while
condition|(
name|it
operator|.
name|hasNext
argument_list|()
condition|)
block|{
name|BibtexEntry
name|e
init|=
operator|(
name|BibtexEntry
operator|)
name|it
operator|.
name|next
argument_list|()
decl_stmt|;
name|XMPSchemaBibtex
name|schema
init|=
operator|new
name|XMPSchemaBibtex
argument_list|(
name|x
argument_list|)
decl_stmt|;
name|x
operator|.
name|addSchema
argument_list|(
name|schema
argument_list|)
expr_stmt|;
name|schema
operator|.
name|setBibtexEntry
argument_list|(
name|e
argument_list|)
expr_stmt|;
block|}
name|x
operator|.
name|save
argument_list|(
name|outputStream
argument_list|)
expr_stmt|;
block|}
comment|/** 	 * Convenience method for toXMP(Collection, OutputStream) returning a String 	 * containing the XMP-metadata of the given collection of BibtexEntries. 	 *  	 * The resulting metadata string is wrapped as a complete XMP-document. 	 *  	 * @param bibtexEntries 	 *            The BibtexEntries to return XMP-metadata for. 	 * @return The XMP representation of the given bibtexEntries. 	 * @throws TransformerException 	 *             Thrown if the bibtexEntries could not transformed to XMP. 	 */
DECL|method|toXMP (Collection bibtexEntries)
specifier|public
specifier|static
name|String
name|toXMP
parameter_list|(
name|Collection
name|bibtexEntries
parameter_list|)
throws|throws
name|TransformerException
block|{
try|try
block|{
name|ByteArrayOutputStream
name|bs
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|toXMP
argument_list|(
name|bibtexEntries
argument_list|,
name|bs
argument_list|)
expr_stmt|;
return|return
name|bs
operator|.
name|toString
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|TransformerException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
comment|/** 	 * Will read the XMPMetadata from the given pdf file, closing the file 	 * afterwards. 	 *  	 * @param file 	 *            The file to read the XMPMetadata from. 	 * @return The XMPMetadata object found in the file or null if none is 	 *         found. 	 * @throws IOException 	 */
DECL|method|readRawXMP (File file)
specifier|public
specifier|static
name|XMPMetadata
name|readRawXMP
parameter_list|(
name|File
name|file
parameter_list|)
throws|throws
name|IOException
block|{
name|PDDocument
name|document
init|=
literal|null
decl_stmt|;
try|try
block|{
name|document
operator|=
name|PDDocument
operator|.
name|load
argument_list|(
name|file
operator|.
name|getAbsoluteFile
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|document
operator|.
name|isEncrypted
argument_list|()
condition|)
block|{
throw|throw
operator|new
name|EncryptionNotSupportedException
argument_list|(
literal|"Error: Cannot read metadata from encrypted document."
argument_list|)
throw|;
block|}
name|PDDocumentCatalog
name|catalog
init|=
name|document
operator|.
name|getDocumentCatalog
argument_list|()
decl_stmt|;
name|PDMetadata
name|metaRaw
init|=
name|catalog
operator|.
name|getMetadata
argument_list|()
decl_stmt|;
if|if
condition|(
name|metaRaw
operator|==
literal|null
condition|)
block|{
return|return
literal|null
return|;
block|}
name|XMPMetadata
name|meta
init|=
operator|new
name|XMPMetadata
argument_list|(
name|XMLUtil
operator|.
name|parse
argument_list|(
name|metaRaw
operator|.
name|createInputStream
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|meta
operator|.
name|addXMLNSMapping
argument_list|(
name|XMPSchemaBibtex
operator|.
name|NAMESPACE
argument_list|,
name|XMPSchemaBibtex
operator|.
name|class
argument_list|)
expr_stmt|;
return|return
name|meta
return|;
block|}
finally|finally
block|{
if|if
condition|(
name|document
operator|!=
literal|null
condition|)
name|document
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
block|}
comment|/** 	 * Try to write the given BibTexEntry in the XMP-stream of the given 	 * PDF-file. 	 *  	 * Throws an IOException if the file cannot be read or written, so the user 	 * can remove a lock or cancel the operation. 	 *  	 * The method will overwrite existing BibTeX-XMP-data, but keep other 	 * existing metadata. 	 *  	 * @param file 	 *            The file to write the entries to. 	 * @param bibtexEntries 	 *            The entries to write to the file. 	 * @throws TransformerException 	 *             If the entry was malformed or unsupported. 	 * @throws IOException 	 *             If the file could not be written to or could not be found. 	 */
DECL|method|writeXMP (File file, Collection bibtexEntries)
specifier|public
specifier|static
name|void
name|writeXMP
parameter_list|(
name|File
name|file
parameter_list|,
name|Collection
name|bibtexEntries
parameter_list|)
throws|throws
name|IOException
throws|,
name|TransformerException
block|{
name|PDDocument
name|document
init|=
literal|null
decl_stmt|;
try|try
block|{
name|document
operator|=
name|PDDocument
operator|.
name|load
argument_list|(
name|file
operator|.
name|getAbsoluteFile
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|document
operator|.
name|isEncrypted
argument_list|()
condition|)
block|{
throw|throw
operator|new
name|EncryptionNotSupportedException
argument_list|(
literal|"Error: Cannot add metadata to encrypted document."
argument_list|)
throw|;
block|}
name|PDDocumentCatalog
name|catalog
init|=
name|document
operator|.
name|getDocumentCatalog
argument_list|()
decl_stmt|;
name|PDMetadata
name|metaRaw
init|=
name|catalog
operator|.
name|getMetadata
argument_list|()
decl_stmt|;
name|XMPMetadata
name|meta
decl_stmt|;
if|if
condition|(
name|metaRaw
operator|!=
literal|null
condition|)
block|{
name|meta
operator|=
operator|new
name|XMPMetadata
argument_list|(
name|XMLUtil
operator|.
name|parse
argument_list|(
name|metaRaw
operator|.
name|createInputStream
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|meta
operator|=
operator|new
name|XMPMetadata
argument_list|()
expr_stmt|;
block|}
name|meta
operator|.
name|addXMLNSMapping
argument_list|(
name|XMPSchemaBibtex
operator|.
name|NAMESPACE
argument_list|,
name|XMPSchemaBibtex
operator|.
name|class
argument_list|)
expr_stmt|;
comment|// Remove all current Bibtex-schemas
name|List
name|schemas
init|=
name|meta
operator|.
name|getSchemasByNamespaceURI
argument_list|(
name|XMPSchemaBibtex
operator|.
name|NAMESPACE
argument_list|)
decl_stmt|;
name|Iterator
name|it
init|=
name|schemas
operator|.
name|iterator
argument_list|()
decl_stmt|;
while|while
condition|(
name|it
operator|.
name|hasNext
argument_list|()
condition|)
block|{
name|XMPSchemaBibtex
name|bib
init|=
operator|(
name|XMPSchemaBibtex
operator|)
name|it
operator|.
name|next
argument_list|()
decl_stmt|;
name|bib
operator|.
name|getElement
argument_list|()
operator|.
name|getParentNode
argument_list|()
operator|.
name|removeChild
argument_list|(
name|bib
operator|.
name|getElement
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|it
operator|=
name|bibtexEntries
operator|.
name|iterator
argument_list|()
expr_stmt|;
while|while
condition|(
name|it
operator|.
name|hasNext
argument_list|()
condition|)
block|{
name|BibtexEntry
name|e
init|=
operator|(
name|BibtexEntry
operator|)
name|it
operator|.
name|next
argument_list|()
decl_stmt|;
name|XMPSchemaBibtex
name|bibtex
init|=
operator|new
name|XMPSchemaBibtex
argument_list|(
name|meta
argument_list|)
decl_stmt|;
name|meta
operator|.
name|addSchema
argument_list|(
name|bibtex
argument_list|)
expr_stmt|;
name|bibtex
operator|.
name|setBibtexEntry
argument_list|(
name|e
argument_list|)
expr_stmt|;
block|}
comment|// Save to stream and then input that stream to the PDF
name|ByteArrayOutputStream
name|os
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|meta
operator|.
name|save
argument_list|(
name|os
argument_list|)
expr_stmt|;
name|ByteArrayInputStream
name|is
init|=
operator|new
name|ByteArrayInputStream
argument_list|(
name|os
operator|.
name|toByteArray
argument_list|()
argument_list|)
decl_stmt|;
name|PDMetadata
name|metadataStream
init|=
operator|new
name|PDMetadata
argument_list|(
name|document
argument_list|,
name|is
argument_list|,
literal|false
argument_list|)
decl_stmt|;
name|catalog
operator|.
name|setMetadata
argument_list|(
name|metadataStream
argument_list|)
expr_stmt|;
comment|// Save
try|try
block|{
name|document
operator|.
name|save
argument_list|(
name|file
operator|.
name|getAbsolutePath
argument_list|()
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|COSVisitorException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|TransformerException
argument_list|(
literal|"Could not write XMP-metadata: "
operator|+
name|e
operator|.
name|getLocalizedMessage
argument_list|()
argument_list|)
throw|;
block|}
block|}
finally|finally
block|{
if|if
condition|(
name|document
operator|!=
literal|null
condition|)
block|{
name|document
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
block|}
block|}
comment|/** 	 * Print usage information for the command line tool xmpUtil. 	 *  	 * @see net.sf.jabref.util.XMUtil.main() 	 */
DECL|method|usage ()
specifier|protected
specifier|static
name|void
name|usage
parameter_list|()
block|{
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Read or write XMP-metadata from or to pdf file."
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Usage:"
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Read from PDF and print as bibtex:"
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"  xmpUtil<pdf>"
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Read from PDF and print raw XMP:"
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"  xmpUtil -x<pdf>"
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Write the entry in<bib> given by<key> to the PDF:"
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"  xmpUtil<key><bib><pdf>"
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Write all entries in<bib> to the PDF:"
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"  xmpUtil<bib><pdf>"
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"To report bugs visit http://jabref.sourceforge.net"
argument_list|)
expr_stmt|;
block|}
comment|/** 	 * Command-line tool for working with XMP-data. 	 *  	 * Read or write XMP-metadata from or to pdf file. 	 *  	 * Usage: 	 *<dl> 	 *<dd>Read from PDF and print as bibtex:</dd> 	 *<dt>xmpUtil PDF</dt> 	 *<dd>Read from PDF and print raw XMP:</dd> 	 *<dt>xmpUtil -x PDF</dt> 	 *<dd>Write the entry in BIB given by KEY to the PDF:</dd> 	 *<dt>xmpUtil KEY BIB PDF</dt> 	 *<dd>Write all entries in BIB to the PDF:</dd> 	 *<dt>xmpUtil BIB PDF</dt> 	 *</dl> 	 *  	 * @param args 	 *            Command line strings passed to utility. 	 * @throws IOException 	 *             If any of the given files could not be read or written. 	 * @throws TransformerException 	 *             If the given BibtexEntry is malformed. 	 */
DECL|method|main (String[] args)
specifier|public
specifier|static
name|void
name|main
parameter_list|(
name|String
index|[]
name|args
parameter_list|)
throws|throws
name|IOException
throws|,
name|TransformerException
block|{
comment|// Don't forget to initialize the preferences
if|if
condition|(
name|Globals
operator|.
name|prefs
operator|==
literal|null
condition|)
block|{
name|Globals
operator|.
name|prefs
operator|=
name|JabRefPreferences
operator|.
name|getInstance
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|args
operator|.
name|length
condition|)
block|{
case|case
literal|0
case|:
name|usage
argument_list|()
expr_stmt|;
break|break;
case|case
literal|1
case|:
block|{
if|if
condition|(
name|args
index|[
literal|0
index|]
operator|.
name|endsWith
argument_list|(
literal|".pdf"
argument_list|)
condition|)
block|{
comment|// Read from pdf and write as BibTex
name|List
name|l
init|=
name|XMPUtil
operator|.
name|readXMP
argument_list|(
operator|new
name|File
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|)
argument_list|)
decl_stmt|;
name|Iterator
name|it
init|=
name|l
operator|.
name|iterator
argument_list|()
decl_stmt|;
while|while
condition|(
name|it
operator|.
name|hasNext
argument_list|()
condition|)
block|{
name|BibtexEntry
name|e
init|=
operator|(
name|BibtexEntry
operator|)
name|it
operator|.
name|next
argument_list|()
decl_stmt|;
name|StringWriter
name|sw
init|=
operator|new
name|StringWriter
argument_list|()
decl_stmt|;
name|e
operator|.
name|write
argument_list|(
name|sw
argument_list|,
operator|new
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|export
operator|.
name|LatexFieldFormatter
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
name|sw
operator|.
name|getBuffer
argument_list|()
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|args
index|[
literal|0
index|]
operator|.
name|endsWith
argument_list|(
literal|".bib"
argument_list|)
condition|)
block|{
comment|// Read from bib and write as XMP
name|ParserResult
name|result
init|=
name|BibtexParser
operator|.
name|parse
argument_list|(
operator|new
name|FileReader
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|)
argument_list|)
decl_stmt|;
name|Collection
name|c
init|=
name|result
operator|.
name|getDatabase
argument_list|()
operator|.
name|getEntries
argument_list|()
decl_stmt|;
if|if
condition|(
name|c
operator|.
name|size
argument_list|()
operator|==
literal|0
condition|)
block|{
name|System
operator|.
name|err
operator|.
name|println
argument_list|(
literal|"Could not find BibtexEntry in "
operator|+
name|args
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
name|XMPUtil
operator|.
name|toXMP
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|usage
argument_list|()
expr_stmt|;
block|}
break|break;
block|}
case|case
literal|2
case|:
block|{
if|if
condition|(
name|args
index|[
literal|0
index|]
operator|.
name|equals
argument_list|(
literal|"-x"
argument_list|)
operator|&&
name|args
index|[
literal|1
index|]
operator|.
name|endsWith
argument_list|(
literal|".pdf"
argument_list|)
condition|)
block|{
comment|// Read from pdf and write as BibTex
name|XMPMetadata
name|meta
init|=
name|XMPUtil
operator|.
name|readRawXMP
argument_list|(
operator|new
name|File
argument_list|(
name|args
index|[
literal|1
index|]
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|meta
operator|==
literal|null
condition|)
block|{
name|System
operator|.
name|err
operator|.
name|println
argument_list|(
literal|"The given pdf does not contain any XMP-metadata."
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|XMLUtil
operator|.
name|save
argument_list|(
name|meta
operator|.
name|getXMPDocument
argument_list|()
argument_list|,
name|System
operator|.
name|out
argument_list|,
literal|"UTF-8"
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
if|if
condition|(
name|args
index|[
literal|0
index|]
operator|.
name|endsWith
argument_list|(
literal|".bib"
argument_list|)
operator|&&
name|args
index|[
literal|1
index|]
operator|.
name|endsWith
argument_list|(
literal|".pdf"
argument_list|)
condition|)
block|{
name|ParserResult
name|result
init|=
name|BibtexParser
operator|.
name|parse
argument_list|(
operator|new
name|FileReader
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|)
argument_list|)
decl_stmt|;
name|Collection
name|c
init|=
name|result
operator|.
name|getDatabase
argument_list|()
operator|.
name|getEntries
argument_list|()
decl_stmt|;
if|if
condition|(
name|c
operator|.
name|size
argument_list|()
operator|==
literal|0
condition|)
block|{
name|System
operator|.
name|err
operator|.
name|println
argument_list|(
literal|"Could not find BibtexEntry in "
operator|+
name|args
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|XMPUtil
operator|.
name|writeXMP
argument_list|(
operator|new
name|File
argument_list|(
name|args
index|[
literal|1
index|]
argument_list|)
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"XMP written."
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
name|usage
argument_list|()
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
if|if
condition|(
operator|!
name|args
index|[
literal|1
index|]
operator|.
name|endsWith
argument_list|(
literal|".bib"
argument_list|)
operator|&&
operator|!
name|args
index|[
literal|2
index|]
operator|.
name|endsWith
argument_list|(
literal|".pdf"
argument_list|)
condition|)
block|{
name|usage
argument_list|()
expr_stmt|;
break|break;
block|}
name|ParserResult
name|result
init|=
name|BibtexParser
operator|.
name|parse
argument_list|(
operator|new
name|FileReader
argument_list|(
name|args
index|[
literal|1
index|]
argument_list|)
argument_list|)
decl_stmt|;
name|BibtexEntry
name|e
init|=
name|result
operator|.
name|getDatabase
argument_list|()
operator|.
name|getEntryByKey
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
if|if
condition|(
name|e
operator|==
literal|null
condition|)
block|{
name|System
operator|.
name|err
operator|.
name|println
argument_list|(
literal|"Could not find BibtexEntry "
operator|+
name|args
index|[
literal|0
index|]
operator|+
literal|" in "
operator|+
name|args
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|XMPUtil
operator|.
name|writeXMP
argument_list|(
operator|new
name|File
argument_list|(
name|args
index|[
literal|2
index|]
argument_list|)
argument_list|,
name|e
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"XMP written."
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
default|default:
name|usage
argument_list|()
expr_stmt|;
block|}
block|}
block|}
end_class

end_unit

