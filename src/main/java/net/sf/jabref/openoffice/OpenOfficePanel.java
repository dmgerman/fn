begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  Copyright (C) 2003-2015 JabRef contributors.     This program is free software; you can redistribute it and/or modify     it under the terms of the GNU General Public License as published by     the Free Software Foundation; either version 2 of the License, or     (at your option) any later version.      This program is distributed in the hope that it will be useful,     but WITHOUT ANY WARRANTY; without even the implied warranty of     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the     GNU General Public License for more details.      You should have received a copy of the GNU General Public License along     with this program; if not, write to the Free Software Foundation, Inc.,     51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA. */
end_comment

begin_package
DECL|package|net.sf.jabref.openoffice
package|package
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|openoffice
package|;
end_package

begin_import
import|import
name|com
operator|.
name|jgoodies
operator|.
name|forms
operator|.
name|builder
operator|.
name|ButtonBarBuilder
import|;
end_import

begin_import
import|import
name|com
operator|.
name|jgoodies
operator|.
name|forms
operator|.
name|builder
operator|.
name|DefaultFormBuilder
import|;
end_import

begin_import
import|import
name|com
operator|.
name|jgoodies
operator|.
name|forms
operator|.
name|layout
operator|.
name|FormLayout
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|*
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|gui
operator|.
name|*
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|gui
operator|.
name|help
operator|.
name|HelpAction
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|gui
operator|.
name|keyboard
operator|.
name|KeyBinding
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|gui
operator|.
name|worker
operator|.
name|AbstractWorker
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|gui
operator|.
name|actions
operator|.
name|BrowseAction
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|logic
operator|.
name|l10n
operator|.
name|Localization
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|logic
operator|.
name|util
operator|.
name|OS
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|model
operator|.
name|database
operator|.
name|BibDatabase
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|jabref
operator|.
name|model
operator|.
name|entry
operator|.
name|BibEntry
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|swing
operator|.
name|*
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|logging
operator|.
name|Log
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|logging
operator|.
name|LogFactory
import|;
end_import

begin_import
import|import
name|java
operator|.
name|awt
operator|.
name|*
import|;
end_import

begin_import
import|import
name|java
operator|.
name|awt
operator|.
name|event
operator|.
name|ActionEvent
import|;
end_import

begin_import
import|import
name|java
operator|.
name|awt
operator|.
name|event
operator|.
name|ActionListener
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|*
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Method
import|;
end_import

begin_import
import|import
name|java
operator|.
name|net
operator|.
name|URL
import|;
end_import

begin_import
import|import
name|java
operator|.
name|net
operator|.
name|URLClassLoader
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_comment
comment|/**  * This test panel can be opened by reflection from JabRef, passing the JabRefFrame as an  * argument to the start() method. It displays buttons for testing interaction functions  * between JabRef and OpenOffice.  */
end_comment

begin_class
DECL|class|OpenOfficePanel
specifier|public
class|class
name|OpenOfficePanel
extends|extends
name|AbstractWorker
block|{
DECL|field|LOGGER
specifier|private
specifier|static
specifier|final
name|Log
name|LOGGER
init|=
name|LogFactory
operator|.
name|getLog
argument_list|(
name|OpenOfficePanel
operator|.
name|class
argument_list|)
decl_stmt|;
DECL|field|DEFAULT_AUTHORYEAR_STYLE_PATH
specifier|public
specifier|static
specifier|final
name|String
name|DEFAULT_AUTHORYEAR_STYLE_PATH
init|=
literal|"/resource/openoffice/default_authoryear.jstyle"
decl_stmt|;
DECL|field|DEFAULT_NUMERICAL_STYLE_PATH
specifier|public
specifier|static
specifier|final
name|String
name|DEFAULT_NUMERICAL_STYLE_PATH
init|=
literal|"/resource/openoffice/default_numerical.jstyle"
decl_stmt|;
DECL|field|comp
specifier|private
name|OOPanel
name|comp
decl_stmt|;
DECL|field|diag
specifier|private
name|JDialog
name|diag
decl_stmt|;
DECL|field|connect
specifier|private
specifier|final
name|JButton
name|connect
decl_stmt|;
DECL|field|manualConnect
specifier|private
specifier|final
name|JButton
name|manualConnect
decl_stmt|;
DECL|field|selectDocument
specifier|private
specifier|final
name|JButton
name|selectDocument
decl_stmt|;
DECL|field|setStyleFile
specifier|private
specifier|final
name|JButton
name|setStyleFile
init|=
operator|new
name|JButton
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Select style"
argument_list|)
argument_list|)
decl_stmt|;
DECL|field|pushEntries
specifier|private
specifier|final
name|JButton
name|pushEntries
init|=
operator|new
name|JButton
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Cite"
argument_list|)
argument_list|)
decl_stmt|;
DECL|field|pushEntriesInt
specifier|private
specifier|final
name|JButton
name|pushEntriesInt
init|=
operator|new
name|JButton
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Cite in-text"
argument_list|)
argument_list|)
decl_stmt|;
DECL|field|pushEntriesEmpty
specifier|private
specifier|final
name|JButton
name|pushEntriesEmpty
init|=
operator|new
name|JButton
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Insert empty citation"
argument_list|)
argument_list|)
decl_stmt|;
DECL|field|pushEntriesAdvanced
specifier|private
specifier|final
name|JButton
name|pushEntriesAdvanced
init|=
operator|new
name|JButton
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Cite special"
argument_list|)
argument_list|)
decl_stmt|;
DECL|field|update
specifier|private
specifier|final
name|JButton
name|update
decl_stmt|;
DECL|field|merge
specifier|private
specifier|final
name|JButton
name|merge
init|=
operator|new
name|JButton
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Merge citations"
argument_list|)
argument_list|)
decl_stmt|;
DECL|field|manageCitations
specifier|private
specifier|final
name|JButton
name|manageCitations
init|=
operator|new
name|JButton
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Manage citations"
argument_list|)
argument_list|)
decl_stmt|;
DECL|field|settingsB
specifier|private
specifier|final
name|JButton
name|settingsB
init|=
operator|new
name|JButton
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Settings"
argument_list|)
argument_list|)
decl_stmt|;
DECL|field|help
specifier|private
specifier|final
name|JButton
name|help
init|=
operator|new
name|HelpAction
argument_list|(
literal|"OpenOfficeIntegration.html"
argument_list|)
operator|.
name|getHelpButton
argument_list|()
decl_stmt|;
DECL|field|styleFile
specifier|private
name|String
name|styleFile
decl_stmt|;
DECL|field|ooBase
specifier|private
name|OOBibBase
name|ooBase
decl_stmt|;
DECL|field|frame
specifier|private
name|JabRefFrame
name|frame
decl_stmt|;
DECL|field|manager
specifier|private
name|SidePaneManager
name|manager
decl_stmt|;
DECL|field|style
specifier|private
name|OOBibStyle
name|style
decl_stmt|;
DECL|field|useDefaultAuthoryearStyle
specifier|private
name|boolean
name|useDefaultAuthoryearStyle
decl_stmt|;
DECL|field|useDefaultNumericalStyle
specifier|private
name|boolean
name|useDefaultNumericalStyle
decl_stmt|;
DECL|field|styleDialog
specifier|private
name|StyleSelectDialog
name|styleDialog
decl_stmt|;
DECL|field|dialogOkPressed
specifier|private
name|boolean
name|dialogOkPressed
decl_stmt|;
DECL|field|autoDetected
specifier|private
name|boolean
name|autoDetected
decl_stmt|;
DECL|field|sOffice
specifier|private
name|String
name|sOffice
decl_stmt|;
DECL|field|connectException
specifier|private
name|Throwable
name|connectException
decl_stmt|;
DECL|field|instance
specifier|private
specifier|static
name|OpenOfficePanel
name|instance
decl_stmt|;
DECL|method|getInstance ()
specifier|public
specifier|static
name|OpenOfficePanel
name|getInstance
parameter_list|()
block|{
if|if
condition|(
name|OpenOfficePanel
operator|.
name|instance
operator|==
literal|null
condition|)
block|{
name|OpenOfficePanel
operator|.
name|instance
operator|=
operator|new
name|OpenOfficePanel
argument_list|()
expr_stmt|;
block|}
return|return
name|OpenOfficePanel
operator|.
name|instance
return|;
block|}
DECL|method|OpenOfficePanel ()
specifier|private
name|OpenOfficePanel
parameter_list|()
block|{
name|Icon
name|connectImage
init|=
name|IconTheme
operator|.
name|JabRefIcon
operator|.
name|CONNECT_OPEN_OFFICE
operator|.
name|getSmallIcon
argument_list|()
decl_stmt|;
name|connect
operator|=
operator|new
name|JButton
argument_list|(
name|connectImage
argument_list|)
expr_stmt|;
name|manualConnect
operator|=
operator|new
name|JButton
argument_list|(
name|connectImage
argument_list|)
expr_stmt|;
name|connect
operator|.
name|setToolTipText
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Connect"
argument_list|)
argument_list|)
expr_stmt|;
name|manualConnect
operator|.
name|setToolTipText
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Manual connect"
argument_list|)
argument_list|)
expr_stmt|;
name|selectDocument
operator|=
operator|new
name|JButton
argument_list|(
name|IconTheme
operator|.
name|JabRefIcon
operator|.
name|OPEN
operator|.
name|getSmallIcon
argument_list|()
argument_list|)
expr_stmt|;
name|selectDocument
operator|.
name|setToolTipText
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Select Writer document"
argument_list|)
argument_list|)
expr_stmt|;
name|update
operator|=
operator|new
name|JButton
argument_list|(
name|IconTheme
operator|.
name|JabRefIcon
operator|.
name|REFRESH
operator|.
name|getSmallIcon
argument_list|()
argument_list|)
expr_stmt|;
name|update
operator|.
name|setToolTipText
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Sync OO bibliography"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|OS
operator|.
name|WINDOWS
condition|)
block|{
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|OO_PATH
argument_list|,
literal|"C:\\Program Files\\OpenOffice.org 4"
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|OO_EXECUTABLE_PATH
argument_list|,
literal|"C:\\Program Files\\OpenOffice.org 4\\program\\soffice.exe"
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|OO_JARS_PATH
argument_list|,
literal|"C:\\Program Files\\OpenOffice.org 4\\program\\classes"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|OS
operator|.
name|OS_X
condition|)
block|{
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|OO_EXECUTABLE_PATH
argument_list|,
literal|"/Applications/OpenOffice.org.app/Contents/MacOS/soffice.bin"
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|OO_PATH
argument_list|,
literal|"/Applications/OpenOffice.org.app"
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|OO_JARS_PATH
argument_list|,
literal|"/Applications/OpenOffice.org.app/Contents/Resources/java"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|// Linux
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|OO_PATH
argument_list|,
literal|"/opt/openoffice.org3"
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|OO_EXECUTABLE_PATH
argument_list|,
literal|"/usr/lib/openoffice/program/soffice"
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|OO_JARS_PATH
argument_list|,
literal|"/opt/openoffice.org/basis3.0"
argument_list|)
expr_stmt|;
block|}
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|SYNC_OO_WHEN_CITING
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|SHOW_OO_PANEL
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|USE_ALL_OPEN_BASES
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|OO_USE_DEFAULT_AUTHORYEAR_STYLE
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|OO_USE_DEFAULT_NUMERICAL_STYLE
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|OO_CHOOSE_STYLE_DIRECTLY
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|OO_DIRECT_FILE
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|putDefaultValue
argument_list|(
name|JabRefPreferences
operator|.
name|OO_STYLE_DIRECTORY
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|styleFile
operator|=
name|Globals
operator|.
name|prefs
operator|.
name|get
argument_list|(
name|JabRefPreferences
operator|.
name|OO_BIBLIOGRAPHY_STYLE_FILE
argument_list|)
expr_stmt|;
block|}
DECL|method|getSidePaneComponent ()
specifier|public
name|SidePaneComponent
name|getSidePaneComponent
parameter_list|()
block|{
return|return
name|comp
return|;
block|}
DECL|method|init (JabRefFrame jrFrame, SidePaneManager spManager)
specifier|public
name|void
name|init
parameter_list|(
name|JabRefFrame
name|jrFrame
parameter_list|,
name|SidePaneManager
name|spManager
parameter_list|)
block|{
name|frame
operator|=
name|jrFrame
expr_stmt|;
name|this
operator|.
name|manager
operator|=
name|spManager
expr_stmt|;
name|comp
operator|=
operator|new
name|OOPanel
argument_list|(
name|spManager
argument_list|,
name|IconTheme
operator|.
name|getImage
argument_list|(
literal|"openoffice"
argument_list|)
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"OpenOffice"
argument_list|)
argument_list|,
name|this
argument_list|)
expr_stmt|;
name|initPanel
argument_list|()
expr_stmt|;
name|spManager
operator|.
name|register
argument_list|(
name|getName
argument_list|()
argument_list|,
name|comp
argument_list|)
expr_stmt|;
block|}
DECL|method|getMenuItem ()
specifier|public
name|JMenuItem
name|getMenuItem
parameter_list|()
block|{
if|if
condition|(
name|Globals
operator|.
name|prefs
operator|.
name|getBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|SHOW_OO_PANEL
argument_list|)
condition|)
block|{
name|manager
operator|.
name|show
argument_list|(
name|getName
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|JMenuItem
name|item
init|=
operator|new
name|JMenuItem
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"OpenOffice/LibreOffice connection"
argument_list|)
argument_list|,
name|IconTheme
operator|.
name|getImage
argument_list|(
literal|"openoffice"
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|event
parameter_list|)
block|{
name|manager
operator|.
name|show
argument_list|(
name|getName
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
return|return
name|item
return|;
block|}
DECL|method|initPanel ()
specifier|private
name|void
name|initPanel
parameter_list|()
block|{
name|useDefaultAuthoryearStyle
operator|=
name|Globals
operator|.
name|prefs
operator|.
name|getBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|OO_USE_DEFAULT_AUTHORYEAR_STYLE
argument_list|)
expr_stmt|;
name|useDefaultNumericalStyle
operator|=
name|Globals
operator|.
name|prefs
operator|.
name|getBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|OO_USE_DEFAULT_NUMERICAL_STYLE
argument_list|)
expr_stmt|;
name|Action
name|al
init|=
operator|new
name|AbstractAction
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|e
parameter_list|)
block|{
name|connect
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
block|}
decl_stmt|;
name|connect
operator|.
name|addActionListener
argument_list|(
name|al
argument_list|)
expr_stmt|;
name|manualConnect
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|event
parameter_list|)
block|{
name|connect
argument_list|(
literal|false
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|selectDocument
operator|.
name|setToolTipText
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Select which open Writer document to work on"
argument_list|)
argument_list|)
expr_stmt|;
name|selectDocument
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|event
parameter_list|)
block|{
try|try
block|{
name|ooBase
operator|.
name|selectDocument
argument_list|()
expr_stmt|;
name|frame
operator|.
name|output
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Connected to document"
argument_list|)
operator|+
literal|": "
operator|+
name|ooBase
operator|.
name|getCurrentDocumentTitle
argument_list|()
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|frame
argument_list|,
name|ex
operator|.
name|getMessage
argument_list|()
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Error"
argument_list|)
argument_list|,
name|JOptionPane
operator|.
name|ERROR_MESSAGE
argument_list|)
expr_stmt|;
block|}
block|}
block|}
argument_list|)
expr_stmt|;
name|setStyleFile
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|e
parameter_list|)
block|{
if|if
condition|(
name|styleDialog
operator|==
literal|null
condition|)
block|{
name|styleDialog
operator|=
operator|new
name|StyleSelectDialog
argument_list|(
name|frame
argument_list|,
name|styleFile
argument_list|)
expr_stmt|;
block|}
name|styleDialog
operator|.
name|setVisible
argument_list|(
literal|true
argument_list|)
expr_stmt|;
if|if
condition|(
name|styleDialog
operator|.
name|isOkPressed
argument_list|()
condition|)
block|{
name|useDefaultAuthoryearStyle
operator|=
name|Globals
operator|.
name|prefs
operator|.
name|getBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|OO_USE_DEFAULT_AUTHORYEAR_STYLE
argument_list|)
expr_stmt|;
name|useDefaultNumericalStyle
operator|=
name|Globals
operator|.
name|prefs
operator|.
name|getBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|OO_USE_DEFAULT_NUMERICAL_STYLE
argument_list|)
expr_stmt|;
name|styleFile
operator|=
name|Globals
operator|.
name|prefs
operator|.
name|get
argument_list|(
name|JabRefPreferences
operator|.
name|OO_BIBLIOGRAPHY_STYLE_FILE
argument_list|)
expr_stmt|;
try|try
block|{
name|readStyleFile
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
name|LOGGER
operator|.
name|warn
argument_list|(
literal|"Could not read style file"
argument_list|,
name|ex
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
argument_list|)
expr_stmt|;
name|pushEntries
operator|.
name|setToolTipText
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Cite selected entries between parenthesis"
argument_list|)
argument_list|)
expr_stmt|;
name|pushEntries
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|e
parameter_list|)
block|{
name|pushEntries
argument_list|(
literal|true
argument_list|,
literal|true
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|pushEntriesInt
operator|.
name|setToolTipText
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Cite selected entries with in-text citation"
argument_list|)
argument_list|)
expr_stmt|;
name|pushEntriesInt
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|e
parameter_list|)
block|{
name|pushEntries
argument_list|(
literal|false
argument_list|,
literal|true
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|pushEntriesEmpty
operator|.
name|setToolTipText
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Insert a citation without text (the entry will appear in the reference list)"
argument_list|)
argument_list|)
expr_stmt|;
name|pushEntriesEmpty
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|event
parameter_list|)
block|{
name|pushEntries
argument_list|(
literal|false
argument_list|,
literal|false
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|pushEntriesAdvanced
operator|.
name|setToolTipText
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Cite selected entries with extra information"
argument_list|)
argument_list|)
expr_stmt|;
name|pushEntriesAdvanced
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|event
parameter_list|)
block|{
name|pushEntries
argument_list|(
literal|false
argument_list|,
literal|true
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|update
operator|.
name|setToolTipText
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Ensure that the bibliography is up-to-date"
argument_list|)
argument_list|)
expr_stmt|;
name|Action
name|updateAction
init|=
operator|new
name|AbstractAction
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|e
parameter_list|)
block|{
try|try
block|{
try|try
block|{
if|if
condition|(
name|style
operator|==
literal|null
condition|)
block|{
name|readStyleFile
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|style
operator|.
name|ensureUpToDate
argument_list|()
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|Throwable
name|ex
parameter_list|)
block|{
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|frame
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"You must select either a valid style file, or use one of the default styles."
argument_list|)
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"No valid style file defined"
argument_list|)
argument_list|,
name|JOptionPane
operator|.
name|ERROR_MESSAGE
argument_list|)
expr_stmt|;
return|return;
block|}
name|ooBase
operator|.
name|updateSortedReferenceMarks
argument_list|()
expr_stmt|;
name|java
operator|.
name|util
operator|.
name|List
argument_list|<
name|BibDatabase
argument_list|>
name|databases
init|=
name|getBaseList
argument_list|()
decl_stmt|;
name|java
operator|.
name|util
operator|.
name|List
argument_list|<
name|String
argument_list|>
name|unresolvedKeys
init|=
name|ooBase
operator|.
name|refreshCiteMarkers
argument_list|(
name|databases
argument_list|,
name|style
argument_list|)
decl_stmt|;
name|ooBase
operator|.
name|rebuildBibTextSection
argument_list|(
name|databases
argument_list|,
name|style
argument_list|)
expr_stmt|;
comment|//ooBase.sync(frame.getCurrentBasePanel().database(), style);
if|if
condition|(
operator|!
name|unresolvedKeys
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|frame
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Your OpenOffice document references the BibTeX key '%0', which could not be found in your current database."
argument_list|,
name|unresolvedKeys
operator|.
name|get
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Unable to synchronize bibliography"
argument_list|)
argument_list|,
name|JOptionPane
operator|.
name|ERROR_MESSAGE
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|UndefinedCharacterFormatException
name|ex
parameter_list|)
block|{
name|reportUndefinedCharacterFormat
argument_list|(
name|ex
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|UndefinedParagraphFormatException
name|ex
parameter_list|)
block|{
name|reportUndefinedParagraphFormat
argument_list|(
name|ex
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|ConnectionLostException
name|ex
parameter_list|)
block|{
name|showConnectionLostErrorMessage
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|BibEntryNotFoundException
name|ex
parameter_list|)
block|{
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|frame
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Your OpenOffice document references the BibTeX key '%0', which could not be found in your current database."
argument_list|,
name|ex
operator|.
name|getBibtexKey
argument_list|()
argument_list|)
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Unable to synchronize bibliography"
argument_list|)
argument_list|,
name|JOptionPane
operator|.
name|ERROR_MESSAGE
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e1
parameter_list|)
block|{
name|LOGGER
operator|.
name|warn
argument_list|(
literal|"Could not update bibliography"
argument_list|,
name|e1
argument_list|)
expr_stmt|;
block|}
block|}
block|}
decl_stmt|;
name|update
operator|.
name|addActionListener
argument_list|(
name|updateAction
argument_list|)
expr_stmt|;
name|merge
operator|.
name|setToolTipText
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Combine pairs of citations that are separated by spaces only"
argument_list|)
argument_list|)
expr_stmt|;
name|merge
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|event
parameter_list|)
block|{
try|try
block|{
name|ooBase
operator|.
name|combineCiteMarkers
argument_list|(
name|getBaseList
argument_list|()
argument_list|,
name|style
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|UndefinedCharacterFormatException
name|e
parameter_list|)
block|{
name|reportUndefinedCharacterFormat
argument_list|(
name|e
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|LOGGER
operator|.
name|warn
argument_list|(
literal|"Problem combining cite markers"
argument_list|,
name|e
argument_list|)
expr_stmt|;
block|}
block|}
block|}
argument_list|)
expr_stmt|;
name|settingsB
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|actionEvent
parameter_list|)
block|{
name|showSettingsPopup
argument_list|()
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|manageCitations
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|event
parameter_list|)
block|{
try|try
block|{
name|CitationManager
name|cm
init|=
operator|new
name|CitationManager
argument_list|(
name|frame
argument_list|,
name|ooBase
argument_list|)
decl_stmt|;
name|cm
operator|.
name|showDialog
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|LOGGER
operator|.
name|warn
argument_list|(
literal|"Problem showing citation manager"
argument_list|,
name|e
argument_list|)
expr_stmt|;
block|}
block|}
block|}
argument_list|)
expr_stmt|;
name|selectDocument
operator|.
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|pushEntries
operator|.
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|pushEntriesInt
operator|.
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|pushEntriesEmpty
operator|.
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|pushEntriesAdvanced
operator|.
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|update
operator|.
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|merge
operator|.
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|manageCitations
operator|.
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|diag
operator|=
operator|new
name|JDialog
argument_list|(
operator|(
name|JFrame
operator|)
literal|null
argument_list|,
literal|"OpenOffice panel"
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|DefaultFormBuilder
name|b
init|=
operator|new
name|DefaultFormBuilder
argument_list|(
operator|new
name|FormLayout
argument_list|(
literal|"fill:pref:grow"
argument_list|,
comment|//"p,0dlu,p,0dlu,p,0dlu,p,0dlu,p,0dlu,p,0dlu,p,0dlu,p,0dlu,p,0dlu,p,0dlu"));
literal|"p,p,p,p,p,p,p,p,p,p"
argument_list|)
argument_list|)
decl_stmt|;
comment|//ButtonBarBuilder bb = new ButtonBarBuilder();
name|DefaultFormBuilder
name|bb
init|=
operator|new
name|DefaultFormBuilder
argument_list|(
operator|new
name|FormLayout
argument_list|(
literal|"fill:pref:grow, 1dlu, fill:pref:grow, 1dlu, fill:pref:grow, "
operator|+
literal|"1dlu, fill:pref:grow, 1dlu, fill:pref:grow"
argument_list|,
literal|""
argument_list|)
argument_list|)
decl_stmt|;
name|bb
operator|.
name|append
argument_list|(
name|connect
argument_list|)
expr_stmt|;
name|bb
operator|.
name|append
argument_list|(
name|manualConnect
argument_list|)
expr_stmt|;
name|bb
operator|.
name|append
argument_list|(
name|selectDocument
argument_list|)
expr_stmt|;
name|bb
operator|.
name|append
argument_list|(
name|update
argument_list|)
expr_stmt|;
name|bb
operator|.
name|append
argument_list|(
name|help
argument_list|)
expr_stmt|;
name|b
operator|.
name|append
argument_list|(
name|bb
operator|.
name|getPanel
argument_list|()
argument_list|)
expr_stmt|;
name|b
operator|.
name|append
argument_list|(
name|setStyleFile
argument_list|)
expr_stmt|;
name|b
operator|.
name|append
argument_list|(
name|pushEntries
argument_list|)
expr_stmt|;
name|b
operator|.
name|append
argument_list|(
name|pushEntriesInt
argument_list|)
expr_stmt|;
name|b
operator|.
name|append
argument_list|(
name|pushEntriesAdvanced
argument_list|)
expr_stmt|;
name|b
operator|.
name|append
argument_list|(
name|pushEntriesEmpty
argument_list|)
expr_stmt|;
name|b
operator|.
name|append
argument_list|(
name|merge
argument_list|)
expr_stmt|;
name|b
operator|.
name|append
argument_list|(
name|manageCitations
argument_list|)
expr_stmt|;
name|b
operator|.
name|append
argument_list|(
name|settingsB
argument_list|)
expr_stmt|;
name|JPanel
name|content
init|=
operator|new
name|JPanel
argument_list|()
decl_stmt|;
name|comp
operator|.
name|setContentContainer
argument_list|(
name|content
argument_list|)
expr_stmt|;
name|content
operator|.
name|setLayout
argument_list|(
operator|new
name|BorderLayout
argument_list|()
argument_list|)
expr_stmt|;
name|content
operator|.
name|add
argument_list|(
name|b
operator|.
name|getPanel
argument_list|()
argument_list|,
name|BorderLayout
operator|.
name|CENTER
argument_list|)
expr_stmt|;
name|frame
operator|.
name|getTabbedPane
argument_list|()
operator|.
name|getInputMap
argument_list|(
name|JComponent
operator|.
name|WHEN_IN_FOCUSED_WINDOW
argument_list|)
operator|.
name|put
argument_list|(
name|Globals
operator|.
name|getKeyPrefs
argument_list|()
operator|.
name|getKey
argument_list|(
name|KeyBinding
operator|.
name|REFRESH_OO
argument_list|)
argument_list|,
literal|"Refresh OO"
argument_list|)
expr_stmt|;
name|frame
operator|.
name|getTabbedPane
argument_list|()
operator|.
name|getActionMap
argument_list|()
operator|.
name|put
argument_list|(
literal|"Refresh OO"
argument_list|,
name|updateAction
argument_list|)
expr_stmt|;
block|}
DECL|method|getBaseList ()
specifier|private
name|java
operator|.
name|util
operator|.
name|List
argument_list|<
name|BibDatabase
argument_list|>
name|getBaseList
parameter_list|()
block|{
name|java
operator|.
name|util
operator|.
name|List
argument_list|<
name|BibDatabase
argument_list|>
name|databases
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|()
decl_stmt|;
if|if
condition|(
name|Globals
operator|.
name|prefs
operator|.
name|getBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|USE_ALL_OPEN_BASES
argument_list|)
condition|)
block|{
for|for
control|(
name|BasePanel
name|basePanel
range|:
name|frame
operator|.
name|getBasePanelList
argument_list|()
control|)
block|{
name|databases
operator|.
name|add
argument_list|(
name|basePanel
operator|.
name|database
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|databases
operator|.
name|add
argument_list|(
name|frame
operator|.
name|getCurrentBasePanel
argument_list|()
operator|.
name|database
argument_list|()
argument_list|)
expr_stmt|;
block|}
return|return
name|databases
return|;
block|}
DECL|method|connect (boolean auto)
specifier|private
name|void
name|connect
parameter_list|(
name|boolean
name|auto
parameter_list|)
block|{
name|String
name|ooBaseDirectory
decl_stmt|;
if|if
condition|(
name|auto
condition|)
block|{
name|AutoDetectPaths
name|adp
init|=
operator|new
name|AutoDetectPaths
argument_list|(
name|diag
argument_list|)
decl_stmt|;
if|if
condition|(
name|adp
operator|.
name|runAutodetection
argument_list|()
condition|)
block|{
name|autoDetected
operator|=
literal|true
expr_stmt|;
name|dialogOkPressed
operator|=
literal|true
expr_stmt|;
name|diag
operator|.
name|dispose
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|adp
operator|.
name|cancelled
argument_list|()
condition|)
block|{
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|diag
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Autodetection failed"
argument_list|)
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Autodetection failed"
argument_list|)
argument_list|,
name|JOptionPane
operator|.
name|ERROR_MESSAGE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|autoDetected
condition|)
block|{
return|return;
block|}
name|ooBaseDirectory
operator|=
name|Globals
operator|.
name|prefs
operator|.
name|get
argument_list|(
name|JabRefPreferences
operator|.
name|OO_JARS_PATH
argument_list|)
expr_stmt|;
name|sOffice
operator|=
name|Globals
operator|.
name|prefs
operator|.
name|get
argument_list|(
name|JabRefPreferences
operator|.
name|OO_EXECUTABLE_PATH
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|// Manual connect
name|showConnectDialog
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|dialogOkPressed
condition|)
block|{
return|return;
block|}
name|String
name|ooPath
init|=
name|Globals
operator|.
name|prefs
operator|.
name|get
argument_list|(
name|JabRefPreferences
operator|.
name|OO_PATH
argument_list|)
decl_stmt|;
name|String
name|ooJars
init|=
name|Globals
operator|.
name|prefs
operator|.
name|get
argument_list|(
name|JabRefPreferences
operator|.
name|OO_JARS_PATH
argument_list|)
decl_stmt|;
name|sOffice
operator|=
name|Globals
operator|.
name|prefs
operator|.
name|get
argument_list|(
name|JabRefPreferences
operator|.
name|OO_EXECUTABLE_PATH
argument_list|)
expr_stmt|;
if|if
condition|(
name|OS
operator|.
name|WINDOWS
condition|)
block|{
name|ooBaseDirectory
operator|=
name|ooPath
operator|+
literal|"\\program\\classes"
expr_stmt|;
name|sOffice
operator|=
name|ooPath
operator|+
literal|"\\program\\soffice.exe"
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|OS
operator|.
name|OS_X
condition|)
block|{
name|sOffice
operator|=
name|ooPath
operator|+
literal|"/Contents/MacOS/soffice.bin"
expr_stmt|;
name|ooBaseDirectory
operator|=
name|ooPath
operator|+
literal|"/Contents/Resources/java"
expr_stmt|;
block|}
else|else
block|{
comment|// Linux:
name|ooBaseDirectory
operator|=
name|ooJars
operator|+
literal|"/program/classes"
expr_stmt|;
block|}
block|}
comment|// Add OO jars to the classpath:
try|try
block|{
name|File
index|[]
name|jarFiles
init|=
operator|new
name|File
index|[]
block|{
operator|new
name|File
argument_list|(
name|ooBaseDirectory
argument_list|,
literal|"unoil.jar"
argument_list|)
block|,
operator|new
name|File
argument_list|(
name|ooBaseDirectory
argument_list|,
literal|"jurt.jar"
argument_list|)
block|,
operator|new
name|File
argument_list|(
name|ooBaseDirectory
argument_list|,
literal|"juh.jar"
argument_list|)
block|,
operator|new
name|File
argument_list|(
name|ooBaseDirectory
argument_list|,
literal|"ridl.jar"
argument_list|)
block|}
decl_stmt|;
name|URL
index|[]
name|jarList
init|=
operator|new
name|URL
index|[
name|jarFiles
operator|.
name|length
index|]
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|jarList
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|jarFiles
index|[
name|i
index|]
operator|.
name|exists
argument_list|()
condition|)
block|{
throw|throw
operator|new
name|Exception
argument_list|(
literal|"File not found: "
operator|+
name|jarFiles
index|[
name|i
index|]
operator|.
name|getPath
argument_list|()
argument_list|)
throw|;
block|}
name|jarList
index|[
name|i
index|]
operator|=
name|jarFiles
index|[
name|i
index|]
operator|.
name|toURI
argument_list|()
operator|.
name|toURL
argument_list|()
expr_stmt|;
block|}
name|addURL
argument_list|(
name|jarList
argument_list|)
expr_stmt|;
comment|// Show progress dialog:
specifier|final
name|JDialog
name|progDiag
init|=
operator|new
name|AutoDetectPaths
argument_list|(
name|diag
argument_list|)
operator|.
name|showProgressDialog
argument_list|(
name|diag
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Connecting"
argument_list|)
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Please wait..."
argument_list|)
argument_list|,
literal|false
argument_list|)
decl_stmt|;
name|getWorker
argument_list|()
operator|.
name|run
argument_list|()
expr_stmt|;
comment|// Do the actual connection, using Spin to get off the EDT.
name|progDiag
operator|.
name|dispose
argument_list|()
expr_stmt|;
name|diag
operator|.
name|dispose
argument_list|()
expr_stmt|;
if|if
condition|(
name|ooBase
operator|==
literal|null
condition|)
block|{
throw|throw
name|connectException
throw|;
block|}
if|if
condition|(
name|ooBase
operator|.
name|isConnectedToDocument
argument_list|()
condition|)
block|{
name|frame
operator|.
name|output
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Connected to document"
argument_list|)
operator|+
literal|": "
operator|+
name|ooBase
operator|.
name|getCurrentDocumentTitle
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|// Enable actions that depend on Connect:
name|selectDocument
operator|.
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|pushEntries
operator|.
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|pushEntriesInt
operator|.
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|pushEntriesEmpty
operator|.
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|pushEntriesAdvanced
operator|.
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|update
operator|.
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|merge
operator|.
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|manageCitations
operator|.
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|UnsatisfiedLinkError
name|e
parameter_list|)
block|{
name|LOGGER
operator|.
name|warn
argument_list|(
literal|"Could not connect to running OpenOffice/LibreOffice"
argument_list|,
name|e
argument_list|)
expr_stmt|;
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|frame
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Unable to connect. One possible reason is that JabRef "
operator|+
literal|"and OpenOffice/LibreOffice are not both running in either 32 bit mode or 64 bit mode."
argument_list|)
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Throwable
name|e
parameter_list|)
block|{
name|LOGGER
operator|.
name|warn
argument_list|(
literal|"Could not connect to running OpenOffice/LibreOffice"
argument_list|,
name|e
argument_list|)
expr_stmt|;
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|frame
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Could not connect to running OpenOffice."
argument_list|)
operator|+
literal|"\n"
operator|+
name|Localization
operator|.
name|lang
argument_list|(
literal|"Make sure you have installed OpenOffice with Java support."
argument_list|)
operator|+
literal|"\n"
operator|+
name|Localization
operator|.
name|lang
argument_list|(
literal|"If connecting manually, please verify program and library paths."
argument_list|)
operator|+
literal|"\n"
operator|+
literal|"\n"
operator|+
name|Localization
operator|.
name|lang
argument_list|(
literal|"Error message:"
argument_list|)
operator|+
literal|" "
operator|+
name|e
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|Override
DECL|method|run ()
specifier|public
name|void
name|run
parameter_list|()
block|{
try|try
block|{
comment|// Connect:
name|ooBase
operator|=
operator|new
name|OOBibBase
argument_list|(
name|sOffice
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Throwable
name|e
parameter_list|)
block|{
name|ooBase
operator|=
literal|null
expr_stmt|;
name|connectException
operator|=
name|e
expr_stmt|;
comment|//JOptionPane.showMessageDialog(frame, Globals.lang("Unable to connect"));
block|}
block|}
comment|/**      * Read the style file. Record the last modified time of the file.      * @throws Exception      */
DECL|method|readStyleFile ()
specifier|private
name|void
name|readStyleFile
parameter_list|()
throws|throws
name|Exception
block|{
if|if
condition|(
name|useDefaultAuthoryearStyle
condition|)
block|{
name|URL
name|defPath
init|=
name|JabRef
operator|.
name|class
operator|.
name|getResource
argument_list|(
name|DEFAULT_AUTHORYEAR_STYLE_PATH
argument_list|)
decl_stmt|;
name|Reader
name|r
init|=
operator|new
name|InputStreamReader
argument_list|(
name|defPath
operator|.
name|openStream
argument_list|()
argument_list|)
decl_stmt|;
name|style
operator|=
operator|new
name|OOBibStyle
argument_list|(
name|r
argument_list|,
name|Globals
operator|.
name|journalAbbreviationLoader
operator|.
name|getRepository
argument_list|()
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|useDefaultNumericalStyle
condition|)
block|{
name|URL
name|defPath
init|=
name|JabRef
operator|.
name|class
operator|.
name|getResource
argument_list|(
name|DEFAULT_NUMERICAL_STYLE_PATH
argument_list|)
decl_stmt|;
name|Reader
name|r
init|=
operator|new
name|InputStreamReader
argument_list|(
name|defPath
operator|.
name|openStream
argument_list|()
argument_list|)
decl_stmt|;
name|style
operator|=
operator|new
name|OOBibStyle
argument_list|(
name|r
argument_list|,
name|Globals
operator|.
name|journalAbbreviationLoader
operator|.
name|getRepository
argument_list|()
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|style
operator|=
operator|new
name|OOBibStyle
argument_list|(
operator|new
name|File
argument_list|(
name|styleFile
argument_list|)
argument_list|,
name|Globals
operator|.
name|journalAbbreviationLoader
operator|.
name|getRepository
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
comment|// The methods addFile and associated final Class[] parameters were gratefully copied from
comment|// anthony_miguel @ http://forum.java.sun.com/thread.jsp?forum=32&thread=300557&tstart=0&trange=15
DECL|field|CLASS_PARAMETERS
specifier|private
specifier|static
specifier|final
name|Class
argument_list|<
name|?
argument_list|>
index|[]
name|CLASS_PARAMETERS
init|=
operator|new
name|Class
index|[]
block|{
name|URL
operator|.
name|class
block|}
decl_stmt|;
DECL|method|addURL (URL[] u)
specifier|private
specifier|static
name|void
name|addURL
parameter_list|(
name|URL
index|[]
name|u
parameter_list|)
throws|throws
name|IOException
block|{
name|URLClassLoader
name|sysloader
init|=
operator|(
name|URLClassLoader
operator|)
name|ClassLoader
operator|.
name|getSystemClassLoader
argument_list|()
decl_stmt|;
name|Class
argument_list|<
name|URLClassLoader
argument_list|>
name|sysclass
init|=
name|URLClassLoader
operator|.
name|class
decl_stmt|;
try|try
block|{
name|Method
name|method
init|=
name|sysclass
operator|.
name|getDeclaredMethod
argument_list|(
literal|"addURL"
argument_list|,
name|CLASS_PARAMETERS
argument_list|)
decl_stmt|;
name|method
operator|.
name|setAccessible
argument_list|(
literal|true
argument_list|)
expr_stmt|;
for|for
control|(
name|URL
name|anU
range|:
name|u
control|)
block|{
name|method
operator|.
name|invoke
argument_list|(
name|sysloader
argument_list|,
name|anU
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|Throwable
name|t
parameter_list|)
block|{
name|LOGGER
operator|.
name|error
argument_list|(
literal|"Could not add URL to system classloader"
argument_list|,
name|t
argument_list|)
expr_stmt|;
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Error, could not add URL to system classloader"
argument_list|)
throw|;
block|}
block|}
DECL|method|updateConnectionParams (String ooPath, String ooExec, String ooJars)
specifier|private
name|void
name|updateConnectionParams
parameter_list|(
name|String
name|ooPath
parameter_list|,
name|String
name|ooExec
parameter_list|,
name|String
name|ooJars
parameter_list|)
block|{
name|Globals
operator|.
name|prefs
operator|.
name|put
argument_list|(
name|JabRefPreferences
operator|.
name|OO_PATH
argument_list|,
name|ooPath
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|put
argument_list|(
name|JabRefPreferences
operator|.
name|OO_EXECUTABLE_PATH
argument_list|,
name|ooExec
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|put
argument_list|(
name|JabRefPreferences
operator|.
name|OO_JARS_PATH
argument_list|,
name|ooJars
argument_list|)
expr_stmt|;
block|}
DECL|method|showConnectDialog ()
specifier|private
name|void
name|showConnectDialog
parameter_list|()
block|{
name|dialogOkPressed
operator|=
literal|false
expr_stmt|;
specifier|final
name|JDialog
name|cDiag
init|=
operator|new
name|JDialog
argument_list|(
name|frame
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Set connection parameters"
argument_list|)
argument_list|,
literal|true
argument_list|)
decl_stmt|;
specifier|final
name|JTextField
name|ooPath
init|=
operator|new
name|JTextField
argument_list|(
literal|30
argument_list|)
decl_stmt|;
name|JButton
name|browseOOPath
init|=
operator|new
name|JButton
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Browse"
argument_list|)
argument_list|)
decl_stmt|;
name|ooPath
operator|.
name|setText
argument_list|(
name|Globals
operator|.
name|prefs
operator|.
name|get
argument_list|(
name|JabRefPreferences
operator|.
name|OO_PATH
argument_list|)
argument_list|)
expr_stmt|;
specifier|final
name|JTextField
name|ooExec
init|=
operator|new
name|JTextField
argument_list|(
literal|30
argument_list|)
decl_stmt|;
name|JButton
name|browseOOExec
init|=
operator|new
name|JButton
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Browse"
argument_list|)
argument_list|)
decl_stmt|;
name|browseOOExec
operator|.
name|addActionListener
argument_list|(
name|BrowseAction
operator|.
name|buildForFile
argument_list|(
name|ooExec
argument_list|)
argument_list|)
expr_stmt|;
specifier|final
name|JTextField
name|ooJars
init|=
operator|new
name|JTextField
argument_list|(
literal|30
argument_list|)
decl_stmt|;
name|JButton
name|browseOOJars
init|=
operator|new
name|JButton
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Browse"
argument_list|)
argument_list|)
decl_stmt|;
name|browseOOJars
operator|.
name|addActionListener
argument_list|(
name|BrowseAction
operator|.
name|buildForDir
argument_list|(
name|ooJars
argument_list|)
argument_list|)
expr_stmt|;
name|ooExec
operator|.
name|setText
argument_list|(
name|Globals
operator|.
name|prefs
operator|.
name|get
argument_list|(
name|JabRefPreferences
operator|.
name|OO_EXECUTABLE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|ooJars
operator|.
name|setText
argument_list|(
name|Globals
operator|.
name|prefs
operator|.
name|get
argument_list|(
name|JabRefPreferences
operator|.
name|OO_JARS_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|DefaultFormBuilder
name|builder
init|=
operator|new
name|DefaultFormBuilder
argument_list|(
operator|new
name|FormLayout
argument_list|(
literal|"left:pref, 4dlu, fill:pref:grow, 4dlu, fill:pref"
argument_list|,
literal|""
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|OS
operator|.
name|WINDOWS
operator|||
name|OS
operator|.
name|OS_X
condition|)
block|{
name|builder
operator|.
name|append
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Path to OpenOffice directory"
argument_list|)
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
name|ooPath
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
name|browseOOPath
argument_list|)
expr_stmt|;
name|builder
operator|.
name|nextLine
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|builder
operator|.
name|append
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Path to OpenOffice executable"
argument_list|)
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
name|ooExec
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
name|browseOOExec
argument_list|)
expr_stmt|;
name|builder
operator|.
name|nextLine
argument_list|()
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Path to OpenOffice library dir"
argument_list|)
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
name|ooJars
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
name|browseOOJars
argument_list|)
expr_stmt|;
name|builder
operator|.
name|nextLine
argument_list|()
expr_stmt|;
block|}
name|ButtonBarBuilder
name|bb
init|=
operator|new
name|ButtonBarBuilder
argument_list|()
decl_stmt|;
name|JButton
name|ok
init|=
operator|new
name|JButton
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"OK"
argument_list|)
argument_list|)
decl_stmt|;
name|JButton
name|cancel
init|=
operator|new
name|JButton
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Cancel"
argument_list|)
argument_list|)
decl_stmt|;
name|ActionListener
name|tfListener
init|=
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|event
parameter_list|)
block|{
name|updateConnectionParams
argument_list|(
name|ooPath
operator|.
name|getText
argument_list|()
argument_list|,
name|ooExec
operator|.
name|getText
argument_list|()
argument_list|,
name|ooJars
operator|.
name|getText
argument_list|()
argument_list|)
expr_stmt|;
name|cDiag
operator|.
name|dispose
argument_list|()
expr_stmt|;
block|}
block|}
decl_stmt|;
name|ooPath
operator|.
name|addActionListener
argument_list|(
name|tfListener
argument_list|)
expr_stmt|;
name|ooExec
operator|.
name|addActionListener
argument_list|(
name|tfListener
argument_list|)
expr_stmt|;
name|ooJars
operator|.
name|addActionListener
argument_list|(
name|tfListener
argument_list|)
expr_stmt|;
name|ok
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|event
parameter_list|)
block|{
name|updateConnectionParams
argument_list|(
name|ooPath
operator|.
name|getText
argument_list|()
argument_list|,
name|ooExec
operator|.
name|getText
argument_list|()
argument_list|,
name|ooJars
operator|.
name|getText
argument_list|()
argument_list|)
expr_stmt|;
name|dialogOkPressed
operator|=
literal|true
expr_stmt|;
name|cDiag
operator|.
name|dispose
argument_list|()
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|cancel
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|event
parameter_list|)
block|{
name|cDiag
operator|.
name|dispose
argument_list|()
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|bb
operator|.
name|addGlue
argument_list|()
expr_stmt|;
name|bb
operator|.
name|addRelatedGap
argument_list|()
expr_stmt|;
name|bb
operator|.
name|addButton
argument_list|(
name|ok
argument_list|)
expr_stmt|;
name|bb
operator|.
name|addButton
argument_list|(
name|cancel
argument_list|)
expr_stmt|;
name|bb
operator|.
name|addGlue
argument_list|()
expr_stmt|;
name|builder
operator|.
name|getPanel
argument_list|()
operator|.
name|setBorder
argument_list|(
name|BorderFactory
operator|.
name|createEmptyBorder
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|bb
operator|.
name|getPanel
argument_list|()
operator|.
name|setBorder
argument_list|(
name|BorderFactory
operator|.
name|createEmptyBorder
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|cDiag
operator|.
name|getContentPane
argument_list|()
operator|.
name|add
argument_list|(
name|builder
operator|.
name|getPanel
argument_list|()
argument_list|,
name|BorderLayout
operator|.
name|CENTER
argument_list|)
expr_stmt|;
name|cDiag
operator|.
name|getContentPane
argument_list|()
operator|.
name|add
argument_list|(
name|bb
operator|.
name|getPanel
argument_list|()
argument_list|,
name|BorderLayout
operator|.
name|SOUTH
argument_list|)
expr_stmt|;
name|cDiag
operator|.
name|pack
argument_list|()
expr_stmt|;
name|cDiag
operator|.
name|setLocationRelativeTo
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|cDiag
operator|.
name|setVisible
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
DECL|method|pushEntries (boolean inParenthesis, boolean withText, boolean addPageInfo)
specifier|private
name|void
name|pushEntries
parameter_list|(
name|boolean
name|inParenthesis
parameter_list|,
name|boolean
name|withText
parameter_list|,
name|boolean
name|addPageInfo
parameter_list|)
block|{
if|if
condition|(
operator|!
name|ooBase
operator|.
name|isConnectedToDocument
argument_list|()
condition|)
block|{
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|frame
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Not connected to any Writer document. Please"
operator|+
literal|" make sure a document is open, and use the 'Select Writer document' button to connect to it."
argument_list|)
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Error"
argument_list|)
argument_list|,
name|JOptionPane
operator|.
name|ERROR_MESSAGE
argument_list|)
expr_stmt|;
return|return;
block|}
name|String
name|pageInfo
init|=
literal|null
decl_stmt|;
if|if
condition|(
name|addPageInfo
condition|)
block|{
name|AdvancedCiteDialog
name|acd
init|=
operator|new
name|AdvancedCiteDialog
argument_list|(
name|frame
argument_list|)
decl_stmt|;
name|acd
operator|.
name|showDialog
argument_list|()
expr_stmt|;
if|if
condition|(
name|acd
operator|.
name|cancelled
argument_list|()
condition|)
block|{
return|return;
block|}
if|if
condition|(
operator|!
name|acd
operator|.
name|getPageInfo
argument_list|()
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|pageInfo
operator|=
name|acd
operator|.
name|getPageInfo
argument_list|()
expr_stmt|;
block|}
name|inParenthesis
operator|=
name|acd
operator|.
name|isInParenthesisCite
argument_list|()
expr_stmt|;
block|}
name|BasePanel
name|panel
init|=
name|frame
operator|.
name|getCurrentBasePanel
argument_list|()
decl_stmt|;
if|if
condition|(
name|panel
operator|!=
literal|null
condition|)
block|{
specifier|final
name|BibDatabase
name|database
init|=
name|panel
operator|.
name|database
argument_list|()
decl_stmt|;
name|BibEntry
index|[]
name|entries
init|=
name|panel
operator|.
name|getSelectedEntries
argument_list|()
decl_stmt|;
if|if
condition|(
name|entries
operator|.
name|length
operator|>
literal|0
condition|)
block|{
try|try
block|{
if|if
condition|(
name|style
operator|==
literal|null
condition|)
block|{
name|readStyleFile
argument_list|()
expr_stmt|;
block|}
name|ooBase
operator|.
name|insertEntry
argument_list|(
name|entries
argument_list|,
name|database
argument_list|,
name|getBaseList
argument_list|()
argument_list|,
name|style
argument_list|,
name|inParenthesis
argument_list|,
name|withText
argument_list|,
name|pageInfo
argument_list|,
name|Globals
operator|.
name|prefs
operator|.
name|getBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|SYNC_OO_WHEN_CITING
argument_list|)
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|FileNotFoundException
name|ex
parameter_list|)
block|{
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|frame
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"You must select either a valid style file, or use one of the default styles."
argument_list|)
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"No valid style file defined"
argument_list|)
argument_list|,
name|JOptionPane
operator|.
name|ERROR_MESSAGE
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|ConnectionLostException
name|ex
parameter_list|)
block|{
name|showConnectionLostErrorMessage
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|UndefinedCharacterFormatException
name|ex
parameter_list|)
block|{
name|reportUndefinedCharacterFormat
argument_list|(
name|ex
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|UndefinedParagraphFormatException
name|ex
parameter_list|)
block|{
name|reportUndefinedParagraphFormat
argument_list|(
name|ex
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
name|LOGGER
operator|.
name|warn
argument_list|(
literal|"Could not insert entry"
argument_list|,
name|ex
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
DECL|method|showConnectionLostErrorMessage ()
specifier|private
name|void
name|showConnectionLostErrorMessage
parameter_list|()
block|{
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|frame
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Connection to OpenOffice has been lost. "
operator|+
literal|"Please make sure OpenOffice is running, and try to reconnect."
argument_list|)
argument_list|,
name|Localization
operator|.
name|lang
argument_list|(
literal|"Connection lost"
argument_list|)
argument_list|,
name|JOptionPane
operator|.
name|ERROR_MESSAGE
argument_list|)
expr_stmt|;
block|}
DECL|method|reportUndefinedParagraphFormat (UndefinedParagraphFormatException ex)
specifier|private
name|void
name|reportUndefinedParagraphFormat
parameter_list|(
name|UndefinedParagraphFormatException
name|ex
parameter_list|)
block|{
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|frame
argument_list|,
literal|"<html>"
operator|+
name|Localization
operator|.
name|lang
argument_list|(
literal|"Your style file specifies the paragraph format '%0', "
operator|+
literal|"which is undefined in your current OpenOffice document."
argument_list|,
name|ex
operator|.
name|getFormatName
argument_list|()
argument_list|)
operator|+
literal|"<br>"
operator|+
name|Localization
operator|.
name|lang
argument_list|(
literal|"The paragraph format is controlled by the property 'ReferenceParagraphFormat' or 'ReferenceHeaderParagraphFormat' in the style file."
argument_list|)
operator|+
literal|"</html>"
argument_list|,
literal|""
argument_list|,
name|JOptionPane
operator|.
name|ERROR_MESSAGE
argument_list|)
expr_stmt|;
block|}
DECL|method|reportUndefinedCharacterFormat (UndefinedCharacterFormatException ex)
specifier|private
name|void
name|reportUndefinedCharacterFormat
parameter_list|(
name|UndefinedCharacterFormatException
name|ex
parameter_list|)
block|{
name|JOptionPane
operator|.
name|showMessageDialog
argument_list|(
name|frame
argument_list|,
literal|"<html>"
operator|+
name|Localization
operator|.
name|lang
argument_list|(
literal|"Your style file specifies the character format '%0', "
operator|+
literal|"which is undefined in your current OpenOffice document."
argument_list|,
name|ex
operator|.
name|getFormatName
argument_list|()
argument_list|)
operator|+
literal|"<br>"
operator|+
name|Localization
operator|.
name|lang
argument_list|(
literal|"The character format is controlled by the citation property 'CitationCharacterFormat' in the style file."
argument_list|)
operator|+
literal|"</html>"
argument_list|,
literal|""
argument_list|,
name|JOptionPane
operator|.
name|ERROR_MESSAGE
argument_list|)
expr_stmt|;
block|}
DECL|method|showSettingsPopup ()
specifier|private
name|void
name|showSettingsPopup
parameter_list|()
block|{
name|JPopupMenu
name|menu
init|=
operator|new
name|JPopupMenu
argument_list|()
decl_stmt|;
specifier|final
name|JCheckBoxMenuItem
name|autoSync
init|=
operator|new
name|JCheckBoxMenuItem
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Automatically sync bibliography when inserting citations"
argument_list|)
argument_list|,
name|Globals
operator|.
name|prefs
operator|.
name|getBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|SYNC_OO_WHEN_CITING
argument_list|)
argument_list|)
decl_stmt|;
specifier|final
name|JRadioButtonMenuItem
name|useActiveBase
init|=
operator|new
name|JRadioButtonMenuItem
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Look up BibTeX entries in the active tab only"
argument_list|)
argument_list|)
decl_stmt|;
specifier|final
name|JRadioButtonMenuItem
name|useAllBases
init|=
operator|new
name|JRadioButtonMenuItem
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Look up BibTeX entries in all open databases"
argument_list|)
argument_list|)
decl_stmt|;
specifier|final
name|JMenuItem
name|clearConnectionSettings
init|=
operator|new
name|JMenuItem
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Clear connection settings"
argument_list|)
argument_list|)
decl_stmt|;
name|ButtonGroup
name|bg
init|=
operator|new
name|ButtonGroup
argument_list|()
decl_stmt|;
name|bg
operator|.
name|add
argument_list|(
name|useActiveBase
argument_list|)
expr_stmt|;
name|bg
operator|.
name|add
argument_list|(
name|useAllBases
argument_list|)
expr_stmt|;
if|if
condition|(
name|Globals
operator|.
name|prefs
operator|.
name|getBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|USE_ALL_OPEN_BASES
argument_list|)
condition|)
block|{
name|useAllBases
operator|.
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|useActiveBase
operator|.
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
name|autoSync
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|actionEvent
parameter_list|)
block|{
name|Globals
operator|.
name|prefs
operator|.
name|putBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|SYNC_OO_WHEN_CITING
argument_list|,
name|autoSync
operator|.
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|useAllBases
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|actionEvent
parameter_list|)
block|{
name|Globals
operator|.
name|prefs
operator|.
name|putBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|USE_ALL_OPEN_BASES
argument_list|,
name|useAllBases
operator|.
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|useActiveBase
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|actionEvent
parameter_list|)
block|{
name|Globals
operator|.
name|prefs
operator|.
name|putBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|USE_ALL_OPEN_BASES
argument_list|,
operator|!
name|useActiveBase
operator|.
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|clearConnectionSettings
operator|.
name|addActionListener
argument_list|(
operator|new
name|ActionListener
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|actionPerformed
parameter_list|(
name|ActionEvent
name|actionEvent
parameter_list|)
block|{
name|Globals
operator|.
name|prefs
operator|.
name|clear
argument_list|(
name|JabRefPreferences
operator|.
name|OO_PATH
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|clear
argument_list|(
name|JabRefPreferences
operator|.
name|OO_EXECUTABLE_PATH
argument_list|)
expr_stmt|;
name|Globals
operator|.
name|prefs
operator|.
name|clear
argument_list|(
name|JabRefPreferences
operator|.
name|OO_JARS_PATH
argument_list|)
expr_stmt|;
name|frame
operator|.
name|output
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Cleared connection settings."
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|menu
operator|.
name|add
argument_list|(
name|autoSync
argument_list|)
expr_stmt|;
name|menu
operator|.
name|addSeparator
argument_list|()
expr_stmt|;
name|menu
operator|.
name|add
argument_list|(
name|useActiveBase
argument_list|)
expr_stmt|;
name|menu
operator|.
name|add
argument_list|(
name|useAllBases
argument_list|)
expr_stmt|;
name|menu
operator|.
name|addSeparator
argument_list|()
expr_stmt|;
name|menu
operator|.
name|add
argument_list|(
name|clearConnectionSettings
argument_list|)
expr_stmt|;
name|menu
operator|.
name|show
argument_list|(
name|settingsB
argument_list|,
literal|0
argument_list|,
name|settingsB
operator|.
name|getHeight
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|getName ()
specifier|public
name|String
name|getName
parameter_list|()
block|{
return|return
literal|"OpenOffice"
return|;
block|}
DECL|class|OOPanel
class|class
name|OOPanel
extends|extends
name|SidePaneComponent
block|{
DECL|field|ooPanel
specifier|private
specifier|final
name|OpenOfficePanel
name|ooPanel
decl_stmt|;
DECL|method|OOPanel (SidePaneManager sidePaneManager, Icon url, String s, OpenOfficePanel panel)
specifier|public
name|OOPanel
parameter_list|(
name|SidePaneManager
name|sidePaneManager
parameter_list|,
name|Icon
name|url
parameter_list|,
name|String
name|s
parameter_list|,
name|OpenOfficePanel
name|panel
parameter_list|)
block|{
name|super
argument_list|(
name|sidePaneManager
argument_list|,
name|url
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|ooPanel
operator|=
name|panel
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|getName ()
specifier|public
name|String
name|getName
parameter_list|()
block|{
return|return
name|ooPanel
operator|.
name|getName
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|componentClosing ()
specifier|public
name|void
name|componentClosing
parameter_list|()
block|{
name|Globals
operator|.
name|prefs
operator|.
name|putBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|SHOW_OO_PANEL
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|componentOpening ()
specifier|public
name|void
name|componentOpening
parameter_list|()
block|{
name|Globals
operator|.
name|prefs
operator|.
name|putBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|SHOW_OO_PANEL
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_class

end_unit

