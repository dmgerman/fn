begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_package
DECL|package|org.jabref.gui.preferences
package|package
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|preferences
package|;
end_package

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Objects
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|stream
operator|.
name|Collectors
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|beans
operator|.
name|property
operator|.
name|SimpleStringProperty
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|collections
operator|.
name|FXCollections
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|collections
operator|.
name|ObservableList
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|Node
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|Button
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|CheckBox
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|Label
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|ScrollPane
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|TableColumn
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|TableView
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|TextField
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|cell
operator|.
name|PropertyValueFactory
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|cell
operator|.
name|TextFieldTableCell
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|layout
operator|.
name|BorderPane
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|layout
operator|.
name|GridPane
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|layout
operator|.
name|HBox
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|layout
operator|.
name|Pane
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|logic
operator|.
name|l10n
operator|.
name|Localization
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|preferences
operator|.
name|JabRefPreferences
import|;
end_import

begin_comment
comment|/**  * Preference Tab for XMP.  *  * Allows the user to enable and configure the XMP privacy filter.  */
end_comment

begin_class
DECL|class|XmpPrefsTab
class|class
name|XmpPrefsTab
extends|extends
name|Pane
implements|implements
name|PrefsTab
block|{
DECL|field|prefs
specifier|private
specifier|final
name|JabRefPreferences
name|prefs
decl_stmt|;
DECL|field|tableChanged
specifier|private
name|boolean
name|tableChanged
decl_stmt|;
DECL|field|builder
specifier|private
specifier|final
name|GridPane
name|builder
init|=
operator|new
name|GridPane
argument_list|()
decl_stmt|;
DECL|field|data
specifier|private
specifier|final
name|ObservableList
argument_list|<
name|TableRow
argument_list|>
name|data
init|=
name|FXCollections
operator|.
name|observableArrayList
argument_list|()
decl_stmt|;
DECL|field|privacyFilterCheckBox
specifier|private
specifier|final
name|CheckBox
name|privacyFilterCheckBox
init|=
operator|new
name|CheckBox
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Do not write the following fields to XMP Metadata:"
argument_list|)
argument_list|)
decl_stmt|;
DECL|field|tableRows
specifier|private
specifier|final
name|List
argument_list|<
name|TableRow
argument_list|>
name|tableRows
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|(
literal|10
argument_list|)
decl_stmt|;
comment|/**      * Customization of external program paths.      */
DECL|method|XmpPrefsTab (JabRefPreferences prefs)
specifier|public
name|XmpPrefsTab
parameter_list|(
name|JabRefPreferences
name|prefs
parameter_list|)
block|{
name|this
operator|.
name|prefs
operator|=
name|Objects
operator|.
name|requireNonNull
argument_list|(
name|prefs
argument_list|)
expr_stmt|;
name|TableView
name|tableView
init|=
operator|new
name|TableView
argument_list|()
decl_stmt|;
name|TableColumn
argument_list|<
name|TableRow
argument_list|,
name|String
argument_list|>
name|column
init|=
operator|new
name|TableColumn
argument_list|<>
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Field to filter"
argument_list|)
argument_list|)
decl_stmt|;
name|column
operator|.
name|setCellValueFactory
argument_list|(
operator|new
name|PropertyValueFactory
argument_list|<>
argument_list|(
literal|"name"
argument_list|)
argument_list|)
expr_stmt|;
name|column
operator|.
name|setCellFactory
argument_list|(
name|TextFieldTableCell
operator|.
expr|<
name|TableRow
operator|>
name|forTableColumn
argument_list|()
argument_list|)
expr_stmt|;
name|column
operator|.
name|setOnEditCommit
argument_list|(
parameter_list|(
name|TableColumn
operator|.
name|CellEditEvent
argument_list|<
name|TableRow
argument_list|,
name|String
argument_list|>
name|t
parameter_list|)
lambda|->
block|{
operator|(
operator|(
name|TableRow
operator|)
name|t
operator|.
name|getTableView
argument_list|()
operator|.
name|getItems
argument_list|()
operator|.
name|get
argument_list|(
name|t
operator|.
name|getTablePosition
argument_list|()
operator|.
name|getRow
argument_list|()
argument_list|)
operator|)
operator|.
name|setName
argument_list|(
name|t
operator|.
name|getNewValue
argument_list|()
argument_list|)
expr_stmt|;
block|}
argument_list|)
expr_stmt|;
name|column
operator|.
name|setPrefWidth
argument_list|(
literal|350
argument_list|)
expr_stmt|;
name|tableView
operator|.
name|setItems
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|tableView
operator|.
name|getColumns
argument_list|()
operator|.
name|add
argument_list|(
name|column
argument_list|)
expr_stmt|;
specifier|final
name|TextField
name|addName
init|=
operator|new
name|TextField
argument_list|()
decl_stmt|;
name|addName
operator|.
name|setPromptText
argument_list|(
literal|"name"
argument_list|)
expr_stmt|;
name|addName
operator|.
name|setPrefSize
argument_list|(
literal|200
argument_list|,
literal|30
argument_list|)
expr_stmt|;
name|BorderPane
name|tablePanel
init|=
operator|new
name|BorderPane
argument_list|()
decl_stmt|;
name|ScrollPane
name|scrollPane
init|=
operator|new
name|ScrollPane
argument_list|()
decl_stmt|;
name|scrollPane
operator|.
name|setMaxHeight
argument_list|(
literal|400
argument_list|)
expr_stmt|;
name|scrollPane
operator|.
name|setMaxWidth
argument_list|(
literal|400
argument_list|)
expr_stmt|;
name|scrollPane
operator|.
name|setContent
argument_list|(
name|tableView
argument_list|)
expr_stmt|;
name|tablePanel
operator|.
name|setCenter
argument_list|(
name|scrollPane
argument_list|)
expr_stmt|;
name|Button
name|add
init|=
operator|new
name|Button
argument_list|(
literal|"Add"
argument_list|)
decl_stmt|;
name|add
operator|.
name|setPrefSize
argument_list|(
literal|80
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|add
operator|.
name|setOnAction
argument_list|(
name|e
lambda|->
block|{
if|if
condition|(
operator|!
name|addName
operator|.
name|getText
argument_list|()
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|TableRow
name|tableRow
init|=
operator|new
name|TableRow
argument_list|(
name|addName
operator|.
name|getText
argument_list|()
argument_list|)
decl_stmt|;
name|addName
operator|.
name|clear
argument_list|()
expr_stmt|;
name|data
operator|.
name|add
argument_list|(
name|tableRow
argument_list|)
expr_stmt|;
name|tableRows
operator|.
name|clear
argument_list|()
expr_stmt|;
name|tableRows
operator|.
name|addAll
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|tableView
operator|.
name|setItems
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|tableChanged
operator|=
literal|true
expr_stmt|;
name|tableView
operator|.
name|refresh
argument_list|()
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|Button
name|delete
init|=
operator|new
name|Button
argument_list|(
literal|"Delete"
argument_list|)
decl_stmt|;
name|delete
operator|.
name|setPrefSize
argument_list|(
literal|80
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|delete
operator|.
name|setOnAction
argument_list|(
name|e
lambda|->
block|{
if|if
condition|(
name|tableView
operator|.
name|getFocusModel
argument_list|()
operator|!=
literal|null
operator|&&
name|tableView
operator|.
name|getFocusModel
argument_list|()
operator|.
name|getFocusedIndex
argument_list|()
operator|!=
operator|-
literal|1
condition|)
block|{
name|tableChanged
operator|=
literal|true
expr_stmt|;
name|int
name|row
init|=
name|tableView
operator|.
name|getFocusModel
argument_list|()
operator|.
name|getFocusedIndex
argument_list|()
decl_stmt|;
name|TableRow
name|tableRow
init|=
name|data
operator|.
name|get
argument_list|(
name|row
argument_list|)
decl_stmt|;
name|data
operator|.
name|remove
argument_list|(
name|tableRow
argument_list|)
expr_stmt|;
name|tableRows
operator|.
name|clear
argument_list|()
expr_stmt|;
name|tableRows
operator|.
name|addAll
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|tableView
operator|.
name|setItems
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|tableView
operator|.
name|refresh
argument_list|()
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|HBox
name|toolbar
init|=
operator|new
name|HBox
argument_list|(
name|addName
argument_list|,
name|add
argument_list|,
name|delete
argument_list|)
decl_stmt|;
name|tablePanel
operator|.
name|setBottom
argument_list|(
name|toolbar
argument_list|)
expr_stmt|;
comment|// Build Prefs Tabs
name|Label
name|xmpExportPrivacySettings
init|=
operator|new
name|Label
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"XMP export privacy settings"
argument_list|)
operator|+
literal|"  -------------------------"
argument_list|)
decl_stmt|;
name|xmpExportPrivacySettings
operator|.
name|setFont
argument_list|(
name|FontSize
operator|.
name|bigFont
argument_list|)
expr_stmt|;
name|builder
operator|.
name|add
argument_list|(
name|xmpExportPrivacySettings
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|builder
operator|.
name|add
argument_list|(
name|privacyFilterCheckBox
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|builder
operator|.
name|add
argument_list|(
name|tablePanel
argument_list|,
literal|1
argument_list|,
literal|3
argument_list|)
expr_stmt|;
block|}
DECL|method|getBuilder ()
specifier|public
name|Node
name|getBuilder
parameter_list|()
block|{
return|return
name|builder
return|;
block|}
DECL|class|TableRow
specifier|public
specifier|static
class|class
name|TableRow
block|{
DECL|field|name
specifier|private
name|SimpleStringProperty
name|name
decl_stmt|;
DECL|method|TableRow (String name)
name|TableRow
parameter_list|(
name|String
name|name
parameter_list|)
block|{
name|this
operator|.
name|name
operator|=
operator|new
name|SimpleStringProperty
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
DECL|method|setName (String name)
specifier|public
name|void
name|setName
parameter_list|(
name|String
name|name
parameter_list|)
block|{
name|this
operator|.
name|name
operator|.
name|set
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
DECL|method|getName ()
specifier|public
name|String
name|getName
parameter_list|()
block|{
return|return
name|name
operator|.
name|get
argument_list|()
return|;
block|}
block|}
comment|/**      * Load settings from the preferences and initialize the table.      */
annotation|@
name|Override
DECL|method|setValues ()
specifier|public
name|void
name|setValues
parameter_list|()
block|{
name|tableRows
operator|.
name|clear
argument_list|()
expr_stmt|;
name|tableRows
operator|.
name|addAll
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|privacyFilterCheckBox
operator|.
name|setSelected
argument_list|(
name|JabRefPreferences
operator|.
name|getInstance
argument_list|()
operator|.
name|getBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|USE_XMP_PRIVACY_FILTER
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/**      * Store changes to table preferences. This method is called when the user      * clicks Ok.      *      */
annotation|@
name|Override
DECL|method|storeSettings ()
specifier|public
name|void
name|storeSettings
parameter_list|()
block|{
comment|// Now we need to make sense of the contents the user has made to the
comment|// table setup table. This needs to be done either if changes were made, or
comment|// if the checkbox is checked and no field values have been stored previously:
if|if
condition|(
name|tableChanged
operator|||
operator|(
name|privacyFilterCheckBox
operator|.
name|isSelected
argument_list|()
operator|&&
operator|!
name|prefs
operator|.
name|hasKey
argument_list|(
name|JabRefPreferences
operator|.
name|XMP_PRIVACY_FILTERS
argument_list|)
operator|)
condition|)
block|{
comment|// First we remove all rows with empty names.
for|for
control|(
name|int
name|i
init|=
name|tableRows
operator|.
name|size
argument_list|()
operator|-
literal|1
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
if|if
condition|(
operator|(
name|tableRows
operator|.
name|get
argument_list|(
name|i
argument_list|)
operator|==
literal|null
operator|)
operator|||
name|tableRows
operator|.
name|get
argument_list|(
name|i
argument_list|)
operator|.
name|toString
argument_list|()
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|tableRows
operator|.
name|remove
argument_list|(
name|i
argument_list|)
expr_stmt|;
block|}
block|}
comment|// Finally, we store the new preferences.
name|JabRefPreferences
operator|.
name|getInstance
argument_list|()
operator|.
name|putStringList
argument_list|(
name|JabRefPreferences
operator|.
name|XMP_PRIVACY_FILTERS
argument_list|,
name|tableRows
operator|.
name|stream
argument_list|()
operator|.
name|map
argument_list|(
name|Object
operator|::
name|toString
argument_list|)
operator|.
name|collect
argument_list|(
name|Collectors
operator|.
name|toList
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|JabRefPreferences
operator|.
name|getInstance
argument_list|()
operator|.
name|putBoolean
argument_list|(
name|JabRefPreferences
operator|.
name|USE_XMP_PRIVACY_FILTER
argument_list|,
name|privacyFilterCheckBox
operator|.
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|validateSettings ()
specifier|public
name|boolean
name|validateSettings
parameter_list|()
block|{
return|return
literal|true
return|;
block|}
annotation|@
name|Override
DECL|method|getTabName ()
specifier|public
name|String
name|getTabName
parameter_list|()
block|{
return|return
name|Localization
operator|.
name|lang
argument_list|(
literal|"XMP-metadata"
argument_list|)
return|;
block|}
block|}
end_class

end_unit

