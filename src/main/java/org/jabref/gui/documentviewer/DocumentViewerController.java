begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_package
DECL|package|org.jabref.gui.documentviewer
package|package
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|documentviewer
package|;
end_package

begin_import
import|import
name|javax
operator|.
name|inject
operator|.
name|Inject
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|event
operator|.
name|ActionEvent
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|fxml
operator|.
name|FXML
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|ComboBox
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|Label
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|ScrollBar
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|TextField
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|ToggleButton
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|layout
operator|.
name|BorderPane
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|AbstractController
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|StateManager
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|util
operator|.
name|OnlyIntegerFormatter
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|util
operator|.
name|TaskExecutor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|util
operator|.
name|ViewModelListCellFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|model
operator|.
name|entry
operator|.
name|ParsedFileField
import|;
end_import

begin_class
DECL|class|DocumentViewerController
specifier|public
class|class
name|DocumentViewerController
extends|extends
name|AbstractController
argument_list|<
name|DocumentViewerViewModel
argument_list|>
block|{
DECL|field|scrollBar
annotation|@
name|FXML
specifier|private
name|ScrollBar
name|scrollBar
decl_stmt|;
DECL|field|fileChoice
annotation|@
name|FXML
specifier|private
name|ComboBox
argument_list|<
name|ParsedFileField
argument_list|>
name|fileChoice
decl_stmt|;
DECL|field|mainPane
annotation|@
name|FXML
specifier|private
name|BorderPane
name|mainPane
decl_stmt|;
DECL|field|modeLive
annotation|@
name|FXML
specifier|private
name|ToggleButton
name|modeLive
decl_stmt|;
DECL|field|currentPage
annotation|@
name|FXML
specifier|private
name|TextField
name|currentPage
decl_stmt|;
DECL|field|maxPages
annotation|@
name|FXML
specifier|private
name|Label
name|maxPages
decl_stmt|;
DECL|field|stateManager
annotation|@
name|Inject
specifier|private
name|StateManager
name|stateManager
decl_stmt|;
DECL|field|taskExecutor
annotation|@
name|Inject
specifier|private
name|TaskExecutor
name|taskExecutor
decl_stmt|;
DECL|field|viewer
specifier|private
name|DocumentViewerControl
name|viewer
decl_stmt|;
annotation|@
name|FXML
DECL|method|initialize ()
specifier|private
name|void
name|initialize
parameter_list|()
block|{
name|viewModel
operator|=
operator|new
name|DocumentViewerViewModel
argument_list|(
name|stateManager
argument_list|)
expr_stmt|;
name|setupViewer
argument_list|()
expr_stmt|;
name|setupScrollbar
argument_list|()
expr_stmt|;
name|setupFileChoice
argument_list|()
expr_stmt|;
name|setupPageControls
argument_list|()
expr_stmt|;
name|setupModeButtons
argument_list|()
expr_stmt|;
block|}
DECL|method|setupModeButtons ()
specifier|private
name|void
name|setupModeButtons
parameter_list|()
block|{
name|viewModel
operator|.
name|liveModeProperty
argument_list|()
operator|.
name|bind
argument_list|(
name|modeLive
operator|.
name|selectedProperty
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|setupScrollbar ()
specifier|private
name|void
name|setupScrollbar
parameter_list|()
block|{
name|scrollBar
operator|.
name|valueProperty
argument_list|()
operator|.
name|bindBidirectional
argument_list|(
name|viewer
operator|.
name|scrollYProperty
argument_list|()
argument_list|)
expr_stmt|;
name|scrollBar
operator|.
name|maxProperty
argument_list|()
operator|.
name|bind
argument_list|(
name|viewer
operator|.
name|scrollYMaxProperty
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|setupPageControls ()
specifier|private
name|void
name|setupPageControls
parameter_list|()
block|{
name|OnlyIntegerFormatter
name|integerFormatter
init|=
operator|new
name|OnlyIntegerFormatter
argument_list|(
literal|1
argument_list|)
decl_stmt|;
name|viewModel
operator|.
name|currentPageProperty
argument_list|()
operator|.
name|bindBidirectional
argument_list|(
name|integerFormatter
operator|.
name|valueProperty
argument_list|()
argument_list|)
expr_stmt|;
name|currentPage
operator|.
name|setTextFormatter
argument_list|(
name|integerFormatter
argument_list|)
expr_stmt|;
name|maxPages
operator|.
name|textProperty
argument_list|()
operator|.
name|bind
argument_list|(
name|viewModel
operator|.
name|maxPagesProperty
argument_list|()
operator|.
name|asString
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|setupFileChoice ()
specifier|private
name|void
name|setupFileChoice
parameter_list|()
block|{
name|ViewModelListCellFactory
argument_list|<
name|ParsedFileField
argument_list|>
name|cellFactory
init|=
operator|new
name|ViewModelListCellFactory
argument_list|<
name|ParsedFileField
argument_list|>
argument_list|()
operator|.
name|withText
argument_list|(
name|ParsedFileField
operator|::
name|getLink
argument_list|)
decl_stmt|;
name|fileChoice
operator|.
name|setButtonCell
argument_list|(
name|cellFactory
operator|.
name|call
argument_list|(
literal|null
argument_list|)
argument_list|)
expr_stmt|;
name|fileChoice
operator|.
name|setCellFactory
argument_list|(
name|cellFactory
argument_list|)
expr_stmt|;
name|fileChoice
operator|.
name|getSelectionModel
argument_list|()
operator|.
name|selectedItemProperty
argument_list|()
operator|.
name|addListener
argument_list|(
parameter_list|(
name|observable
parameter_list|,
name|oldValue
parameter_list|,
name|newValue
parameter_list|)
lambda|->
name|viewModel
operator|.
name|switchToFile
argument_list|(
name|newValue
argument_list|)
argument_list|)
expr_stmt|;
comment|// We always want that the first item is selected after a change
comment|// This also automatically selects the first file on the initial load
name|fileChoice
operator|.
name|itemsProperty
argument_list|()
operator|.
name|addListener
argument_list|(
parameter_list|(
name|observable
parameter_list|,
name|oldValue
parameter_list|,
name|newValue
parameter_list|)
lambda|->
name|fileChoice
operator|.
name|getSelectionModel
argument_list|()
operator|.
name|selectFirst
argument_list|()
argument_list|)
expr_stmt|;
name|fileChoice
operator|.
name|itemsProperty
argument_list|()
operator|.
name|bind
argument_list|(
name|viewModel
operator|.
name|filesProperty
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|setupViewer ()
specifier|private
name|void
name|setupViewer
parameter_list|()
block|{
name|viewer
operator|=
operator|new
name|DocumentViewerControl
argument_list|(
name|taskExecutor
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|currentDocumentProperty
argument_list|()
operator|.
name|addListener
argument_list|(
parameter_list|(
name|observable
parameter_list|,
name|oldDocument
parameter_list|,
name|newDocument
parameter_list|)
lambda|->
block|{
if|if
condition|(
name|newDocument
operator|!=
literal|null
condition|)
block|{
name|viewer
operator|.
name|show
argument_list|(
name|newDocument
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
name|viewModel
operator|.
name|currentPageProperty
argument_list|()
operator|.
name|bindBidirectional
argument_list|(
name|viewer
operator|.
name|currentPageProperty
argument_list|()
argument_list|)
expr_stmt|;
name|mainPane
operator|.
name|setCenter
argument_list|(
name|viewer
argument_list|)
expr_stmt|;
block|}
DECL|method|nextPage (ActionEvent actionEvent)
specifier|public
name|void
name|nextPage
parameter_list|(
name|ActionEvent
name|actionEvent
parameter_list|)
block|{
name|viewModel
operator|.
name|showNextPage
argument_list|()
expr_stmt|;
block|}
DECL|method|previousPage (ActionEvent actionEvent)
specifier|public
name|void
name|previousPage
parameter_list|(
name|ActionEvent
name|actionEvent
parameter_list|)
block|{
name|viewModel
operator|.
name|showPreviousPage
argument_list|()
expr_stmt|;
block|}
DECL|method|fitWidth (ActionEvent actionEvent)
specifier|public
name|void
name|fitWidth
parameter_list|(
name|ActionEvent
name|actionEvent
parameter_list|)
block|{
name|viewer
operator|.
name|setPageWidth
argument_list|(
name|viewer
operator|.
name|getWidth
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|zoomIn (ActionEvent actionEvent)
specifier|public
name|void
name|zoomIn
parameter_list|(
name|ActionEvent
name|actionEvent
parameter_list|)
block|{
name|viewer
operator|.
name|changePageWidth
argument_list|(
literal|100
argument_list|)
expr_stmt|;
block|}
DECL|method|zoomOut (ActionEvent actionEvent)
specifier|public
name|void
name|zoomOut
parameter_list|(
name|ActionEvent
name|actionEvent
parameter_list|)
block|{
name|viewer
operator|.
name|changePageWidth
argument_list|(
operator|-
literal|100
argument_list|)
expr_stmt|;
block|}
DECL|method|fitSinglePage (ActionEvent actionEvent)
specifier|public
name|void
name|fitSinglePage
parameter_list|(
name|ActionEvent
name|actionEvent
parameter_list|)
block|{
name|viewer
operator|.
name|setPageHeight
argument_list|(
name|viewer
operator|.
name|getHeight
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_class

end_unit

