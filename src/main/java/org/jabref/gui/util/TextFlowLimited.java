begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_package
DECL|package|org.jabref.gui.util
package|package
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|util
package|;
end_package

begin_import
import|import
name|javafx
operator|.
name|animation
operator|.
name|Animation
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|animation
operator|.
name|Transition
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|geometry
operator|.
name|HPos
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|geometry
operator|.
name|VPos
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|Hyperlink
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|layout
operator|.
name|Region
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|shape
operator|.
name|Rectangle
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|text
operator|.
name|Text
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|text
operator|.
name|TextFlow
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|util
operator|.
name|Duration
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|logic
operator|.
name|l10n
operator|.
name|Localization
import|;
end_import

begin_class
DECL|class|TextFlowLimited
specifier|public
class|class
name|TextFlowLimited
extends|extends
name|TextFlow
block|{
DECL|field|isCollapsed
specifier|private
name|boolean
name|isCollapsed
init|=
literal|true
decl_stmt|;
DECL|field|moreLink
specifier|private
name|Hyperlink
name|moreLink
init|=
operator|new
name|Hyperlink
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"(more)"
argument_list|)
argument_list|)
decl_stmt|;
DECL|field|clip
specifier|private
name|Rectangle
name|clip
init|=
operator|new
name|Rectangle
argument_list|()
decl_stmt|;
DECL|method|TextFlowLimited (Text... texts)
specifier|public
name|TextFlowLimited
parameter_list|(
name|Text
modifier|...
name|texts
parameter_list|)
block|{
name|super
argument_list|(
name|texts
argument_list|)
expr_stmt|;
name|this
operator|.
name|setPrefWidth
argument_list|(
name|Region
operator|.
name|USE_PREF_SIZE
argument_list|)
expr_stmt|;
name|moreLink
operator|.
name|setOnAction
argument_list|(
name|event
lambda|->
name|expand
argument_list|()
argument_list|)
expr_stmt|;
name|moreLink
operator|.
name|setStyle
argument_list|(
literal|"-fx-background-color: white"
argument_list|)
expr_stmt|;
name|this
operator|.
name|setOnMouseClicked
argument_list|(
name|event
lambda|->
name|expand
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|expand ()
specifier|private
name|void
name|expand
parameter_list|()
block|{
name|double
name|newPrefHeight
init|=
name|super
operator|.
name|computePrefHeight
argument_list|(
name|getWidth
argument_list|()
argument_list|)
decl_stmt|;
specifier|final
name|Animation
name|expandPanel
init|=
operator|new
name|Transition
argument_list|()
block|{
block|{
name|setCycleDuration
argument_list|(
name|Duration
operator|.
name|millis
argument_list|(
literal|200
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
specifier|protected
name|void
name|interpolate
parameter_list|(
name|double
name|fraction
parameter_list|)
block|{
name|setPrefHeight
argument_list|(
name|newPrefHeight
operator|*
name|fraction
argument_list|)
expr_stmt|;
block|}
block|}
decl_stmt|;
name|expandPanel
operator|.
name|setOnFinished
argument_list|(
name|event
lambda|->
block|{
name|isCollapsed
operator|=
literal|false
expr_stmt|;
name|requestLayout
argument_list|()
expr_stmt|;
block|}
argument_list|)
expr_stmt|;
name|expandPanel
operator|.
name|play
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|computePrefHeight (double width)
specifier|protected
name|double
name|computePrefHeight
parameter_list|(
name|double
name|width
parameter_list|)
block|{
if|if
condition|(
name|isCollapsed
condition|)
block|{
return|return
literal|38
return|;
block|}
else|else
block|{
return|return
name|super
operator|.
name|computePrefHeight
argument_list|(
name|width
argument_list|)
return|;
block|}
block|}
annotation|@
name|Override
DECL|method|layoutChildren ()
specifier|protected
name|void
name|layoutChildren
parameter_list|()
block|{
name|super
operator|.
name|layoutChildren
argument_list|()
expr_stmt|;
if|if
condition|(
name|isCollapsed
condition|)
block|{
comment|// Display link to expand text
if|if
condition|(
operator|!
name|this
operator|.
name|getChildren
argument_list|()
operator|.
name|contains
argument_list|(
name|moreLink
argument_list|)
condition|)
block|{
name|this
operator|.
name|getChildren
argument_list|()
operator|.
name|add
argument_list|(
name|moreLink
argument_list|)
expr_stmt|;
block|}
name|layoutInArea
argument_list|(
name|moreLink
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|getWidth
argument_list|()
argument_list|,
name|getHeight
argument_list|()
argument_list|,
name|getBaselineOffset
argument_list|()
argument_list|,
name|HPos
operator|.
name|RIGHT
argument_list|,
name|VPos
operator|.
name|BOTTOM
argument_list|)
expr_stmt|;
comment|// Clip content if it expands above pref height (no idea why this is needed, but otherwise sometimes the text is still visible)
name|clip
operator|.
name|setHeight
argument_list|(
name|computePrefHeight
argument_list|(
name|this
operator|.
name|getWidth
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|clip
operator|.
name|setWidth
argument_list|(
name|this
operator|.
name|getWidth
argument_list|()
argument_list|)
expr_stmt|;
name|this
operator|.
name|setClip
argument_list|(
name|clip
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|getChildren
argument_list|()
operator|.
name|remove
argument_list|(
name|moreLink
argument_list|)
expr_stmt|;
name|this
operator|.
name|setClip
argument_list|(
literal|null
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_class

end_unit

