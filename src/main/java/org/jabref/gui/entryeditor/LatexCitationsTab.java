begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_package
DECL|package|org.jabref.gui.entryeditor
package|package
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|entryeditor
package|;
end_package

begin_import
import|import
name|javafx
operator|.
name|geometry
operator|.
name|HPos
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|geometry
operator|.
name|Pos
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|Button
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|Label
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|ProgressIndicator
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|control
operator|.
name|Tooltip
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|layout
operator|.
name|ColumnConstraints
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|layout
operator|.
name|GridPane
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|layout
operator|.
name|HBox
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|layout
operator|.
name|Priority
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|layout
operator|.
name|RowConstraints
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|layout
operator|.
name|VBox
import|;
end_import

begin_import
import|import
name|javafx
operator|.
name|scene
operator|.
name|text
operator|.
name|Text
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|DialogService
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|icon
operator|.
name|IconTheme
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|texparser
operator|.
name|CitationsDisplay
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|gui
operator|.
name|util
operator|.
name|TaskExecutor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|logic
operator|.
name|l10n
operator|.
name|Localization
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|model
operator|.
name|database
operator|.
name|BibDatabaseContext
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|model
operator|.
name|entry
operator|.
name|BibEntry
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jabref
operator|.
name|preferences
operator|.
name|PreferencesService
import|;
end_import

begin_import
import|import
name|org
operator|.
name|fxmisc
operator|.
name|easybind
operator|.
name|EasyBind
import|;
end_import

begin_class
DECL|class|LatexCitationsTab
specifier|public
class|class
name|LatexCitationsTab
extends|extends
name|EntryEditorTab
block|{
DECL|field|viewModel
specifier|private
specifier|final
name|LatexCitationsTabViewModel
name|viewModel
decl_stmt|;
DECL|field|searchPane
specifier|private
specifier|final
name|GridPane
name|searchPane
decl_stmt|;
DECL|field|progressIndicator
specifier|private
specifier|final
name|ProgressIndicator
name|progressIndicator
decl_stmt|;
DECL|field|citationsDisplay
specifier|private
specifier|final
name|CitationsDisplay
name|citationsDisplay
decl_stmt|;
DECL|method|LatexCitationsTab (BibDatabaseContext databaseContext, PreferencesService preferencesService, TaskExecutor taskExecutor, DialogService dialogService)
specifier|public
name|LatexCitationsTab
parameter_list|(
name|BibDatabaseContext
name|databaseContext
parameter_list|,
name|PreferencesService
name|preferencesService
parameter_list|,
name|TaskExecutor
name|taskExecutor
parameter_list|,
name|DialogService
name|dialogService
parameter_list|)
block|{
name|this
operator|.
name|viewModel
operator|=
operator|new
name|LatexCitationsTabViewModel
argument_list|(
name|databaseContext
argument_list|,
name|preferencesService
argument_list|,
name|taskExecutor
argument_list|,
name|dialogService
argument_list|)
expr_stmt|;
name|this
operator|.
name|searchPane
operator|=
operator|new
name|GridPane
argument_list|()
expr_stmt|;
name|this
operator|.
name|progressIndicator
operator|=
operator|new
name|ProgressIndicator
argument_list|()
expr_stmt|;
name|this
operator|.
name|citationsDisplay
operator|=
operator|new
name|CitationsDisplay
argument_list|()
expr_stmt|;
name|setText
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"LaTeX Citations"
argument_list|)
argument_list|)
expr_stmt|;
name|setTooltip
argument_list|(
operator|new
name|Tooltip
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Search citations for this entry in LaTeX files"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|setGraphic
argument_list|(
name|IconTheme
operator|.
name|JabRefIcons
operator|.
name|LATEX_CITATIONS
operator|.
name|getGraphicNode
argument_list|()
argument_list|)
expr_stmt|;
name|setSearchPane
argument_list|()
expr_stmt|;
block|}
DECL|method|setSearchPane ()
specifier|private
name|void
name|setSearchPane
parameter_list|()
block|{
name|progressIndicator
operator|.
name|setMaxSize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|citationsDisplay
operator|.
name|basePathProperty
argument_list|()
operator|.
name|bindBidirectional
argument_list|(
name|viewModel
operator|.
name|directoryProperty
argument_list|()
argument_list|)
expr_stmt|;
name|citationsDisplay
operator|.
name|setItems
argument_list|(
name|viewModel
operator|.
name|getCitationList
argument_list|()
argument_list|)
expr_stmt|;
name|RowConstraints
name|mainRow
init|=
operator|new
name|RowConstraints
argument_list|()
decl_stmt|;
name|mainRow
operator|.
name|setVgrow
argument_list|(
name|Priority
operator|.
name|ALWAYS
argument_list|)
expr_stmt|;
name|RowConstraints
name|bottomRow
init|=
operator|new
name|RowConstraints
argument_list|(
literal|40
argument_list|)
decl_stmt|;
name|bottomRow
operator|.
name|setVgrow
argument_list|(
name|Priority
operator|.
name|NEVER
argument_list|)
expr_stmt|;
name|ColumnConstraints
name|column
init|=
operator|new
name|ColumnConstraints
argument_list|()
decl_stmt|;
name|column
operator|.
name|setPercentWidth
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|column
operator|.
name|setHalignment
argument_list|(
name|HPos
operator|.
name|CENTER
argument_list|)
expr_stmt|;
name|searchPane
operator|.
name|getColumnConstraints
argument_list|()
operator|.
name|setAll
argument_list|(
name|column
argument_list|)
expr_stmt|;
name|searchPane
operator|.
name|getRowConstraints
argument_list|()
operator|.
name|setAll
argument_list|(
name|mainRow
argument_list|,
name|bottomRow
argument_list|)
expr_stmt|;
name|setContent
argument_list|(
name|searchPane
argument_list|)
expr_stmt|;
name|EasyBind
operator|.
name|subscribe
argument_list|(
name|viewModel
operator|.
name|statusProperty
argument_list|()
argument_list|,
name|status
lambda|->
block|{
name|searchPane
operator|.
name|getChildren
argument_list|()
operator|.
name|clear
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|status
condition|)
block|{
case|case
name|IN_PROGRESS
case|:
name|searchPane
operator|.
name|add
argument_list|(
name|progressIndicator
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|CITATIONS_FOUND
case|:
name|searchPane
operator|.
name|add
argument_list|(
name|getCitationsPane
argument_list|()
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|NO_RESULTS
case|:
name|searchPane
operator|.
name|add
argument_list|(
name|getNotFoundPane
argument_list|()
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|ERROR
case|:
name|searchPane
operator|.
name|add
argument_list|(
name|getErrorPane
argument_list|()
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
name|searchPane
operator|.
name|add
argument_list|(
name|getLatexDirectoryBox
argument_list|()
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
argument_list|)
expr_stmt|;
block|}
DECL|method|getLatexDirectoryBox ()
specifier|private
name|HBox
name|getLatexDirectoryBox
parameter_list|()
block|{
name|Text
name|latexDirectoryText
init|=
operator|new
name|Text
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Current search directory:"
argument_list|)
argument_list|)
decl_stmt|;
name|latexDirectoryText
operator|.
name|setStyle
argument_list|(
literal|"-fx-font-size: 0.9em;-fx-padding: 0;"
argument_list|)
expr_stmt|;
name|Text
name|latexDirectoryPath
init|=
operator|new
name|Text
argument_list|(
name|viewModel
operator|.
name|directoryProperty
argument_list|()
operator|.
name|get
argument_list|()
operator|.
name|toString
argument_list|()
argument_list|)
decl_stmt|;
name|latexDirectoryPath
operator|.
name|setStyle
argument_list|(
literal|"-fx-font-family: 'Courier New', Courier, monospace;-fx-font-size: 0.9em;-fx-font-weight: bold;"
argument_list|)
expr_stmt|;
name|Button
name|latexDirectoryButton
init|=
operator|new
name|Button
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Set LaTeX file directory"
argument_list|)
argument_list|)
decl_stmt|;
name|latexDirectoryButton
operator|.
name|setStyle
argument_list|(
literal|"-fx-border-width: 1;-fx-font-size: 0.85em;-fx-padding: 0.2em;"
argument_list|)
expr_stmt|;
name|latexDirectoryButton
operator|.
name|setGraphic
argument_list|(
name|IconTheme
operator|.
name|JabRefIcons
operator|.
name|LATEX_FILE_DIRECTORY
operator|.
name|getGraphicNode
argument_list|()
argument_list|)
expr_stmt|;
name|latexDirectoryButton
operator|.
name|setOnAction
argument_list|(
name|event
lambda|->
name|viewModel
operator|.
name|setLatexDirectory
argument_list|()
argument_list|)
expr_stmt|;
name|HBox
name|latexDirectoryBox
init|=
operator|new
name|HBox
argument_list|(
literal|10
argument_list|,
name|latexDirectoryText
argument_list|,
name|latexDirectoryPath
argument_list|,
name|latexDirectoryButton
argument_list|)
decl_stmt|;
name|latexDirectoryBox
operator|.
name|setAlignment
argument_list|(
name|Pos
operator|.
name|CENTER
argument_list|)
expr_stmt|;
return|return
name|latexDirectoryBox
return|;
block|}
DECL|method|getCitationsPane ()
specifier|private
name|VBox
name|getCitationsPane
parameter_list|()
block|{
name|VBox
name|citationsBox
init|=
operator|new
name|VBox
argument_list|(
literal|30
argument_list|,
name|citationsDisplay
argument_list|)
decl_stmt|;
name|citationsBox
operator|.
name|setStyle
argument_list|(
literal|"-fx-padding: 0;"
argument_list|)
expr_stmt|;
return|return
name|citationsBox
return|;
block|}
DECL|method|getNotFoundPane ()
specifier|private
name|VBox
name|getNotFoundPane
parameter_list|()
block|{
name|Label
name|titleLabel
init|=
operator|new
name|Label
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"No citations found"
argument_list|)
argument_list|)
decl_stmt|;
name|titleLabel
operator|.
name|setStyle
argument_list|(
literal|"-fx-font-size: 1.5em;-fx-font-weight: bold;-fx-text-fill: -jr-theme-text;"
argument_list|)
expr_stmt|;
name|Text
name|notFoundText
init|=
operator|new
name|Text
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"No LaTeX files containing this entry were found."
argument_list|)
argument_list|)
decl_stmt|;
name|VBox
name|notFoundBox
init|=
operator|new
name|VBox
argument_list|(
literal|30
argument_list|,
name|titleLabel
argument_list|,
name|notFoundText
argument_list|)
decl_stmt|;
name|notFoundBox
operator|.
name|setStyle
argument_list|(
literal|"-fx-padding: 30 0 0 30;"
argument_list|)
expr_stmt|;
return|return
name|notFoundBox
return|;
block|}
DECL|method|getErrorPane ()
specifier|private
name|VBox
name|getErrorPane
parameter_list|()
block|{
name|Label
name|titleLabel
init|=
operator|new
name|Label
argument_list|(
name|Localization
operator|.
name|lang
argument_list|(
literal|"Error"
argument_list|)
argument_list|)
decl_stmt|;
name|titleLabel
operator|.
name|setStyle
argument_list|(
literal|"-fx-font-size: 1.5em;-fx-font-weight: bold;-fx-text-fill: -fx-accent;"
argument_list|)
expr_stmt|;
name|Text
name|errorMessageText
init|=
operator|new
name|Text
argument_list|(
name|viewModel
operator|.
name|searchErrorProperty
argument_list|()
operator|.
name|get
argument_list|()
argument_list|)
decl_stmt|;
name|VBox
name|errorMessageBox
init|=
operator|new
name|VBox
argument_list|(
literal|30
argument_list|,
name|titleLabel
argument_list|,
name|errorMessageText
argument_list|)
decl_stmt|;
name|errorMessageBox
operator|.
name|setStyle
argument_list|(
literal|"-fx-padding: 30 0 0 30;"
argument_list|)
expr_stmt|;
return|return
name|errorMessageBox
return|;
block|}
annotation|@
name|Override
DECL|method|bindToEntry (BibEntry entry)
specifier|protected
name|void
name|bindToEntry
parameter_list|(
name|BibEntry
name|entry
parameter_list|)
block|{
name|viewModel
operator|.
name|init
argument_list|(
name|entry
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|shouldShow (BibEntry entry)
specifier|public
name|boolean
name|shouldShow
parameter_list|(
name|BibEntry
name|entry
parameter_list|)
block|{
return|return
name|viewModel
operator|.
name|shouldShow
argument_list|()
return|;
block|}
block|}
end_class

end_unit

